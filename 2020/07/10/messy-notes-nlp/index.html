<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Xiaohan Zou's blog">
    <meta name="keywords"  content="">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="乱七八糟的知识点 - Renovamen (Xiaohan Zou)">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="优化器
">
    
    <meta property="article:published_time" content="2020-07-10T00:00:00Z">
    
    
    <meta property="article:author" content="Renovamen">
    
    
    <meta property="article:tag" content="NLP">
    
    
    <meta property="og:image" content="https://renovamen.inkimg/header-avatar.jpeg">
    <meta property="og:url" content="https://renovamen.ink/2020/07/10/messy-notes-nlp/">
    <meta property="og:site_name" content="Renovamen (Xiaohan Zou)">
    
    <title>乱七八糟的知识点 - Renovamen (Xiaohan Zou)</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.svg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://renovamen.ink/2020/07/10/messy-notes-nlp/"><!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.2/dist/css/bootstrap.min.css">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200"/>

    <!-- Custom Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" rel="stylesheet" type="text/css">
    
    <!-- Font Awesome Animation -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome-animation@0.2.1/dist/font-awesome-animation.min.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/gungnir.css">
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script>

    <!-- Lazyload (.js & .css)-->
    <script>// https://github.com/rgrove/lazyload

/*jslint browser: true, eqeqeq: true, bitwise: true, newcap: true, immed: true, regexp: false */

/**
LazyLoad makes it easy and painless to lazily load one or more external
JavaScript or CSS files on demand either during or after the rendering of a web
page.
Supported browsers include Firefox 2+, IE6+, Safari 3+ (including Mobile
Safari), Google Chrome, and Opera 9+. Other browsers may or may not work and
are not officially supported.
Visit https://github.com/rgrove/lazyload/ for more info.
Copyright (c) 2011 Ryan Grove <ryan@wonko.com>
All rights reserved.
Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the 'Software'), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
@module lazyload
@class LazyLoad
@static
*/

LazyLoad = (function (doc) {
    // -- Private Variables ------------------------------------------------------
  
    // User agent and feature test information.
    var env,
  
    // Reference to the <head> element (populated lazily).
    head,
  
    // Requests currently in progress, if any.
    pending = {},
  
    // Number of times we've polled to check whether a pending stylesheet has
    // finished loading. If this gets too high, we're probably stalled.
    pollCount = 0,
  
    // Queued requests.
    queue = {css: [], js: []},
  
    // Reference to the browser's list of stylesheets.
    styleSheets = doc.styleSheets;
  
    // -- Private Methods --------------------------------------------------------
  
    /**
    Creates and returns an HTML element with the specified name and attributes.
    @method createNode
    @param {String} name element name
    @param {Object} attrs name/value mapping of element attributes
    @return {HTMLElement}
    @private
    */
    function createNode(name, attrs) {
        var node = doc.createElement(name), attr;
    
        for (attr in attrs) {
            if (attrs.hasOwnProperty(attr)) {
                node.setAttribute(attr, attrs[attr]);
            }
        }
    
        return node;
    }
  
    /**
    Called when the current pending resource of the specified type has finished
    loading. Executes the associated callback (if any) and loads the next
    resource in the queue.
    @method finish
    @param {String} type resource type ('css' or 'js')
    @private
    */
    function finish(type) {
        var p = pending[type],
            callback,
            urls;
    
        if (p) {
            callback = p.callback;
            urls     = p.urls;
    
            urls.shift();
            pollCount = 0;
    
            // If this is the last of the pending URLs, execute the callback and
            // start the next request in the queue (if any).
            if (!urls.length) {
                callback && callback.call(p.context, p.obj);
                pending[type] = null;
                queue[type].length && load(type);
            }
        }
    }
  
    /**
    Populates the <code>env</code> variable with user agent and feature test
    information.
    @method getEnv
    @private
    */
    function getEnv() {
        var ua = navigator.userAgent;
    
        env = {
            // True if this browser supports disabling async mode on dynamically
            // created script nodes. See
            // http://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order
            async: doc.createElement('script').async === true
        };
    
        (env.webkit = /AppleWebKit\//.test(ua))
            || (env.ie = /MSIE|Trident/.test(ua))
            || (env.opera = /Opera/.test(ua))
            || (env.gecko = /Gecko\//.test(ua))
            || (env.unknown = true);
    }
  
    /**
    Loads the specified resources, or the next resource of the specified type
    in the queue if no resources are specified. If a resource of the specified
    type is already being loaded, the new request will be queued until the
    first request has been finished.
    When an array of resource URLs is specified, those URLs will be loaded in
    parallel if it is possible to do so while preserving execution order. All
    browsers support parallel loading of CSS, but only Firefox and Opera
    support parallel loading of scripts. In other browsers, scripts will be
    queued and loaded one at a time to ensure correct execution order.
    @method load
    @param {String} type resource type ('css' or 'js')
    @param {String|Array} urls (optional) URL or array of URLs to load
    @param {Function} callback (optional) callback function to execute when the
      resource is loaded
    @param {Object} obj (optional) object to pass to the callback function
    @param {Object} context (optional) if provided, the callback function will
      be executed in this object's context
    @private
    */
    function load(type, urls, callback, obj, context) {
        var _finish = function () { finish(type); },
            isCSS   = type === 'css',
            nodes   = [],
            i, len, node, p, pendingUrls, url;
  
        env || getEnv();
  
        if (urls) {
            // If urls is a string, wrap it in an array. Otherwise assume it's an
            // array and create a copy of it so modifications won't be made to the
            // original.
            urls = typeof urls === 'string' ? [urls] : urls.concat();
    
            // Create a request object for each URL. If multiple URLs are specified,
            // the callback will only be executed after all URLs have been loaded.
            //
            // Sadly, Firefox and Opera are the only browsers capable of loading
            // scripts in parallel while preserving execution order. In all other
            // browsers, scripts must be loaded sequentially.
            //
            // All browsers respect CSS specificity based on the order of the link
            // elements in the DOM, regardless of the order in which the stylesheets
            // are actually downloaded.
            if (isCSS || env.async || env.gecko || env.opera) {
                // Load in parallel.
                queue[type].push({
                    urls    : urls,
                    callback: callback,
                    obj     : obj,
                    context : context
                });
            } 
            else {
                // Load sequentially.
                for (i = 0, len = urls.length; i < len; ++i) {
                    queue[type].push({
                        urls    : [urls[i]],
                        callback: i === len - 1 ? callback : null, // callback is only added to the last URL
                        obj     : obj,
                        context : context
                    });
                }
            }
        }
  
        // If a previous load request of this type is currently in progress, we'll
        // wait our turn. Otherwise, grab the next item in the queue.
        if (pending[type] || !(p = pending[type] = queue[type].shift())) {
            return;
        }
    
        head || (head = doc.head || doc.getElementsByTagName('head')[0]);
        pendingUrls = p.urls.concat();

        for (i = 0, len = pendingUrls.length; i < len; ++i) {
            url = pendingUrls[i];
    
            if (isCSS) {
                node = env.gecko ? createNode('style') : createNode('link', {
                    href: url,
                    rel : 'stylesheet'
                });
            } 
            else {
                node = createNode('script', {src: url});
                node.async = false;
            }
    
            node.className = 'lazyload';
            node.setAttribute('charset', 'utf-8');
    
            if (env.ie && !isCSS && 'onreadystatechange' in node && !('draggable' in node)) {
                node.onreadystatechange = function () {
                    if (/loaded|complete/.test(node.readyState)) {
                        node.onreadystatechange = null;
                        _finish();
                    }
                };
            } 
            else if (isCSS && (env.gecko || env.webkit)) {
                // Gecko and WebKit don't support the onload event on link nodes.
                if (env.webkit) {
                    // In WebKit, we can poll for changes to document.styleSheets to
                    // figure out when stylesheets have loaded.
                    p.urls[i] = node.href; // resolve relative URLs (or polling won't work)
                    pollWebKit();
                } 
                else {
                    // In Gecko, we can import the requested URL into a <style> node and
                    // poll for the existence of node.sheet.cssRules. Props to Zach
                    // Leatherman for calling my attention to this technique.
                    node.innerHTML = '@import "' + url + '";';
                    pollGecko(node);
                }
            } 
            else {
                node.onload = node.onerror = _finish;
            }
    
            nodes.push(node);
        }
    
        for (i = 0, len = nodes.length; i < len; ++i) {
            head.appendChild(nodes[i]);
        }
    }
  
    /**
    Begins polling to determine when the specified stylesheet has finished loading
    in Gecko. Polling stops when all pending stylesheets have loaded or after 10
    seconds (to prevent stalls).
    Thanks to Zach Leatherman for calling my attention to the @import-based
    cross-domain technique used here, and to Oleg Slobodskoi for an earlier
    same-domain implementation. See Zach's blog for more details:
    http://www.zachleat.com/web/2010/07/29/load-css-dynamically/
    @method pollGecko
    @param {HTMLElement} node Style node to poll.
    @private
    */
    function pollGecko(node) {
        var hasRules;
    
        try {
            // We don't really need to store this value or ever refer to it again, but
            // if we don't store it, Closure Compiler assumes the code is useless and
            // removes it.
            hasRules = !!node.sheet.cssRules;
        } 
        catch (ex) {
            // An exception means the stylesheet is still loading.
            pollCount += 1;

            if (pollCount < 200) {
                setTimeout(function () { pollGecko(node); }, 50);
            } 
            else {
                // We've been polling for 10 seconds and nothing's happened. Stop
                // polling and finish the pending requests to avoid blocking further
                // requests.
                hasRules && finish('css');
            }
            return;
        }
    
        // If we get here, the stylesheet has loaded.
        finish('css');
    }
    
    /**
    Begins polling to determine when pending stylesheets have finished loading
    in WebKit. Polling stops when all pending stylesheets have loaded or after 10
    seconds (to prevent stalls).
    @method pollWebKit
    @private
    */
    function pollWebKit() {
        var css = pending.css, i;

        if (css) {
            i = styleSheets.length;

            // Look for a stylesheet matching the pending URL.
            while (--i >= 0) {
                if (styleSheets[i].href === css.urls[0]) {
                    finish('css');
                    break;
                }
            }

            pollCount += 1;
    
            if (css) {
                if (pollCount < 200) {
                    setTimeout(pollWebKit, 50);
                } 
                else {
                    // We've been polling for 10 seconds and nothing's happened, which may
                    // indicate that the stylesheet has been removed from the document
                    // before it had a chance to load. Stop polling and finish the pending
                    // request to prevent blocking further requests.
                    finish('css');
                }
            }
        }
    }
    
    return {
    
        /**
         Requests the specified CSS URL or URLs and executes the specified
        callback (if any) when they have finished loading. If an array of URLs is
        specified, the stylesheets will be loaded in parallel and the callback
        will be executed after all stylesheets have finished loading.
        @method css
        @param {String|Array} urls CSS URL or array of CSS URLs to load
        @param {Function} callback (optional) callback function to execute when
        the specified stylesheets are loaded
        @param {Object} obj (optional) object to pass to the callback function
        @param {Object} context (optional) if provided, the callback function
        will be executed in this object's context
        @static
        */
        css: function (urls, callback, obj, context) {
            load('css', urls, callback, obj, context);
        },
    
        /**
         Requests the specified JavaScript URL or URLs and executes the specified
        callback (if any) when they have finished loading. If an array of URLs is
        specified and the browser supports it, the scripts will be loaded in
        parallel and the callback will be executed after all scripts have
        finished loading.
        Currently, only Firefox and Opera support parallel loading of scripts while
        preserving execution order. In other browsers, scripts will be
        queued and loaded one at a time to ensure correct execution order.
        @method js
        @param {String|Array} urls JS URL or array of JS URLs to load
        @param {Function} callback (optional) callback function to execute when
        the specified scripts are loaded
        @param {Object} obj (optional) object to pass to the callback function
        @param {Object} context (optional) if provided, the callback function
        will be executed in this object's context
        @static
        */
        js: function (urls, callback, obj, context) {
            load('js', urls, callback, obj, context);
        }
    };
})(this.document);</script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Renovamen: add menu button -->
    <div class="menu-btn-container">
    <div class="menu-btn-wrapper">
        <div class="menu-btn">
            <div class="menu-btn-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="menu-text"></div>
            <svg class="menu-svg">
                <circle class="menu-border" cx="50%" cy="50%" r="48%"></circle>
            </svg>
        </div>
        <div class="menu-btn-child-wrapper">
            <div class="menu-btn-child" id="menu-theme-btn">
                <span class="fa icon-theme"></span>
            </div>
            <div class="menu-btn-child" onclick="smoothTo('bottom')">
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="menu-btn-child" onclick="smoothTo('top')">
                <i class="fas fa-chevron-up"></i>
            </div>
            
            
            <div class="menu-btn-child" id="menu-toc-btn">
                <i class="fas fa-list-ul"></i>
            </div>
            
            
            <div class="menu-btn-child" id="menu-navbar-btn">
                <i class="far fa-window-restore"></i>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // open menu
    $('.menu-btn').click(function() {
        $('.menu-btn-container').toggleClass('open');
    });
    
    // open navbar
    $('#menu-navbar-btn').click(function() {
        mobileNavToggle();
    });

    // open catalog
    $('#menu-toc-btn').click(function() {
        $('.side-catalog').toggleClass('open');
    });

    // set theme icon in menu
    function setThemeIcon(newTheme) {
        const icons = {
            'light': '"\\f185"', 
            'dark': '"\\f186"', 
            'sepia': '"\\f0f4"'
        }
        $('#menu-theme-btn').append(
            '<style>.icon-theme:before{content:' + icons[newTheme] + '}</style>'
        );
    }

    function toggleTheme() {
        const themes = ['light', 'dark', 'sepia']
        // get current theme
        const currentTheme = window.__theme
        const currentIndex = themes.indexOf(currentTheme)
        // set next theme
        const nextIndex = (currentIndex + 1) % themes.length
        const nextTheme = themes[nextIndex]
        window.__setPreferredTheme(nextTheme)
        setThemeIcon(nextTheme)
    }

    // change theme
    $('#menu-theme-btn').click(function() {
        toggleTheme()
    });
</script>

    <div class="main-container">
    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <!-- navbar toggle for old mobile menu button (by Hux) -->
            <!-- <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button> -->
            <a class="navbar-brand" href="/">$ cd /home/</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">

                    
                    <li>
                        
                        <a href="/" class="faa-parent animated-hover">
                        
                            
                            <i class="fab fa-fort-awesome fa-lg faa-wrench"></i>
                            
                            Home
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/about/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-paw fa-lg faa-wrench"></i>
                            
                            About
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/archive/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-archive fa-lg faa-wrench"></i>
                            
                            Archive
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/links/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-link fa-lg faa-wrench"></i>
                            
                            Links
                        </a>
                        
                    </li>
                    
                    <li>
                        <a id="search-btn" class="faa-parent animated-hover">
                            <i class="fas fa-search fa-lg faa-wrench"></i> Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Old Mobile Navbar Script (By Hux) -->
<!-- <script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script> -->

    <!-- Image to hack wechat -->
<!-- <img src="/img/in-post/2020-07-10/header.jpg" width="0" height="0"> -->

<!-- Post Header -->



    
    <style type="text/css">
        header.intro-header{
            position: relative;
            background-image: url('/img/in-post/2020-07-10/header.jpg');
            background: ;
        }

        
    </style>
    
    





<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=NLP" title="NLP">NLP</a>
                        
                    </div>
                    <h1>乱七八糟的知识点</h1>
                    
                    <h2 class="subheading">Messy Notes (NLP)</h2>
                    
                    <span class="meta">Posted by Renovamen on July 10, 2020</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>











<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h2 id="优化器">优化器</h2>

<p>损失函数通常为：</p>

\[L(\theta) = \frac{1}{M} \sum_{i=1}^M L(f(x_i, \theta), y_i)\]

<h3 id="无动量">无动量</h3>

<p>每次迭代按梯度方向更新参数，\(r\) 是学习率：</p>

\[\theta_{t+1} = \theta_t - r \cdot \nabla L(\theta_t)\]

<h4 id="bgd">BGD</h4>

<p>Batch Gradient Descent，批量梯度下降，在每一次迭代时使用所有样本来进行梯度更新：</p>

\[\nabla L(\theta) = \frac{1}{M} \sum_{i=1}^M \nabla L(f(x_i, \theta), y_i)\]

<ul>
  <li>
    <p>所有的样本都对参数更新有贡献，凸函数假设下一定能达到全局最优；</p>
  </li>
  <li>
    <p>每次迭代都需要对所有样本进行计算，所以样本太多时，要耗费大量计算资源和时间</p>
  </li>
</ul>

<h4 id="sgd">SGD</h4>

<p>Stochastic Gradient Descent，随机梯度下降，每次迭代随机选一个样本 \(x_i\) 来近似所有样本，并更新梯度：</p>

\[\nabla L(\theta) = \nabla L(f(x_i, \theta), y_i)\]

<ul>
  <li>
    <p>每次参数更新只需要一个样本，速度快</p>
  </li>
  <li>
    <p>计算得到的不是准确梯度，凸函数假设下也不一定有全局最优</p>
  </li>
</ul>

<h4 id="mbgd">MBGD</h4>

<p>Mini-Batch Gradient Descent，小批量梯度下降，对 BGD 和 SGD 的折中，每次迭代用 <strong>m</strong>（batch size）个样本来对参数进行更新：</p>

\[\nabla L(\theta) = \frac{1}{m} \sum_{i=1}^m \nabla L(f(x_i, \theta), y_i)\]

<p>m 是一个远小于总训练样本数 M 的数，通常为 2 的幂次（以充分利用矩阵运算）。为了避免样本的特定顺序给算法收敛带来的影响，一般会在每个 epoch 随机打乱所有样本，然后每次迭代时按顺序选 m 个样本，直到遍历完所有样本。</p>

<ul>
  <li>
    <p>用一个 batch 来近似整体样本的分布情况，降低了随机梯度的方差，提高了算法稳定性</p>
  </li>
  <li>
    <p>通过矩阵运算，用一个 batch 来优化参数并不会比用单个样本来优化参数慢太多</p>
  </li>
</ul>

<h3 id="一阶动量">一阶动量</h3>

<h4 id="polyaks-momentum">Polyak’s Momentum</h4>

<p>最简单的 momentum，又名 Heavy Ball。引入惯性，即每次更新时，在一定程度上保留之前更新的方向：</p>

\[\begin{cases}
   v_t = \rho v_{t-1} - r \cdot \nabla L(\theta_t) \\
   \theta_{t+1} = \theta_t + v_t
\end{cases}\]

\[\Rightarrow \theta_{t+1} = \theta_t - r \cdot \nabla L(\theta_t) + \rho (\theta_t - \theta_{t-1})\]

<p>\(\rho \in [0,1)\) 是 momentum parameter，\(\rho = 0\) 时就相当于原始的梯度下降。\(\rho (\theta_t - \theta_{t-1})\) 就是 Polyak’s momentum。</p>

<ul>
  <li>
    <p>有一定的摆脱局部最优的能力</p>
  </li>
  <li>
    <p>加快收敛速度。这里是一个数学上的解释：<a href="https://spaces.ac.cn/archives/5655" target="_blank">从动力学角度看优化算法：从SGD到动量加速</a>。</p>
  </li>
</ul>

<h4 id="nesterovs-momentum">Nesterov’s Momentum</h4>

<p>Nesterov Accelerated Gradient（NAG），先按照之前的更新方向更新一步，然后在该位置计算梯度，再按梯度方向更新：</p>

\[v_t = \rho v_{t-1} - r \cdot \nabla L(\theta_t + \rho v_{t-1})\]

\[\theta_{t+1} = \theta_t + v_t\]

<p><img src="/img/in-post/2020-07-10/nesterov.jpeg" alt="nesterov update" width="600px" /></p>

<p>梯度不是根据当前参数位置 \(\theta_t\)，而是根据先走了本来计划要走的一步后，达到的参数位置 \(\theta_t + \rho v_{t-1}\) 计算出来的。</p>

<ul>
  <li>比原始 momentum 收敛得更快，<a href="https://zhuanlan.zhihu.com/p/22810533" target="_blank">这里</a>是一个解释，简单来说就是因为 NAG 相对于 momentum 多了一个本次梯度相对上次梯度的变化量（目标函数的二阶导）。</li>
</ul>

<h3 id="二阶动量">二阶动量</h3>

<h4 id="adagrad">AdaGrad</h4>

<p>上述方法对于所有参数都用了同一个学习率，但同一个学习率不一定适合所有参数。不是所有神经网络中的参数都会经常被用到，经常更新的参数可能已经到了仅需要微调的阶段，但偶尔更新的参数可能还需要较大幅度的更新。因此 AdaGrad 的思想是给不同的参数不同的学习率。</p>

<p>引入二阶动量，即该维度上，迄今为止所有梯度值的平方和：</p>

\[g_t = \nabla L(\theta_t)\]

\[h_t = h_{t-1} + g_t^2\]

\[\theta_{t+1} = \theta_t - \frac{r}{\sqrt{h_t + \epsilon}} \cdot g_t\]

<p>\(\epsilon\) 是一个用于保证分母非 0 的平滑项。相当于现在学习率是 \(\frac{r}{\sqrt{h_t + \epsilon}}\)，参数更新越频繁，二阶动量就越大，学习率就越小。</p>

<ul>
  <li>
    <p>给不同参数不同的学习率</p>
  </li>
  <li>
    <p>因为 \(\sqrt{h_t}\) 单调递增，所有学习率会单调递减至（接近）0，可能会使训练过程提前结束</p>
  </li>
</ul>

<h4 id="rmsprop">RMSProp</h4>

<p>为了避免学习率下降过于激进，RMSProp 用了梯度的指数加权移动平均，而不是简单累积所有历史梯度：</p>

\[h_t = \gamma h_{t-1} + (1 - \gamma) g_t^2\]

\[= \gamma^k h_{t-k} + \gamma^k (1 - \gamma) g_{t-k}^2 + ... + (1 - \gamma) g_t^2\]

<p>多了一个超参数 \(\gamma\)。可以看到每次累加的梯度的平方项的权重都是 \(\gamma\) 的指数，所以叫指数加权移动平均。只要通过控制 \(\gamma\) 的大小，就可以使每次累加的梯度信息的权重减小不同的程度。越接近当前时刻，梯度权重就越大，影响也就越大；离当前时刻越远，梯度权重越小，影响也就越小。</p>

\[\theta_{t+1} = \theta_t - \frac{r}{\sqrt{h_t + \epsilon}} \cdot g_t\]

<h4 id="adadelta">AdaDelta</h4>

<p>二阶动量跟 RMSProp 是一样的：</p>

\[h_t = \gamma h_{t-1} + (1 - \gamma) g_t^2\]

<p>但没有学习率这个超参数，而是维护了一个能够根据梯度信息自动变化的量 \(\Delta \theta\)：</p>

\[g'_t = \sqrt{\frac{\Delta \theta_{t-1} + \epsilon}{h_t + \epsilon}} \cdot g_t\]

\[\Delta \theta_t = \gamma \Delta \theta_{t-1} + (1 - \gamma) (g'_t)^2\]

\[\theta_t = \theta_{t-1} - g'_t\]

<p>如果不考虑 \(\epsilon\)，可以看做是用 \(\sqrt{\Delta \theta_{t-1}}\) 代替了 RMSProp 中的学习率 \(r\)。</p>

<h3 id="adam">Adam</h3>

<p>Adaptive Moment Estimation，考虑了一阶动量和二阶动量，可以理解为 momentum + RMSprop：</p>

\[v_t = \rho_1 v_t + (1 - \rho_1) g_t\]

\[h_t = \rho_2 h_{t-1} + (1 - \rho_2) g_t^2\]

<p>初始化：\(v_0 = 0, h_0 = 0\)，这个初始化值跟真实值有偏差。而初期的更新幅度会很大，会严重受到初始化偏差的影响，所以有偏差修正（<a href="https://stats.stackexchange.com/questions/232741/why-is-it-important-to-include-a-bias-correction-term-for-the-adam-optimizer-for" target="_blank">这里</a>是更详细的解释）：</p>

\[\hat{v}_t = \frac{m_t}{1 - \rho^t_1}\]

\[\hat{h}_t = \frac{h_t}{1 - \rho^t_2}\]

<p>偏差修正在初期的影响比较大，后期的影响会越来越小。</p>

<p>最终的参数更新：</p>

\[\theta_t = \theta_{t-1} - r \cdot \frac{\hat{v}_t}{\sqrt{\hat{h}_t + \epsilon}}\]

<h3 id="参考">参考</h3>

<ul>
  <li>
    <p><a href="http://www.cs.toronto.edu/~tijmen/csc321/slides/lecture_slides_lec6.pdf" target="_blank">CSC321 -	Lecture	6a: Overview of	mini-batch gradient descent </a></p>
  </li>
  <li>
    <p><a href="https://cs231n.github.io/neural-networks-3/" target="_blank">CS231n - Neural Networks Part 3: Learning and Evaluation</a></p>
  </li>
  <li>
    <p><a href="https://ruder.io/optimizing-gradient-descent/index.html" target="_blank">An overview of gradient descent optimization algorithms</a></p>
  </li>
</ul>

<h2 id="词向量">词向量</h2>

<h3 id="统计方法">统计方法</h3>

<h4 id="one-hot">one-hot</h4>

<p>最简单的词向量。设词典大小为 n，则每个词的向量为一个 n 维向量，向量中其对应位置上的值为 1，其他位置都是 0。</p>

<ul>
  <li>
    <p>维度灾难：特征维度过高导致样本稀疏，造成计算困难</p>
  </li>
  <li>
    <p>语义鸿沟：无法通过词向量之间的距离来反映词之间的相似程度（任意两个向量的距离是相同的）</p>
  </li>
  <li>
    <p>无法反映文本的有序性</p>
  </li>
</ul>

<p>为了将语义融入到词表示中，有了<strong>分布式假说（distributional hypothesis）</strong>：词的语义由其上下文决定。后面的词表示方法都是基于分布式假说。</p>

<h4 id="共现矩阵">共现矩阵</h4>

<p>共现矩阵（Co-occurrence Matrix）是由一个指定大小的窗口内的单词共现次数构成的矩阵，如对于以下语料：</p>

<ul>
  <li>I like deep learning.</li>
  <li>I like NLP.</li>
  <li>I enjoy flying.</li>
</ul>

<p>当窗口大小为 3（左右长度都为 1）时，共现矩阵为：</p>

<p><img src="/img/in-post/2020-07-10/co-matrix.png" alt="Co-occurrence Matrix" width="500px" /></p>

<p>可以想到的方法是把共现矩阵的行或列作为单词的词向量：</p>

<ul>
  <li>
    <p>能够在一定程度上表现单词之间的语义关系，相比 one-hot 有了一定的提升</p>
  </li>
  <li>
    <p>没有解决维度灾难问题</p>
  </li>
</ul>

<h4 id="svd">SVD</h4>

<p>SVD（Singular Value Decomposition，奇异值分解）的思想是对共现矩阵中得到的词向量进行降维，从而得到一个稠密的连续词向量。</p>

<p>奇异值分解可以对任意大小的矩阵 \(A\) 进行分解：</p>

\[A = U \Sigma V^T\]

<p>其中，\(A \in R^{m \times n}\)；\(U \in R^{m \times m}\)，各个向量相互正交，被称为左奇异矩阵；\(\Sigma \in R^{m \times n}\)，仅在对角线上有值，被称为奇异值；\(V \in R^{n \times n}\)，各个向量也相互正交，被称为右奇异矩阵。具体分解原理可以参考<a href="https://www.cnblogs.com/endlesscoding/p/10033527.html" target="_blank">这里</a>。</p>

<p>奇异值是从大到小排列的，可以认为奇异值代表了特征的权重。通常前 10% 甚至 1% 的奇异值的和就占了所有奇异值和的 99% 以上，所以一般会选择用 \(U\) 的前 \(k\) 维来代表词向量矩阵，最终词向量矩阵大小为 \(m \times k\)，\(m\) 为词典大小，\(k\) 为词向量维度。</p>

<ul>
  <li>
    <p>能够在一定程度上表现单词之间的语义关系</p>
  </li>
  <li>
    <p>利用了全局语料特征</p>
  </li>
  <li>
    <p>矩阵过于稀疏，因为在构建共现矩阵时，有很多词是没有共现的</p>
  </li>
  <li>
    <p>矩阵分解复杂度高</p>
  </li>
  <li>
    <p>需要手动去除高频无意义的停用词（如 is、a 等），否则会影响共现矩阵分解的效果</p>
  </li>
</ul>

<h3 id="浅层词嵌入">浅层词嵌入</h3>

<p>通常采用浅层网络进行训练（浅层词嵌入，Non-Contextual Embeddings），主要缺陷为：</p>

<ul>
  <li>
    <p>词向量与上下文无关，每个单词的词向量始终是相同的（静态），无法解决一词多义问题</p>
  </li>
  <li>
    <p>OOV（Out of Vocabulary）问题。一种解决方法是引入字符级（CharCNN）或 subword（fastText）表示</p>
  </li>
</ul>

<h4 id="nnlm">NNLM</h4>

<p><strong>A Neural Probabilistic Language Model.</strong> <em>Bengio, Yoshua, et al.</em> Journal of Machine Learning Research. <a href="http://www.jmlr.org/papers/volume3/bengio03a/bengio03a.pdf" target="_blank">[Paper]</a></p>

<p>NNLM（Neural Network Language Model，神经网络语言模型）即用神经网络训练得到一个语言模型，同时产生副产物词向量。其思想为：</p>

<ul>
  <li>
    <p>假定词典中的每个单词都对应一个连续的特征向量</p>
  </li>
  <li>
    <p>假定一个连续平滑的概率模型，输入为前 n-1 个单词的词向量，输出为一个维度为词表大小的向量，代表每个词出现的概率</p>
  </li>
  <li>
    <p>同时学习词向量的权重和 n 元组（ngram）模型里的参数</p>
  </li>
</ul>

<p>其主要计算量在隐藏层上。softmax 层也是一个计算瓶颈，因为需要对词典中所有词都计算一遍条件概率。</p>

<ul>
  <li>
    <p>词向量只是一个副产物，由于其巨大的参数空间，NNLM 的训练很慢</p>
  </li>
  <li>
    <p>使用的是全连接神经网络，因此只能处理定长序列（不过后来的 RNNLM 解决了这个问题）</p>
  </li>
</ul>

<h4 id="word2vec">word2vec</h4>

<p><strong>Efficient Estimation of Word Representations in Vector Space.</strong> <em>Tomas Mikolov, et al.</em> ICLR 2013. <a href="https://arxiv.org/pdf/1301.3781.pdf" target="_blank">[Paper]</a></p>

<p><strong>Distributed Representations of Words and Phrases and their Compositionality.</strong> <em>Tomas Mikolov, et al.</em> NIPS 2013. <a href="https://papers.nips.cc/paper/5021-distributed-representations-of-words-and-phrases-and-their-compositionality.pdf">[Paper]</a></p>

<p>具体原理和数学推导可以参考这里：<a href="https://blog.csdn.net/itplus/article/details/37969519" target="_blank">word2vec 中的数学原理详解</a></p>

<p>word2vec 的本质依然是语言模型，但是它的目标并不是语言模型本身，而是词向量。所以它所采取的一系列优化都是为了更快更好的得到词向量。</p>

<h5 id="两种模型">两种模型</h5>

<h6 id="cbow">CBOW</h6>

<p>利用给定上下文 \(\text{Context}(w)\)（单词 \(w\) 的前后共 \(l\) 个词）预测单词 \(w\)，目标函数为（\(C\) 为语料库）：</p>

\[L = \sum_{w \in C} \log p(w | \text{Context}(w))\]

<h6 id="skip-gram">Skip-gram</h6>

<p>利用给定单词 \(w\) 来预测上下文 \(\text{Context}(w)\)，目标函数为：</p>

\[L = \sum_{w \in C} \log p(\text{Context}(w) | w)\]

\[p(\text{Context}(w) | w) = \prod_{u \in \text{Context}(w)} p(u | w)\]

<h5 id="两个优化方法">两个优化方法</h5>

<h6 id="hierarchical-softmax">Hierarchical Softmax</h6>

<p>Hierarchical Softmax（层次化 Softmax）会先构造一个哈夫曼树（Huffman Coding），然后将复杂的归一化概率问题转化为一系列二分类的条件概率相乘的形式，从而将目标概率的计算复杂度从 \(V\) 降到 \(\log_2V\)，\(V\) 为词典大小。</p>

<p>哈夫曼树又称为最优二叉树，表示一种带权路径长度最短的二叉树。带权路径长度：叶子结点的权值 * 该结点到根结点的路径长度。</p>

<p>这里构造的哈夫曼树的根节点是整个词典，每一个子节点为父节点的两个不相交子集，每个单词都是一个叶子节点，叶子节点的权值为词频。带权路径最小的条件保证了哈夫曼树中，高频词离根结点更近，而低频词离根结点更远。</p>

<p><img src="/img/in-post/2020-07-10/huffman.jpg" alt="Huffman" width="400px" /></p>

<p>考虑单词 \(w\) 对应的叶子节点，记：</p>

<ul>
  <li>
    <p>\(p^w\)：从根节点到 \(w\) 对应的叶子节点的路径</p>
  </li>
  <li>
    <p>\(l^w\)：路径 \(p^w\) 中包含的节点个数</p>
  </li>
  <li>
    <p>\(d^w_2, d^w_3, \dots , d^w_{l^w} \in \{ 0, 1 \}\)：词 \(w\) 的哈夫曼编码，共 \(l^w - 1\) 位（根节点不对应编码），\(d^w_j\) 表示路径 \(p^w\) 中第 \(j\) 个节点对应的编码</p>
  </li>
  <li>
    <p>\(\theta^w_1, \theta^w_2, \dots , \theta^w_{l^w-1}\)：\(\theta^w_j\) 表示路径 \(p^w\) 中第 \(j\) 个非叶子结点的对应的向量，作为求条件概率的参数</p>
  </li>
</ul>

<p>假设根结点为词典 \(D\)，则第二层的两个子节点分别为 \(D\) 的两个子集 \(D_1\) 和 \(D_2\)。左子节点的哈夫曼编码为 0（负类），右子节点为 1（正类）。</p>

<p><strong>CBOW</strong></p>

<p>则在给定上下文的情况下，由二分类逻辑回归可知，第 \(j\) 个节点被分为正类（即 \(w_t \in D_2\)）的概率为：</p>

\[p(d_j^w | x_w , \theta_{j-1}^w) = \sigma(x_w^{\top} \theta) = \frac{1}{1 + e^{-x_w^{\top} \theta}}\]

<p>分为负类（即 \(w_t \in D_1\)）的概率为：</p>

\[p(d_j^w | x_w , \theta_{j-1}^w) = 1 - \sigma(x_w^{\top} \theta)\]

<p>其中，\(x_w\) 为相加后的上下文词向量。最终的条件概率为：</p>

\[p(w | \text{Context}(w)) = \prod_{j=2}^{l^w} p(d_j^w | x_w , \theta_{j-1}^w)\]

<p><strong>Skip-gram</strong></p>

<p>条件概率函数为：</p>

\[p(\text{Context}(w) | w) = \prod_{u \in \text{Context}(w)} p(u | w)\]

\[p(u | w) = \prod_{j=2}^{l^u} p(d_j^u | v(w) , \theta_{j-1}^u)\]

<p>其中 \(v(w)\) 是单词 \(w\) 的词向量。</p>

<p> </p>

<p>然后对条件概率函数求最大似然即可，具体公式上面引用的那篇<a href="https://blog.csdn.net/itplus/article/details/37969979" target="_blank">博客</a>里有。</p>

<ul>
  <li>
    <p>时间复杂度从 \(O(V)\) 降到 \(O(\log_2V)\)</p>
  </li>
  <li>
    <p>人为增强了词与词之间的耦合性。如果一个词的条件概率出现变化，会影响到其路径上所有非叶节点的概率变化，间接地对其他词的条件概率造成影响。所以构造合适的二叉树非常重要。</p>
  </li>
</ul>

<h6 id="negative-sampling">Negative Sampling</h6>

<p>Negative-Sampling（NEG，负采样）可以作为 Hierarchical Softmax 的一种替代，它不再使用哈夫曼树，而是使用相对简单的随机负采样。</p>

<p><strong>CBOW</strong></p>

<p>对于给定的 \(\text{Context}(w)\)，单词 \(w\) 是一个正样本，其他词都是负样本。我们希望最大化：</p>

\[g(w) = \prod_{u \in \{w\} \cup NEG(w)} p(u | \text{Context}(w))\]

\[p(u | \text{Context}(w)) = 

\begin{cases}
   \sigma(x_w^{\top} \theta^u),      &amp;u \text{为正样本} \\
   1 - \sigma(x_w^{\top} \theta^u),  &amp;u \text{为负样本}
\end{cases}\]

<p>其中 \(NEG(w)\) 是采样出的关于 \(w\) 的负样本子集。把上面两个式子合起来可以得到：</p>

\[g(w) = \sigma(x_w^{\top} \theta^w) \prod_{u \in NEG(w)} [1 - \sigma(x_w^{\top} \theta^u)]\]

<p>其中，\(\sigma(x_w^{\top} \theta^w)\) 为预测中心词为 \(w\) 的概率，\(\sigma(x_w^{\top} \theta^u)\) 为预测中心词为 \(u\) 的概率。因此最大化 \(g(w)\) 就相当于最大化 \(\sigma(x_w^{\top} \theta^w)\)（正样本概率），同时最小化所有的 \(\sigma(x_w^{\top} \theta^u)\)（负样本概率）。</p>

<p>目标函数为：</p>

\[G = \prod_{w \in C} g(w)\]

<p><strong>Skip-gram</strong></p>

<p>目标函数为：</p>

\[G = \prod_{w \in C} \prod_{u \in \text{Context}(w)} g(u)\]

<p>其中：</p>

\[g(u) = \prod_{z \in \{u\} \cup NEG(u)} p(z | w)\]

\[p(z | w) = 

\begin{cases}
   \sigma(v(w)^{\top} \theta^z),      &amp;z \text{为正样本} \\
   1 - \sigma(v(w)^{\top} \theta^z),  &amp;z \text{为负样本}
\end{cases}\]

<p><strong>负采样算法</strong></p>

<p>需要采样出负样本子集 \(NEG(W)\)。负采样算法是一个带权采样过程，即高频词被选为负样本的概率应该比较大，而低频词被选中的概率应该比较小。</p>

<p>设词典 \(D\) 中每一个单词 \(w\) 对应一个线段 \(l(w)\)，长度为：</p>

\[\text{len}(w) = \frac{[\text{count}(w)]^{\frac{3}{4}}}{\sum_{u \in D} [\text{count}(w)]^{\frac{3}{4}}}\]

<p>然后把这些线段首尾相接拼在一起，形成一个长度为 1 的线段（相当于对区间 \([0,1]\) 做非等距切分）。然后再引入一个区间 \([0,1]\) 上的 \(M\) 等距切分，其中 \(M &gt;&gt; N\)（word2vec 源码中 \(M = 10^8\)）。然后即可建立这两个切分的映射关系，如下图所示：</p>

<p><img src="/img/in-post/2020-07-10/neg.jpg" alt="NEG" width="500px" /></p>

<p>采样时，每次生成一个 \([1, M-1]\) 之间的整数 \(i\)，则 \(m_i\) 对应的线段对应的单词就是一个样本。当碰巧采样到自己（正样本）时，则跳过。</p>

<h5 id="特点">特点</h5>

<ul>
  <li>
    <p>为了提高计算效率，将词向量直接相加（NNLM 中是把词向量拼接）</p>
  </li>
  <li>
    <p>舍弃了 NNLM 中的隐层，只有一个投影层（用于累加词向量）</p>
  </li>
  <li>
    <p>真正考虑了上下文（NNLM 的输入严格来说只有上文）</p>
  </li>
  <li>
    <p>hierarchical softmax 和 negative sampling 优化</p>
  </li>
  <li>
    <p>只用了局部语料（特征提取基于滑窗）</p>
  </li>
</ul>

<h4 id="glove">GloVe</h4>

<p><strong>GloVe: Global Vectors for Word Representation.</strong> <em>Jeffrey Pennington, et al.</em> EMNLP 2014. <a href="https://www.aclweb.org/anthology/D14-1162.pdf" target="_blank">[Paper]</a></p>

<p>GloVe（Global Vectors for Word Representation）可以看做是 SVD 和 word2vec 的结合，它先构建一个<a href="#共现矩阵">共现矩阵</a> \(X\)，矩阵中的元素 \(X_i\) 为单词 \(i\) 和上下文单词 \(j\) 在指定大小的上下文窗口中共同出现的次数。</p>

<p>然后构建词向量和共现矩阵之间的近似关系，目标函数为：</p>

\[J = \sum_{i,j}^N f(X_{ij}) (w_i^{\top} \tilde{w}_j + b_i + b_j - \log X_{ij})\]

<p>这两篇博客推导了目标函数是怎么来的：<a href="https://blog.csdn.net/coderTC/article/details/73864097" target="_blank">理解 GloVe 模型</a>、<a href="http://www.fanyeong.com/2018/02/19/glove-in-detail/" target="_blank">GloVe 详解</a>。</p>

<p>可以认为它的 label 是 \(\log X_{ij}\)。\(w\) 和 \(\tilde{w}\) 是两个不同的词向量，因为共现矩阵 \(X\) 是对称的，所以理论上 \(w\) 和 \(\tilde{w}\) 也应该是对称的，但它们初始化的值不一样，所以最终的结果也不一样。为了提高鲁棒性，会用 \(w + \tilde{w}\) 作为最终的词向量。</p>

<p>这个目标函数就是一个均方差损失（Mean Square Error，MSE），只不过基于出现频率越高的词对权重应该越大的原则，还加了一个权重函数 \(f(\cdot)\)（论文里 \(\alpha\) 取 \(\frac{3}{4}\)）：</p>

\[f(x) = 

\begin{cases}
    (x / x_{max})^{\alpha}  &amp;\text{if } x &lt; x_{max} \\
    1                       &amp;\text{otherwise}
\end{cases}\]

<p><img src="/img/in-post/2020-07-10/glove-weighting-function.png" alt="Weighting Function" width="400px" /></p>

<p>该函数满足以下条件：</p>

<ul>
  <li>
    <p>非减函数</p>
  </li>
  <li>
    <p>到达一定程度之后不再增加（因为不希望权重过大）</p>
  </li>
  <li>
    <p>如果两个单词没有在一起出现，即 \(X_{ij}=0\)，那么他们应该不参与到损失函数的计算中，所以需要有 \(f(0) = 0\)</p>
  </li>
</ul>

<p>GloVe 的特点：</p>

<ul>
  <li>
    <p>相比 SVD，GloVe 时间复杂度更低</p>
  </li>
  <li>
    <p>相比 word2vec，GloVe 用了全局语料，需要事先统计共现概率</p>
  </li>
  <li>
    <p>word2vec 的损失函数是带权重的交叉熵，GloVe 的损失函数是带权重的均方差损失</p>
  </li>
</ul>

<h4 id="fasttext">fastText</h4>

<p>模型结构与 CBOW 一样。</p>

<p>用于计算词向量时：</p>

<ul>
  <li>
    <p>无监督</p>
  </li>
  <li>
    <p>局部语料</p>
  </li>
  <li>
    <p>相比 CBOW，考虑了 subword，最终的词向量是 subword 向量和的叠加。这样做的优点：</p>

    <ul>
      <li>
        <p>对于低频词生成的词向量效果会更好，因为它们的 subword 可以和其它词共享</p>
      </li>
      <li>
        <p>对于训练集之外的单词，依然可以构建它们的词向量（叠加它们的 subword 向量）</p>
      </li>
    </ul>
  </li>
</ul>

<p>用于文本分类时：</p>

<ul>
  <li>
    <p>有监督，预测句子的类别标签</p>
  </li>
  <li>
    <p>引入 ngrams，考虑词序特征</p>
  </li>
  <li>
    <p>引入 subword 来处理长词、未登陆词</p>
  </li>
  <li>
    <p>hierarchical softmax 优化，对输出的分类标签建立哈夫曼树，样本中标签多的类别离根节点更近</p>
  </li>
</ul>

<h3 id="预训练编码器">预训练编码器</h3>

<p>通过一个能够输出上下文相关的词向量的预训练编码器来解决一词多义的问题。这类预训练编码器输出的向量被称为「上下文相关的词嵌入（contextual word embeddings）」。</p>

<p>主要代表有 ELMo、GPT、BERT、XLNet 等，总结在<a href="#预训练模型">预训练模型</a>一节。</p>

<h3 id="参考-1">参考</h3>

<ul>
  <li>
    <p>语言模型综述：<a href="https://arxiv.org/pdf/1906.03591.pdf" target="_blank">A Survey on Neural Network Language Models</a></p>

    <p>中文翻译：<a href="https://zhuanlan.zhihu.com/p/109564205" target="_blank">神经网络语言模型综述</a></p>
  </li>
  <li>
    <p>预训练模型综述：<a href="https://arxiv.org/pdf/2003.08271.pdf" target="_blank">Pre-trained Models for Natural Language Processing: A Survey</a></p>
  </li>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/115014536" target="_blank">PTMs：NLP 预训练模型的全面总结</a></p>
  </li>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/56382372" target="_blank">NLP 中的词向量对比</a></p>
  </li>
  <li>
    <p><a href="https://www.cnblogs.com/sandwichnlp/p/11596848.html" target="_blank">词向量（one-hot/SVD/NNLM/Word2Vec/GloVe）</a></p>
  </li>
  <li>
    <p><a href="https://www.6aiq.com/article/1586815086168" target="_blank">【语言模型系列】原理篇一：从 one-hot 到 Word2vec</a></p>
  </li>
</ul>

<h2 id="预训练模型">预训练模型</h2>

<p><img src="/img/in-post/2020-07-10/PTMs.jpg" alt="Pre-trained Models" /></p>

<p class="desc">预训练模型分类（来源：<a href="https://zhuanlan.zhihu.com/p/115014536" target="_blank">PTMs：NLP预训练模型的全面总结</a>)</p>

<p>预训练模型（Pre-trained Models）会学习带有上下文的 contextual embedding，词的表征可以根据上下的语境而动态改变。给定一个文本序列 \(x_1, x_2, \dots, x_T\)，\(x_t\) 的 contextual embedding（或者叫 dynamical embedding）\(h_t\) 依赖于整个文本：</p>

\[[h_1, h_2, \dots, h_T] = f_{\text{enc}} (x_1, x_2, \dots, x_T)\]

<p>\(f_{\text{enc}}(\cdot)\) 就是下图中的 contextual encoder：</p>

<p><img src="/img/in-post/2020-07-10/contextual-embedding.png" alt="Contextual Embeddings" width="500px" /></p>

<p class="desc">图片来源：<a href="https://arxiv.org/pdf/2003.08271.pdf" target="_blank">Pre-trained Models for Natural Language Processing: A Survey</a></p>

<p>输入为文本序列的 one-hot 编码，经过 embedding 层得到 non-contextual embeddings，然后经过 contextual encoder 得到 contextual embeddings。embedding 层和 contextual encoder 都需要学习。</p>

<p>绝大多数预训练模型用的是自监督学习，<a href="https://arxiv.org/pdf/2003.08271.pdf" target="_blank">这篇</a>综述把基于自监督学习的预训练模型分为了两类：基于上下文（Context Based）和基于对比（Contrastive Based）。而基于上下文的预训练模型所用的语言模型可以分为：</p>

<ul>
  <li>
    <p><strong>自回归语言模型（Aotoregressive Lanuage Modeling）</strong></p>

    <p>依据前面（或后面）出现的 token 来预测当前时刻的 token，代表模型有 ELMo、GTP 等。</p>

\[p(x_{1:T}) = \prod_{t=1}^T p(x_t | x_{0:t-1})\]

    <p>特点：</p>

    <ul>
      <li>
        <p>语言模型联合概率的无偏估计（即传统的语言模型），考虑被预测 token 之间的相关性，天然适合处理生成任务（所以 GPT 能编故事，BERT 编不太了）</p>
      </li>
      <li>
        <p>只能获取单方向的信息</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>自编码语言模型（Autoencoding Language Modeling）</strong></p>

    <p>通过上下文信息来预测当前被 mask 的 token，代表模型有 BERT 等。</p>

\[p(x_{1:T}) = \sum_{t=1}^T m_t \log p(x_t | \hat{x})\]

    <p>其中 \(\hat{x}\) 为上下文，即加噪后的文本序列；如果当前 token 需要被预测，\(m_t=1\)，否则 \(m_t=0\)。</p>

    <p>特点：</p>

    <ul>
      <li>
        <p>通过引入噪声「MASK」来获取双向上下文信息表示</p>
      </li>
      <li>
        <p>引入独立性假设，为语言模型联合概率的有偏估计，没有考虑预测 token 之间的相关性</p>
      </li>
      <li>
        <p>预训练（DAE；有「MASK」）与微调（Autogressive LM；，无「MASK」）模式不匹配</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>排列语言模型（Permuted Language Model）</strong></p>
  </li>
</ul>

<h3 id="elmo">ELMo</h3>

<p><strong>Deep contextualized word representations.</strong> <em>Matthew E. Peters, et al.</em>  NAACL-HLT 2018. <a href="https://www.aclweb.org/anthology/N18-1202.pdf" target="_blank">[Paper]</a> <a href="https://github.com/allenai/bilm-tf" target="_blank">[Code]</a></p>

<p>自回归语言模型。编码器是双层双向 LSTM，每层的两个单向 LSTM（前向和后向）直接拼接。并未进行双向信息的融合，所以不会出现标签泄漏。（<a href="https://www.zhihu.com/question/322034410/answer/794201004" target="_blank">这里</a>是对标签泄漏的更详细的解释）</p>

<p><img src="/img/in-post/2020-07-10/elmo.png" alt="ELMo" /></p>

<p class="desc">图片来源：<a href="https://www.aclweb.org/anthology/N19-1423.pdf" target="_blank">BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding</a></p>

<p>ELMo 中每一层的输出向量都有不同的含义：E1 是单词特征，E2 是句法特征，E3 是语义特征。下游任务在使用词向量时，会通过一些方式将每一层的向量融合得到预训练词向量，然后将该向量与下游任务的词向量进行拼接得到最终的词向量。</p>

<h3 id="gpt-1">GPT-1</h3>

<p><strong>Improving Language Understanding by Generative Pre-Training.</strong> <em>Alec Radford, et al.</em> <a href="https://cdn.openai.com/research-covers/language-unsupervised/language_understanding_paper.pdf" target="_blank">[Paper]</a> <a href="https://github.com/openai/finetune-transformer-lm" target="_blank">[Code]</a></p>

<p>自回归语言模型。编码器是 Transformer 的 decoder 部分（首次将 Transformer 应用于预训练语言模型），decoder 部分只能使用单向信息，即只使用上文预测当前词，无法获取上下文相关的特征表示。</p>

<p>相比 ELMo：</p>

<ul>
  <li>
    <p>编码器从 BiLSTM 变成 Transformer</p>
  </li>
  <li>
    <p>只用上文信息而不使用下文</p>
  </li>
  <li>
    <p>进行下游任务时，直接在预训练模型上进行 fine-tuning，而不是直接用现成的词向量</p>
  </li>
</ul>

<h3 id="bert">BERT</h3>

<p><strong>BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding.</strong> <em>Jacob Devlin, et al.</em> NAACL-HLT 2019. <a href="https://www.aclweb.org/anthology/N19-1423.pdf" target="_blank">[Paper]</a> <a href="https://nlp.stanford.edu/seminar/details/jdevlin.pdf" target="_blank">[Slide]</a> <a href="https://github.com/google-research/bert" target="_blank">[Code]</a></p>

<p>自编码语言模型。编码器是 Transformer 的 encoder 部分，更够利用双向信息。</p>

<p><img src="/img/in-post/2020-07-10/bert.png" alt="BERT" /></p>

<p>BERT 还在 Transformer-Encoder 的基础上做了 mask 操作（Masked Language Model，MLM），即随机 mask 掉输入序列的部分 tokens，然后只预测被 mask 掉的 tokens。MLM 能够更好的获取双向上下文特征表示，也能解决深度 Transformer 带来的标签泄露（see itself）的问题。标签泄露指，Transformer 自带的全局 self-attention 会将上下文的词编码到当前模型里，所以在预测其他词的时候，该词的信息已经包含在了前一层的网络参数里：</p>

<p><img src="/img/in-post/2020-07-10/see-itself.jpg" alt="see itself" width="400px" /></p>

<p>BERT 的特点：</p>

<ul>
  <li>
    <p>能够获取上下文相关的双向特征表示</p>
  </li>
  <li>
    <p>在生成任务上表现不佳：预训练（DAE；有「MASK」标记）与微调（Autogressive LM；无「MASK」标记）模式不匹配</p>
  </li>
  <li>
    <p>引入了独立性假设，为语言模型联合概率的有偏估计，没有考虑预测「MASK」之间的相关性</p>
  </li>
</ul>

<h3 id="xlnet">XLNet</h3>

<p><strong>XLNet: Generalized Autoregressive Pretraining for Language Understanding.</strong> <em>Zhilin Yang, et al.</em> NIPS 2019. <a href="http://papers.nips.cc/paper/8812-xlnet-generalized-autoregressive-pretraining-for-language-understanding.pdf">[Paper]</a> <a href="https://github.com/zihangdai/xlnet" target="_blank">[Code]</a></p>

<h3 id="参考-2">参考</h3>

<ul>
  <li>
    <p>语言模型综述：<a href="https://arxiv.org/pdf/1906.03591.pdf" target="_blank">A Survey on Neural Network Language Models</a></p>

    <p>中文翻译：<a href="https://zhuanlan.zhihu.com/p/109564205" target="_blank">神经网络语言模型综述</a></p>
  </li>
  <li>
    <p>预训练模型综述：<a href="https://arxiv.org/pdf/2003.08271.pdf" target="_blank">Pre-trained Models for Natural Language Processing: A Survey</a></p>
  </li>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/115014536" target="_blank">PTMs：NLP 预训练模型的全面总结</a></p>
  </li>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/76912493" target="_blank">NLP 中的预训练语言模型总结</a></p>
  </li>
  <li>
    <p><a href="https://www.6aiq.com/article/1587401784826" target="_blank">【语言模型系列】原理篇二：从 ELMo 到 ALBERT</a></p>
  </li>
</ul>

<h2 id="batch-normalization">Batch Normalization</h2>

<p><strong>Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift.</strong> <em>Sergey Ioffe and Christian Szegedy.</em> ICML 2015. <a href="http://proceedings.mlr.press/v37/ioffe15.pdf" target="_blank">[Paper]</a></p>

<p>Inception V2 的论文，重要贡献之一是提出了 Batch Normalization（BN，批标准化）。</p>

<h3 id="参考-3">参考</h3>

<ul>
  <li>
    <p><a href="https://www.cnblogs.com/guoyaohua/p/8724433.html" target="_blank">深入理解 Batch Normalization 批标准化</a></p>
  </li>
  <li>
    <p><a href="https://kratzert.github.io/2016/02/12/understanding-the-gradient-flow-through-the-batch-normalization-layer.html" target="_blank">Understanding the backward pass through Batch Normalization Layer</a></p>
  </li>
</ul>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2020/03/17/papers-reading/" data-toggle="tooltip" data-placement="top" title="三月大锅烩">
                        Previous<br>
                        <span>三月大锅烩</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/07/17/transformer/" data-toggle="tooltip" data-placement="top" title="Transformer">
                        Next<br>
                        <span>Transformer</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">
                
                <section class="author-profile">
    <div class="info"> 
        <div class="avatar">
            <img src="/img/header-avatar.jpeg">
        </div>
        <h1>Renovamen</h1>
    </div>
    <span>
        <a href="https://www.jinrishici.com/" target="_blank">
            <i class="fas fa-pencil-alt"></i>
        </a>
        <p id="poem-item">作诗中...</p>
        <br><p id="poem-info"></p>
    </span>
</section>
                
                
                    <!-- Comment container -->

<!-- disqus -->

<div class="comment">
    <div id="gitalk-container"></div>
</div>

<!-- Valine -->

                
            </div>  

            <!-- Side Catalog Container -->
            
                <!-- Side Catalog Container -->
<div class="
    col-lg-2 col-lg-offset-0
    sidebar-container
    catalog-container">
    <div class="side-catalog">
        <hr class="hidden-sm hidden-xs">
        <h5>
            <a class="catalog-toggle" href="#">CATALOG</a>
        </h5>
        <ul class="catalog-body"></ul>
    </div>
</div>
            
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>

<script>
    $("script[type='math/tex']").replaceWith(function() {
        var tex = $(this).text();
        return katex.renderToString(tex, {displayMode: false});
    });
  
    $("script[type='math/tex; mode=display']").replaceWith(function() {
        var tex = $(this).html();
        return katex.renderToString(tex.replace(/%.*/g, ''), {displayMode: true});
    });
</script>
    


<!-- Renovamen: add support for chart and mermaid -->

    <!-- Borrowed from: https://github.com/kitian616/jekyll-TeXt-theme -->
<!-- Chart.js: https://www.chartjs.org/docs/latest/ -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js", function(){
        var $canvas = null, $this = null, _ctx = null, _text = '';
        $('.language-chart').each(function(){
            $this = $(this);
            $canvas = $('<canvas></canvas>');
            _text = $this.text();
            $this.text('').append($canvas);
            _ctx = $canvas.get(0).getContext('2d');
            (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
        });
    })

    $('.language-chart').parent().css({
        "background-color": "transparent",
        "border": "none",
    });
</script>





    <!-- Borrowed from: https://github.com/kitian616/jekyll-TeXt-theme -->
<!-- mermaid.js: https://mermaid-js.github.io/mermaid/ -->
<script>
    LazyLoad.js('https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js', function() {
        mermaid.initialize({
            startOnLoad: true
        });
        mermaid.init(undefined, '.language-mermaid');
    });

    $('.language-mermaid').parent().css({
        "background-color": "transparent",
        "border": "none",
    });
</script>


<!-- Renovamen: add support for additional emoji -->

    <script>
$('.emoji-plus').each(function(){
    var $this = $(this);
    var imgURL = '/img/emoji/bilitv/' + $this.text() + '.gif';
    var $img = $('<img class="emoji-plus" src="' + imgURL + '" height="30" width="30">');
    $this.replaceWith($img);
});
</script>


<!-- comment -->

    <!-- Gitalk start -->
<script type="text/javascript">
    LazyLoad.js(['/js/library/md5.js ', 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js'], function(){
        var gitalk = new Gitalk({
            clientID: 'd6247712dc288a5a60ca',
            clientSecret: 'ed1ec72417828343c79ed910a1b77d140fa715a7',
            repo: 'gitalk-comments',
            owner: 'This-is-an-Apple',
            admin: ['Renovamen', 'This-is-an-Apple'],
            id: md5(location.pathname),
            distractionFreeMode: false
        });
        gitalk.render('gitalk-container');
    })
</script>
<!-- Gitalk end -->






    <!-- anchor.js: http://bryanbraun.github.io/anchorjs/ -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/anchor-js@4.2.2/anchor.min.js", function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


<!-- Renovamen: add support 今日诗词: https://www.jinrishici.com/ -->
<script type="text/javascript">
    LazyLoad.js(['https://sdk.jinrishici.com/v2/browser/jinrishici.js'], function(){
        jinrishici.load(function(result) {
            var poem = document.querySelector('#poem-item');
            var info = document.querySelector('#poem-info');

            if (result.status === "success") {
                var data = result.data
                console.log(data)
                poem.innerHTML = data.content;
                info.innerHTML = '【' + data.origin.dynasty + '】' + data.origin.author + '《' + data.origin.title + '》';
            }
        });
    })
</script>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                <!-- 


<div class="list-inline text-center">

  
  <a target="_blank" href="https://github.com/Renovamen">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-github-alt fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.linkedin.com/in/xiaohan-zou-55bba0160">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.facebook.com/renovamen.zou">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://twitter.com/renovamen_zxh">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.zhihu.com/people/chao-neng-gui-su">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-stack-1x fa-inverse">知</i>
    </span>
  </a>
  
  
  
  <a href="mailto:renovamenzxh@gmail.com">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="/feed.xml">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
</div> -->
                <p class="copyright">
                    &copy; <a href="https://github.com/Renovamen" target="_blank">Renovamen</a> 2018
                    <br>
                    Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & <a href="https://github.com/Renovamen/renovamen.github.io" target="_blank">Gungnir</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<!-- Renovamen: has been included in `head.html` already -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script> -->

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<!-- Renovamen: Maybe don't need this anymore -->
<!-- <script src="/js/library/bootstrap.min.js "></script> -->

<!-- add dark / light detection -->
<!-- dark / light detection, borrowed from gridsome.org -->
<script>
  (function() {
    window.__onThemeChange = function() {};
    function setTheme(newTheme) {
      window.__theme = newTheme;
      preferredTheme = newTheme;
      document.body.setAttribute('data-theme', newTheme);
      window.__onThemeChange(newTheme);
      setThemeIcon(newTheme)
    }

    var preferredTheme;
    try {
      preferredTheme = localStorage.getItem('theme');
    } catch (err) { }

    window.__setPreferredTheme = function(newTheme) {
      setTheme(newTheme);
      try {
        localStorage.setItem('theme', newTheme);
      } catch (err) {}
    }

    var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

    darkQuery.addListener(function(e) {
      window.__setPreferredTheme(e.matches ? 'dark' : 'light');
    });

    setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
  })();
</script>

<!-- Theme JavaScript -->
<script src="/js/gungnir.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js"></script>
<script src="/js/sw-registration.js"></script>



<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!--fastClick.js -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

    <!-- Google Analytics -->
<script>
    // dynamic User by Hux
    var _gaId = 'UA-146858305-1';
    var _gaDomain = 'renovamen.ink';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->

    <!-- Baidu Tongji -->
<script>
    // dynamic User by Hux
    var _baId = '75381d210789d3eaf855fa16246860cc';

    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>



<!-- Side Catalog -->

    <!-- tocbot: https://github.com/tscanlin/tocbot -->

<!-- 
    Didn't use lazyload here because it will cause some bugs in catalog 
    generating when swtiching between two languages. 
    I'm trying to find a better solution.
-->

<link href="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.css" rel="stylesheet" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.min.js"></script>

<script type="text/javascript">
    function generateCatalog(selector) {

        // links page
        if('post' == 'links') {
            _containerSelector = 'div.link-list'
        }
        // interop with multilangual 
        else {
            if ('' == 'true') {
                _containerSelector = 'div.post-container.active'
            } 
            else {
                _containerSelector = 'div.post-container'
            }
        }
        
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: selector,
            // Where to grab the headings to build the table of contents.
            contentSelector: _containerSelector,
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h2, h3, h4, h5, h6',
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))
</script>



<!-- Multi-Lingual -->

    </div>

    <!-- modify styles of navbar on mobile -->
    <div class="mobile-nav">
    <div class="mobile-menu-avatar">
        <div class="avatar-container">
            <img src="/img/header-avatar.jpeg">
        </div>
    </div>
    <p class="mobile-menu-heading">Meow?</p>
    


<div class="list-inline text-center">

  
  <a target="_blank" href="https://github.com/Renovamen">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-github-alt fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.linkedin.com/in/xiaohan-zou-55bba0160">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.facebook.com/renovamen.zou">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://twitter.com/renovamen_zxh">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.zhihu.com/people/chao-neng-gui-su">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-stack-1x fa-inverse">知</i>
    </span>
  </a>
  
  
  
  <a href="mailto:renovamenzxh@gmail.com">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="/feed.xml">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
</div>
    <ul>
        
        <li>
            
            <a href="/" class="faa-parent animated-hover">
            
                
                <i class="fab fa-fort-awesome fa-lg faa-wrench"></i>
                
                Home
            </a>
            
        </li>
        
        <li>
            
            <a href="/about/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-paw fa-lg faa-wrench"></i>
                
                About
            </a>
            
        </li>
        
        <li>
            
            <a href="/archive/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-archive fa-lg faa-wrench"></i>
                
                Archive
            </a>
            
        </li>
        
        <li>
            
            <a href="/links/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-link fa-lg faa-wrench"></i>
                
                Links
            </a>
            
        </li>
        

        <li>
            <a id="mobile-search-btn" class="faa-parent animated-hover">
                <i class="fas fa-search fa-lg faa-wrench"></i> Search
            </a>
        </li>
    </ul>
</div>

    <!-- support search -->
    <div id="search" class="search-page">

    <i class="search-close fas fa-chevron-down"></i>
    <p class="search-title text-center"></p>

    <div class="input">
        <input 
            id="search-input" 
            type="text" 
            class="search-field" 
            placeholder="Just search ..." 
            onkeypress="checkCode()"
            style="background-color: transparent"
        >
    </div>
    <div id="search-results" class="search-results"></div>

    <img class="search-img-right" src="/img/search-right.gif"/>
</div><script>
    // simple-jekyll-search.js
    LazyLoad.js("https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js", function(){
        SimpleJekyllSearch({
            searchInput: document.getElementById('search-input'),
            resultsContainer: document.getElementById('search-results'),
            json: '/search.json',
            searchResultTemplate: '<li class="result-item item"><a href="{url}" title="{desc}"><div class="result-item-title">{title}</div><div class="result-item-subtitle">{subtitle}</div></a></li>',
            noResultsText: '<li class="result-item item"><div class="result-item-title">No Results</div></li>',
            limit: 20,
            fuzzy: false
        })
    })

    // search-results 高度适配
    $('.search-results').css({
        'height': $(window).height() - 200 + "px"
    });

    function checkCode() {
        if (event.keyCode == 13) {
            getCode = $('#search-input').val();
            if(getCode == "cd dark universe") {
                window.location.href = "https://renovamen.gitee.io/dark-universe/";
            }
            else if(getCode == "cd resume") {
                window.location.href = "https://renovamen.ink/Endless-Resume/";
            }
        }
    }

    function autoFocus() {
        setTimeout(function () {
            document.querySelector('.search-page input').focus();
        }, 400);
    }

    // open search page
    $('#search-btn').click(function() {
        $('.search-page').toggleClass('open')
        autoFocus()
    });

    // open search page (mobile)
    $('#mobile-search-btn').click(function() {
        $('.search-page').toggleClass('open')
        autoFocus()
    });

    // close search page
    $('.search-close').click(function() {
        $('.search-page').toggleClass('open')
    });
</script>
    
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
