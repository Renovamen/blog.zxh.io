<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Xiaohan Zou's blog">
    <meta name="keywords"  content="">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Regularization-based Continual Learning - Renovamen (Xiaohan Zou)">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="持续学习
">
    
    <meta property="article:published_time" content="2020-08-24T00:00:00Z">
    
    
    <meta property="article:author" content="Renovamen">
    
    
    <meta property="article:tag" content="Deep Learning">
    
    <meta property="article:tag" content="Continual Learning">
    
    <meta property="article:tag" content="Bayesian">
    
    
    <meta property="og:image" content="https://renovamen.inkimg/header-avatar.jpeg">
    <meta property="og:url" content="https://renovamen.ink/2020/08/24/regularization-based-continual-learning/">
    <meta property="og:site_name" content="Renovamen (Xiaohan Zou)">
    
    <title>Regularization-based Continual Learning - Renovamen (Xiaohan Zou)</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.svg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://renovamen.ink/2020/08/24/regularization-based-continual-learning/"><!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.2/dist/css/bootstrap.min.css">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200"/>

    <!-- Custom Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" rel="stylesheet" type="text/css">
    
    <!-- Font Awesome Animation -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome-animation@0.2.1/dist/font-awesome-animation.min.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/gungnir.css">
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script>

    <!-- Lazyload (.js & .css)-->
    <script>// https://github.com/rgrove/lazyload

/*jslint browser: true, eqeqeq: true, bitwise: true, newcap: true, immed: true, regexp: false */

/**
LazyLoad makes it easy and painless to lazily load one or more external
JavaScript or CSS files on demand either during or after the rendering of a web
page.
Supported browsers include Firefox 2+, IE6+, Safari 3+ (including Mobile
Safari), Google Chrome, and Opera 9+. Other browsers may or may not work and
are not officially supported.
Visit https://github.com/rgrove/lazyload/ for more info.
Copyright (c) 2011 Ryan Grove <ryan@wonko.com>
All rights reserved.
Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the 'Software'), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
@module lazyload
@class LazyLoad
@static
*/

LazyLoad = (function (doc) {
    // -- Private Variables ------------------------------------------------------
  
    // User agent and feature test information.
    var env,
  
    // Reference to the <head> element (populated lazily).
    head,
  
    // Requests currently in progress, if any.
    pending = {},
  
    // Number of times we've polled to check whether a pending stylesheet has
    // finished loading. If this gets too high, we're probably stalled.
    pollCount = 0,
  
    // Queued requests.
    queue = {css: [], js: []},
  
    // Reference to the browser's list of stylesheets.
    styleSheets = doc.styleSheets;
  
    // -- Private Methods --------------------------------------------------------
  
    /**
    Creates and returns an HTML element with the specified name and attributes.
    @method createNode
    @param {String} name element name
    @param {Object} attrs name/value mapping of element attributes
    @return {HTMLElement}
    @private
    */
    function createNode(name, attrs) {
        var node = doc.createElement(name), attr;
    
        for (attr in attrs) {
            if (attrs.hasOwnProperty(attr)) {
                node.setAttribute(attr, attrs[attr]);
            }
        }
    
        return node;
    }
  
    /**
    Called when the current pending resource of the specified type has finished
    loading. Executes the associated callback (if any) and loads the next
    resource in the queue.
    @method finish
    @param {String} type resource type ('css' or 'js')
    @private
    */
    function finish(type) {
        var p = pending[type],
            callback,
            urls;
    
        if (p) {
            callback = p.callback;
            urls     = p.urls;
    
            urls.shift();
            pollCount = 0;
    
            // If this is the last of the pending URLs, execute the callback and
            // start the next request in the queue (if any).
            if (!urls.length) {
                callback && callback.call(p.context, p.obj);
                pending[type] = null;
                queue[type].length && load(type);
            }
        }
    }
  
    /**
    Populates the <code>env</code> variable with user agent and feature test
    information.
    @method getEnv
    @private
    */
    function getEnv() {
        var ua = navigator.userAgent;
    
        env = {
            // True if this browser supports disabling async mode on dynamically
            // created script nodes. See
            // http://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order
            async: doc.createElement('script').async === true
        };
    
        (env.webkit = /AppleWebKit\//.test(ua))
            || (env.ie = /MSIE|Trident/.test(ua))
            || (env.opera = /Opera/.test(ua))
            || (env.gecko = /Gecko\//.test(ua))
            || (env.unknown = true);
    }
  
    /**
    Loads the specified resources, or the next resource of the specified type
    in the queue if no resources are specified. If a resource of the specified
    type is already being loaded, the new request will be queued until the
    first request has been finished.
    When an array of resource URLs is specified, those URLs will be loaded in
    parallel if it is possible to do so while preserving execution order. All
    browsers support parallel loading of CSS, but only Firefox and Opera
    support parallel loading of scripts. In other browsers, scripts will be
    queued and loaded one at a time to ensure correct execution order.
    @method load
    @param {String} type resource type ('css' or 'js')
    @param {String|Array} urls (optional) URL or array of URLs to load
    @param {Function} callback (optional) callback function to execute when the
      resource is loaded
    @param {Object} obj (optional) object to pass to the callback function
    @param {Object} context (optional) if provided, the callback function will
      be executed in this object's context
    @private
    */
    function load(type, urls, callback, obj, context) {
        var _finish = function () { finish(type); },
            isCSS   = type === 'css',
            nodes   = [],
            i, len, node, p, pendingUrls, url;
  
        env || getEnv();
  
        if (urls) {
            // If urls is a string, wrap it in an array. Otherwise assume it's an
            // array and create a copy of it so modifications won't be made to the
            // original.
            urls = typeof urls === 'string' ? [urls] : urls.concat();
    
            // Create a request object for each URL. If multiple URLs are specified,
            // the callback will only be executed after all URLs have been loaded.
            //
            // Sadly, Firefox and Opera are the only browsers capable of loading
            // scripts in parallel while preserving execution order. In all other
            // browsers, scripts must be loaded sequentially.
            //
            // All browsers respect CSS specificity based on the order of the link
            // elements in the DOM, regardless of the order in which the stylesheets
            // are actually downloaded.
            if (isCSS || env.async || env.gecko || env.opera) {
                // Load in parallel.
                queue[type].push({
                    urls    : urls,
                    callback: callback,
                    obj     : obj,
                    context : context
                });
            } 
            else {
                // Load sequentially.
                for (i = 0, len = urls.length; i < len; ++i) {
                    queue[type].push({
                        urls    : [urls[i]],
                        callback: i === len - 1 ? callback : null, // callback is only added to the last URL
                        obj     : obj,
                        context : context
                    });
                }
            }
        }
  
        // If a previous load request of this type is currently in progress, we'll
        // wait our turn. Otherwise, grab the next item in the queue.
        if (pending[type] || !(p = pending[type] = queue[type].shift())) {
            return;
        }
    
        head || (head = doc.head || doc.getElementsByTagName('head')[0]);
        pendingUrls = p.urls.concat();

        for (i = 0, len = pendingUrls.length; i < len; ++i) {
            url = pendingUrls[i];
    
            if (isCSS) {
                node = env.gecko ? createNode('style') : createNode('link', {
                    href: url,
                    rel : 'stylesheet'
                });
            } 
            else {
                node = createNode('script', {src: url});
                node.async = false;
            }
    
            node.className = 'lazyload';
            node.setAttribute('charset', 'utf-8');
    
            if (env.ie && !isCSS && 'onreadystatechange' in node && !('draggable' in node)) {
                node.onreadystatechange = function () {
                    if (/loaded|complete/.test(node.readyState)) {
                        node.onreadystatechange = null;
                        _finish();
                    }
                };
            } 
            else if (isCSS && (env.gecko || env.webkit)) {
                // Gecko and WebKit don't support the onload event on link nodes.
                if (env.webkit) {
                    // In WebKit, we can poll for changes to document.styleSheets to
                    // figure out when stylesheets have loaded.
                    p.urls[i] = node.href; // resolve relative URLs (or polling won't work)
                    pollWebKit();
                } 
                else {
                    // In Gecko, we can import the requested URL into a <style> node and
                    // poll for the existence of node.sheet.cssRules. Props to Zach
                    // Leatherman for calling my attention to this technique.
                    node.innerHTML = '@import "' + url + '";';
                    pollGecko(node);
                }
            } 
            else {
                node.onload = node.onerror = _finish;
            }
    
            nodes.push(node);
        }
    
        for (i = 0, len = nodes.length; i < len; ++i) {
            head.appendChild(nodes[i]);
        }
    }
  
    /**
    Begins polling to determine when the specified stylesheet has finished loading
    in Gecko. Polling stops when all pending stylesheets have loaded or after 10
    seconds (to prevent stalls).
    Thanks to Zach Leatherman for calling my attention to the @import-based
    cross-domain technique used here, and to Oleg Slobodskoi for an earlier
    same-domain implementation. See Zach's blog for more details:
    http://www.zachleat.com/web/2010/07/29/load-css-dynamically/
    @method pollGecko
    @param {HTMLElement} node Style node to poll.
    @private
    */
    function pollGecko(node) {
        var hasRules;
    
        try {
            // We don't really need to store this value or ever refer to it again, but
            // if we don't store it, Closure Compiler assumes the code is useless and
            // removes it.
            hasRules = !!node.sheet.cssRules;
        } 
        catch (ex) {
            // An exception means the stylesheet is still loading.
            pollCount += 1;

            if (pollCount < 200) {
                setTimeout(function () { pollGecko(node); }, 50);
            } 
            else {
                // We've been polling for 10 seconds and nothing's happened. Stop
                // polling and finish the pending requests to avoid blocking further
                // requests.
                hasRules && finish('css');
            }
            return;
        }
    
        // If we get here, the stylesheet has loaded.
        finish('css');
    }
    
    /**
    Begins polling to determine when pending stylesheets have finished loading
    in WebKit. Polling stops when all pending stylesheets have loaded or after 10
    seconds (to prevent stalls).
    @method pollWebKit
    @private
    */
    function pollWebKit() {
        var css = pending.css, i;

        if (css) {
            i = styleSheets.length;

            // Look for a stylesheet matching the pending URL.
            while (--i >= 0) {
                if (styleSheets[i].href === css.urls[0]) {
                    finish('css');
                    break;
                }
            }

            pollCount += 1;
    
            if (css) {
                if (pollCount < 200) {
                    setTimeout(pollWebKit, 50);
                } 
                else {
                    // We've been polling for 10 seconds and nothing's happened, which may
                    // indicate that the stylesheet has been removed from the document
                    // before it had a chance to load. Stop polling and finish the pending
                    // request to prevent blocking further requests.
                    finish('css');
                }
            }
        }
    }
    
    return {
    
        /**
         Requests the specified CSS URL or URLs and executes the specified
        callback (if any) when they have finished loading. If an array of URLs is
        specified, the stylesheets will be loaded in parallel and the callback
        will be executed after all stylesheets have finished loading.
        @method css
        @param {String|Array} urls CSS URL or array of CSS URLs to load
        @param {Function} callback (optional) callback function to execute when
        the specified stylesheets are loaded
        @param {Object} obj (optional) object to pass to the callback function
        @param {Object} context (optional) if provided, the callback function
        will be executed in this object's context
        @static
        */
        css: function (urls, callback, obj, context) {
            load('css', urls, callback, obj, context);
        },
    
        /**
         Requests the specified JavaScript URL or URLs and executes the specified
        callback (if any) when they have finished loading. If an array of URLs is
        specified and the browser supports it, the scripts will be loaded in
        parallel and the callback will be executed after all scripts have
        finished loading.
        Currently, only Firefox and Opera support parallel loading of scripts while
        preserving execution order. In other browsers, scripts will be
        queued and loaded one at a time to ensure correct execution order.
        @method js
        @param {String|Array} urls JS URL or array of JS URLs to load
        @param {Function} callback (optional) callback function to execute when
        the specified scripts are loaded
        @param {Object} obj (optional) object to pass to the callback function
        @param {Object} context (optional) if provided, the callback function
        will be executed in this object's context
        @static
        */
        js: function (urls, callback, obj, context) {
            load('js', urls, callback, obj, context);
        }
    };
})(this.document);</script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Renovamen: add menu button -->
    <div class="menu-btn-container">
    <div class="menu-btn-wrapper">
        <div class="menu-btn">
            <div class="menu-btn-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="menu-text"></div>
            <svg class="menu-svg">
                <circle class="menu-border" cx="50%" cy="50%" r="48%"></circle>
            </svg>
        </div>
        <div class="menu-btn-child-wrapper">
            <div class="menu-btn-child" id="menu-theme-btn">
                <span class="fa icon-theme"></span>
            </div>
            <div class="menu-btn-child" onclick="smoothTo('bottom')">
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="menu-btn-child" onclick="smoothTo('top')">
                <i class="fas fa-chevron-up"></i>
            </div>
            
            
            <div class="menu-btn-child" id="menu-toc-btn">
                <i class="fas fa-list-ul"></i>
            </div>
            
            
            <div class="menu-btn-child" id="menu-navbar-btn">
                <i class="far fa-window-restore"></i>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // open menu
    $('.menu-btn').click(function() {
        $('.menu-btn-container').toggleClass('open');
    });
    
    // open navbar
    $('#menu-navbar-btn').click(function() {
        mobileNavToggle();
    });

    // open catalog
    $('#menu-toc-btn').click(function() {
        $('.side-catalog').toggleClass('open');
    });

    // set theme icon in menu
    function setThemeIcon(newTheme) {
        const icons = {
            'light': '"\\f185"', 
            'dark': '"\\f186"', 
            'sepia': '"\\f0f4"'
        }
        $('#menu-theme-btn').append(
            '<style>.icon-theme:before{content:' + icons[newTheme] + '}</style>'
        );
    }

    function toggleTheme() {
        const themes = ['light', 'dark', 'sepia']
        // get current theme
        const currentTheme = window.__theme
        const currentIndex = themes.indexOf(currentTheme)
        // set next theme
        const nextIndex = (currentIndex + 1) % themes.length
        const nextTheme = themes[nextIndex]
        window.__setPreferredTheme(nextTheme)
        setThemeIcon(nextTheme)
    }

    // change theme
    $('#menu-theme-btn').click(function() {
        toggleTheme()
    });
</script>

    <div class="main-container">
    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <!-- navbar toggle for old mobile menu button (by Hux) -->
            <!-- <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button> -->
            <a class="navbar-brand" href="/">$ cd /home/</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">

                    
                    <li>
                        
                        <a href="/" class="faa-parent animated-hover">
                        
                            
                            <i class="fab fa-fort-awesome fa-lg faa-wrench"></i>
                            
                            Home
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/about/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-paw fa-lg faa-wrench"></i>
                            
                            About
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/archive/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-archive fa-lg faa-wrench"></i>
                            
                            Archive
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/links/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-link fa-lg faa-wrench"></i>
                            
                            Links
                        </a>
                        
                    </li>
                    
                    <li>
                        <a id="search-btn" class="faa-parent animated-hover">
                            <i class="fas fa-search fa-lg faa-wrench"></i> Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Old Mobile Navbar Script (By Hux) -->
<!-- <script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script> -->

    <!-- Image to hack wechat -->
<!-- <img src="/img/in-post/2020-08-24/header.jpg" width="0" height="0"> -->

<!-- Post Header -->



    
    <style type="text/css">
        header.intro-header{
            position: relative;
            background-image: url('/img/in-post/2020-08-24/header.jpg');
            background: ;
        }

        
    </style>
    
    





<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Deep+Learning" title="Deep Learning">Deep Learning</a>
                        
                        <a class="tag" href="/archive/?tag=Continual+Learning" title="Continual Learning">Continual Learning</a>
                        
                        <a class="tag" href="/archive/?tag=Bayesian" title="Bayesian">Bayesian</a>
                        
                    </div>
                    <h1>Regularization-based Continual Learning</h1>
                    
                    <h2 class="subheading">EWC / Online EWC / IS / MAS ...</h2>
                    
                    <span class="meta">Posted by Renovamen on August 24, 2020</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>











<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h2 id="持续学习">持续学习</h2>

<p>传统的机器学习要求训练样本之间是 <strong>i.i.d（Independent and Identically Distributed，独立同分布）</strong>的，为了达到这个目的往往会随机打乱训练数据。但如果要让模型处理分布在变化的连续数据，如果不做任何处理依然按传统方法来训练，就会出现<strong>灾难性遗忘（Catastrophic Forgetting）</strong>，因为新的数据会对模型造成干扰（interference）。模型会调整它学到的关于旧数据的参数以适应新任务，这样在旧数据上学到的知识就会被遗忘。</p>

<p><strong>Continual</strong> / Lifelong / Incremental / Cumulative Learning（<strong>持续学习</strong> / 终身学习 / 增量学习）就是为了解决这个问题（我从未见过命名如此不统一的方向 2333）。标准版持续学习的目标是（叫它标准版是因为最近的很多研究给持续学习加了一些新目标）：</p>

<ul>
  <li>
    <p>学习当前任务</p>
  </li>
  <li>
    <p>解决灾难性遗忘问题</p>
  </li>
</ul>

<p>为了搞定灾难性遗忘，常见的三种套路是：</p>

<ul>
  <li>
    <p><strong>Dynamic Expansion</strong>：既然问题在于关于旧任务的参数会被干扰，那就不用这些参数来学习新任务了，直接搞一批新的参数来学新任务。这样模型的参数就会越来越多，所以叫 dynamic expansion。模型参数太多了之后可能会很难训练。为了让参数不要增加得太快，有些方法会加一些模型剪枝知识蒸馏一类的压缩操作进来。</p>
  </li>
  <li>
    <p><strong>Rehearsal</strong>：如果让新任务上的梯度尽可能接近旧任务上的梯度，那在旧任务上学习到的知识就不会被遗忘多少。这种思路需要去搞一些旧数据，而搞旧数据的方法又大概能分为两种：</p>

    <ul>
      <li>
        <p><strong>Extra Memory</strong>：直接存一些旧数据，这样就需要额外的存储空间；</p>
      </li>
      <li>
        <p><strong>Generative Replay</strong>：用旧数据训练一个生成模型（如 GAN、VAE 等），然后用这个生成模型来生成旧数据。这样不需要额外的存储空间，但模型参数会变多（多了生成模型的参数）。</p>

        <p>不过我很好奇用生成模型模拟旧数据的效果，和把生成模型的权重占的存储空间全拿去存旧数据的效果哪个更好。假设权重几十或几百兆，如果直接把它拿来存旧数据，假设一张图片几百 K（因为大多数持续学习论文的实验设置都是在做图像分类，所以这里考虑存图片），也能存几百张了。考虑到目前生成模型生成的图片质量都没有很高，在存储空间一样大的前提下它的效果能不能超过直接存几百张旧图片的效果我觉得是不一定的。我还是很希望看到有论文做这种对比实验的，不过目前似乎还没看到这样做的？虽然我也没看过多少论文就是了…</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Regularization</strong>：直觉上来说更优雅的一类方法，毕竟不用额外存储空间也不用增加模型参数。这种方法会加一些正则项来避免跟旧任务关联较大的参数更新幅度过大。这种方法存在的基础是现在的绝大多数神经网络都是过参数化（over-parameterization）的。本文要理的一些方法就属于这一类。</p>
  </li>
</ul>

<h2 id="直觉上的理解">直觉上的理解</h2>

<p><img src="/img/in-post/2020-08-24/ewc.png" alt="EWC" width="400px" /></p>

<p class="desc">图片来源：论文 <a href="https://arxiv.org/pdf/1612.00796.pdf" target="_blank">Overcoming Catastrophic Forgetting in Neural Networks</a></p>

<p>上图是参数在参数空间里的变化轨迹。蓝色的箭头相当于在任务 \(A\)（可以推广为旧任务）上训练完之后，直接拿去任务 \(B\)（可以推广为新任务）上 fine-tune。这样在学完任务 \(B\) 之后，基本就把任务 \(A\) 忘得差不多了。</p>

<p>那么一个想法是加一个正则项（L2），让在任务 \(B\) 上训练完后的参数不能离在任务 \(A\) 上训练完后的参数太远，即绿色箭头。但直接加 L2 正则项没有考虑不同参数对任务的重要性，对任务 \(A\) 特别重要的参数限制应该大一些，而不那么重要的参数则不用怎么限制，不然任务 \(B\) 就学不好了。</p>

<p>于是红色箭头就是很多 regularization-based 的方法的思想：计算一下每个参数 \(\theta_i\) 对任务 \(A\) 的重要性 \(\Omega_i\)，然后加了正则项的损失函数变成（\(\theta_{A,i}^\text{*}\) 是在任务 \(A\) 上训练完后得到的最优参数）：</p>

\[L(\theta) = L_B(\theta) + \frac{\lambda}{2} \sum_i \Omega_i (\theta_i - \theta_{A,i}^\text{*})^2\]

<p>只不过这些方法计算重要性 \(\Omega_i\) 的方式有所不同。</p>

<h2 id="ewc">EWC</h2>

<p><strong>Overcoming Catastrophic Forgetting in Neural Networks.</strong> <em>James Kirkpatrick, et al.</em> PNAS 2017. <a href="https://arxiv.org/pdf/1612.00796.pdf" target="_blank">[Paper]</a></p>

<p><strong>EWC（Elastic Weight Consolidation）</strong></p>

<h3 id="参数重要性">参数重要性</h3>

<p>如果直接上结论的话，参数 \(\theta_i\) 的重要性 = Fisher 信息矩阵的第 \(i\) 个对角线元素，也即：</p>

\[\Omega_i = \frac{1}{|D_A|} \sum_{x \in D_A} \left ( \frac{\partial \log p_\theta(Y = y_x^\text{*} \mid x)}{\partial \theta_i} \Bigg |_{\theta = \theta_A^\text{*}} \right )^2\]

<p>其中 \(y_x^\text{*}\) 是模型 \(p_{\theta_A^\text{*}}(y \mid x)\) 对 \(x\) 的输出。</p>

<h3 id="贝叶斯视角">贝叶斯视角</h3>

<p>如果按照贝叶斯方法来学习参数的话，灾难性遗忘并不会发生。贝叶斯方法希望估计出参数的后验分布：</p>

\[\begin{aligned}
    p(\theta \mid D) &amp;= \frac{p(\theta, D)}{p(D)} = \frac{p(\theta, D_A, D_B)}{p(D_A, D_B)} \\[10px]
        &amp; = \frac{p(\theta, D_B \mid D_A) p(D_A)}{p(D_B \mid D_A) p(D_A)} \\[10px]
        &amp; = \frac{p(\theta, D_B \mid D_A)}{p(D_B \mid D_A)} \\[10px]
        &amp; = \frac{p(D_B \mid \theta, D_A) p(\theta \mid D_A)}{p(D_B \mid D_A)} \\[10px]
        &amp; = \frac{p(D_B \mid \theta) p(\theta \mid D_A)}{p(D_B)}
\end{aligned}\]

<p>最后一步是因为 \(D_A, D_B\) 相互独立。这个形式实际上就是增量贝叶斯公式（incremental version of Bayes’ rule）。</p>

<p>那么有：</p>

\[\log p(\theta \mid D) = \log p(D_B \mid \theta) + \log p(\theta \mid D_A) - \log p(D_B)\]

<p>对于右边的这三项，第一项 \(\log p(D_B \mid \theta)\) 很明显就是 \(D_B\) 上的损失函数取负 \(-L_B(\theta)\)，第三项 \(\log p(D_B)\) 是个参数无关的常数，于是优化目标就变为了（实际上就是<a href="/2020/08/16/bayesian-neural-network/#最大后验估计" target="_blank">最大后验估计（MAP）</a>）：</p>

\[\begin{aligned}
    \theta &amp;= \arg \max_\theta \log p(\theta \mid D) \\
        &amp;= \arg \max_\theta (- L_B(\theta) + \log p(\theta \mid D_A)) \\
        &amp;= \arg \min_\theta L_B(\theta) - \log p(\theta \mid D_A)
\end{aligned}\]

<p>可以看到这个优化目标相当于一边最小化 \(D_B\) 上的损失，一边最大化 \(D_A\) 上的参数后验 \(p(\theta \mid D_A)\)，从而避免了灾难性遗忘的发生。</p>

<p>那么我们需要求的就是 \(p(\theta \mid D_A)\)，但这个后验是 intractabe 的，我记得我在好几个地方都写过它为啥 intractabe 所以这里就不写了…那么我们又需要把它近似出来，常用的近似方法大概就是变分推断、MCMC、拉普拉斯（Laplace）近似之类的，论文用了拉普拉斯近似。</p>

<p>btw，可以看到相比 MLE，上式就是多了一项 \(- \log p(\theta \mid D_A)\)。所以也可以理解为，论文就是在把这一项设计成结构化风险里的正则项。</p>

<h3 id="拉普拉斯近似">拉普拉斯近似</h3>

<p>拉普拉斯近似的目标是用一个高斯分布来近似 \(p(\theta \mid D_A)\)。假设它是个高斯分布：</p>

\[\\[2px]

p(\theta \mid D_A) = N(\sigma, \mu) = \frac{1}{\sqrt{2 \pi} \sigma} e^{- \frac{(\theta - \mu)^2}{2 \sigma^2}}\]

\[\rArr \log p(\theta \mid D_A) = \log \frac{1}{\sqrt{2 \pi} \sigma} - \frac{(\theta - \mu)^2}{2 \sigma^2}\]

<p>右边其实是在取 \(\ln\)，不过这里 \(\log\) 和 \(\ln\) 没有本质区别。</p>

<p>令 \(f(\theta) = \log p(\theta \mid D_A)\)，当 \(\theta = \theta_A^\text{*}\) 时取最优解，那么在 \(\theta = \theta_A^\text{*}\) 处对 \(f(\theta)\) <a href="#泰勒展开">泰勒展开</a>：</p>

\[f(\theta) = f(\theta_A^\text{*}) + \underbrace{\Bigg ( \frac{\partial f(\theta)}{\partial \theta} \Bigg |_{\theta = \theta_A^\text{*}}  \Bigg )}_{\text{雅克比矩阵}} (\theta - \theta_A^\text{*}) + \frac{1}{2} (\theta - \theta_A^\text{*})^\top \underbrace{\Bigg ( \frac{\partial^2 f(\theta)}{\partial^2 \theta} \Bigg |_{\theta = \theta_A^\text{*}}  \Bigg )}_{\text{海森矩阵}} (\theta - \theta_A^\text{*}) + o(\theta_A^\text{*}) \\[5px]\]

<p>因为 \(\theta_A^\text{*}\) 使得 \(f(\theta)\) 有极大值（<a href="https://www.cnblogs.com/hapjin/p/8834794.html" target="_blank">这里</a>似乎证明了一定有这个极大值），所以 \(f(\theta)\) 在 \(\theta = \theta_A^\text{*}\) 处的一阶导为 0，二阶导为负（海森矩阵负定），并且我们忽略掉三阶及以上的项，那么 \(f(\theta)\) 可以近似为：</p>

\[f(\theta) = \log \frac{1}{\sqrt{2 \pi} \sigma} - \frac{(\theta - \mu)^2}{2 \sigma^2} \approx f(\theta_A^\text{*}) + \frac{1}{2} (\theta - \theta_A^\text{*})^2 f''(\theta_A^\text{*})\]

<p>为了方便这里就不强调矩阵了，记住 \(f''(\theta_A^\text{*})\) 是个<a href="#海森矩阵">海森矩阵</a>就好 2333。因为 \(\log \frac{1}{\sqrt{2 \pi} \sigma}\) 和 \(f(\theta_A^\text{*})\) 都是参数无关的常数，所以：</p>

\[- \frac{(\theta - \mu)^2}{2 \sigma^2} = \frac{(\theta - \theta_A^\text{*})^2}{2} f''(\theta_A^\text{*}) \\[2px]\]

<p>所以：</p>

\[\mu =  \theta_A^\text{*}\]

\[\sigma = - \frac{1}{f''(\theta_A^\text{*})}\]

<p>高斯分布的两个超参求出来了，\(p(\theta \mid D_A)\) 也就求出来了，现在优化目标可以写成：</p>

\[\begin{aligned}
    \theta &amp;= \arg \min_\theta L_B(\theta) - \log p(\theta \mid D_A) \\
        &amp;= \arg \min_\theta L_B(\theta) - \frac{1}{2} (\theta - \theta_A^\text{*})^2 f''(\theta_A^\text{*})
\end{aligned}\]

<p>\(f(\theta_A^\text{*})\) 是个常数所以可以省掉。相当于最大化 \(p(\theta \mid D_A)\) 变成了最大化 \(\frac{1}{2} (\theta - \theta_A^\text{*})^2 f''(\theta_A^\text{*})\)。</p>

<p>那么现在问题又变成了怎么求 \(f''(\theta_A^\text{*})\)。\(f''(\theta_A^\text{*})\) 能直接算出来，但是这里参数 \(\theta\) 是 \(n\) 维向量，所以 \(f''(\theta_A^\text{*})\) 是 \(n \times n\) 的海森矩阵，计算的时间和空间复杂度都比较大。为了减小计算开销，论文把海森矩阵转成了 Fisher 信息矩阵。</p>

<h3 id="fisher-信息矩阵">Fisher 信息矩阵</h3>

<p>首先，一个结论是 Fisher 信息矩阵等于海森矩阵的期望取负（<a href="https://wiseodd.github.io/techblog/2018/03/11/fisher-information/" target="_blank">这里</a>是证明过程）：</p>

\[F_{ij} = - \mathbb{E}[f''(\theta_A^\text{*})] = - \mathbb{E}_{p(\theta \mid D_A)} \left [ \frac{\partial^2 \log p(\theta \mid D_A)}{\partial \theta_i \theta_j} \Bigg |_{\theta = \theta_A^\text{*}} \right ]\]

<p>为了省计算量，只取了 Fisher 信息矩阵的对角线，相当于假设各参数之间相互独立：</p>

\[F_{ii} = - \mathbb{E}_{p(\theta \mid D_A)} \left [ \frac{\partial^2 \log p(\theta \mid D_A)}{\partial^2 \theta_i} \Bigg |_{\theta = \theta_A^\text{*}} \right ]\]

<p>之所以要转成 Fisher 信息矩阵，是因为 Fisher 信息矩阵可以只靠求一阶导算出来（基本定义），一阶导的计算复杂度比二阶导要低很多：</p>

\[\\[1px]
\begin{aligned}
    F_{ii} &amp;= - \mathbb{E}_{p(\theta \mid D_A)} \left [ \left ( \frac{\partial \log p(\theta \mid D_A)}{\partial \theta_i} \Bigg |_{\theta = \theta_A^\text{*}} \right )^2 \right ] \\[20pt]
\end{aligned}\]

<p>最大化 \(\log p(\theta \mid D_A)\) 跟最大化 \(\log p(y \mid x)\) 是一个意思，而求期望可以用蒙特卡洛采样来近似，所以：</p>

\[F_{ii} \approx - \mathbb{E}_{x \thicksim D_A, y \thicksim p_\theta (y \mid x)} \left [ \left ( \frac{\partial \log p(y \mid x)}{\partial \theta_i} \Bigg |_{\theta = \theta_A^\text{*}} \right )^2 \right ]\]

<p>其中 \(x\) 是从任务 \(A\) 的样本里采样出来的，\(y\) 是模型 \(p_{\theta_A^\text{*}}(y \mid x)\) 对 \(x\) 的输出。这是需要注意的一点，\(y\) 是从模型里采样出来的，不是直接从数据分布里采样的。所以求 Fisher 信息矩阵时至少需要再额外来一次反向传播流程，因为需要把 \(p_{\theta_A^\text{*}}(y \mid x)\) 的输出拿来当 ground truth，然后重新算一遍损失，然后再求一次梯度。</p>

<p>当然的确也有直接从数据分布里采样 \(y\) 的做法，叫 empirical Fisher，这样倒是可以把现成算好的梯度直接拿来用。</p>

<p>论文在算期望时把每个样本都采样了一遍，所以相当于是对每个样本上的梯度的平方求平均：</p>

\[F_{ii} = \frac{1}{|D_A|} \sum_{x \in D_A} \left ( \frac{\partial \log p_\theta(Y = y_x^\text{*} \mid x)}{\partial \theta_i} \Bigg |_{\theta = \theta_A^\text{*}} \right )^2\]

<p>其中 \(y_x^\text{*}\) 是模型 \(p_{\theta_A^\text{*}}(y \mid x)\) 对 \(x\) 的输出。</p>

<p>于是最终的损失函数为：</p>

\[\begin{aligned}
    L(\theta) &amp;= L_B(\theta) - \frac{\lambda}{2} f''(\theta_A^\text{*}) (\theta - \theta_A^\text{*})^2 \\[5pt]
        &amp;= L_B(\theta) + \frac{\lambda}{2} \sum_i F_i (\theta_i - \theta_{A,i}^\text{*})^2
\end{aligned}\]

<p>因为 Fisher 信息矩阵是海森矩阵的期望取负，所以这里从减号变成了加号。</p>

<p>我认为的另一个理解方式是，Fisher 信息矩阵也反映了我们对参数估计的不确定度。二阶导越大，说明我们对该参数的估计越确定，同时 Fisher 信息也越大，正则项就越大。于是越确定的参数在后面的任务里更新幅度就越小。</p>

<h3 id="多个任务">多个任务</h3>

<p>考虑一下有三个任务 \(D_A, D_B, D_C\) 的情况，这时的参数后验为：</p>

\[\log (\theta \mid D_A, D_B, D_C) = \log p(D_C \mid \theta) + \log (\theta \mid D_A, D_B) + \text{constant}\]

<p>其中 \(\log (\theta \mid D_A, D_B)\) 已经被近似出来了：</p>

\[\log (\theta \mid D_A, D_B) \approx \log p(D_B \mid \theta) + \frac{1}{2} \sum_i \lambda_A F_{A, i} (\theta_i - \theta_{A,i}^\text{*})^2 + \text{constant}\]

<p>而最大化 \(\log p(D_B \mid \theta)\) 跟最大化 \(\log p(\theta \mid D_B)\) 是一个意思，\(\log p(\theta \mid D_B)\) 又可以近似为：</p>

\[\log p(\theta \mid D_B) \approx \frac{1}{2} \sum_i \lambda_B F_{B, i} (\theta_i - \theta_{B,i}^\text{*})^2\]

<p>那么 \(\log (\theta \mid D_A, D_B, D_C)\) 可以近似为：</p>

\[\log (\theta \mid D_A, D_B, D_C) \approx \log p(D_C \mid \theta) + \frac{1}{2} \sum_i \Bigg (\lambda_A F_{A, i} (\theta_i - \theta_{A,i}^\text{*})^2 + \lambda_B F_{B, i} (\theta_i - \theta_{B,i}^\text{*})^2 \Bigg ) + \text{constant}\]

<p>相当于 EWC 会针对 \(\theta_{A,i}^\text{*}\) 和 \(\theta_{B,i}^\text{*}\) 各加一个惩罚项，来保证 \(\theta_{C,i}^\text{*}\) 跟 \(\theta_{A,i}^\text{*}\) 和 \(\theta_{B,i}^\text{*}\) 都尽量接近。如果任务推广到多个，那么 EWC 会为每个历史任务上训练完后的最优参数 \(\theta_1^\text{*}, \theta_2^\text{*}, \dots, \theta_{T-1}^\text{*}\) 都维护一个惩罚项，即：</p>

\[L_T^\text{regularization} = \frac{1}{2} \sum_i \Bigg ( \sum_{t&lt;T} \lambda_t F_{t, i} (\theta_i - \theta_{t,i}^\text{*})^2 \Bigg )\]

<p>所以惩罚项数量会随任务数量线性增长，造成较大的计算开销。而 <a href="#online-ewc">Online EWC</a> 给出了一个不管有多少任务都只用维护一个惩罚项的解决方案。</p>

<h3 id="其他">其他</h3>

<ul>
  <li>
    <p>不同任务上的参数差异较大时，再把泰勒展开的高阶项近似为 0 就很勉强了</p>
  </li>
  <li>
    <p>只取 Fisher 信息矩阵的对角线，相当于假设各参数之间相互独立，但实际上参数之间肯定有关联</p>
  </li>
  <li>
    <p>原论文写得相当简洁，给人一种好像很快就能看明白的错觉，实际上背地里公式推导省略了一大堆 orz</p>
  </li>
</ul>

<h2 id="online-ewc">Online EWC</h2>

<p><strong>On Quadratic Penalties in Elastic Weight Consolidation.</strong> <em>Ferenc Huszár, et al.</em> arXiv 2017. <a href="https://arxiv.org/pdf/1712.03847.pdf" target="_blank">[Paper]</a></p>

<p>EWC 会为每个历史任务上都维护一个惩罚项，所以惩罚项数量会随任务数量线性增长，造成较大的计算开销。但从直觉上来说，\(\theta_B^\text{*}\) 本来就是在对 \(\theta_A^\text{*}\) 加了惩罚项的情况下估计出来的，那么在估计 \(\theta_C^\text{*}\) 的时候就只需要对 \(\theta_B^\text{*}\) 加惩罚项就够了，就没必要再维护 \(\theta_A^\text{*}\) 的惩罚项了。推广到多个任务，即在估计 \(\theta_T^\text{*}\) 的时候只需要维护一个 \(\theta_{T-1}^\text{*}\) 的惩罚项就好。</p>

<p>在<a href="#多个任务">上一节</a>中我们已经得到 \(\log (\theta \mid D_A, D_B, D_C)\) 的近似：</p>

\[\log (\theta \mid D_A, D_B, D_C) \approx \log p(D_C \mid \theta) + \frac{1}{2} \sum_i \Bigg (\lambda_A F_{A, i} (\theta_i - \theta_{A,i}^\text{*})^2 + \lambda_B F_{B, i} (\theta_i - \theta_{B,i}^\text{*})^2 \Bigg ) + \text{constant}\]

<p>现在我们认为 \(\theta_{B,i}^\text{*}\) 和 \(\theta_{A,i}^\text{*}\) 是差不多的（毕竟这就是 regularization-based 方法的目标），所以 \((\theta_i - \theta_{B,i}^\text{*})\) 和 \((\theta_i - \theta_{A,i}^\text{*})\) 也是差不多的。那么 \(\log (\theta \mid D_A, D_B, D_C)\) 可以进一步近似为：</p>

\[\log (\theta \mid D_A, D_B, D_C) \approx \log p(D_C \mid \theta) + \frac{1}{2} \sum_i (\lambda_A F_{A, i} + \lambda_B F_{B, i})(\theta_i - \theta_{B,i}^\text{*})^2 + \text{constant}\]

<p>推广到 \(T\) 个任务，优化目标即为：</p>

\[\theta_T^{*} = \arg \min_\theta \left \{ - \log p(D_T \mid \theta) - \frac{1}{2} \sum_i \Bigg ( \sum_{t&lt;T} \lambda_t F_{t, i} \Bigg )(\theta_i - \theta_{T-1,i}^\text{*})^2 \right \}\]

<p>所以可以看到，我们并不需要为每个历史任务都维护一个惩罚项，我们只需要对上一个任务训练完后的最优参数加惩罚项就好。</p>

<p><strong>Progress &amp; Compress: A Scalable Framework for Continual Learning.</strong> <em>Jonathan Schwarz, et al.</em> arXiv 2018. <a href="https://arxiv.org/pdf/1805.06370.pdf" target="_blank">[Paper]</a></p>

<p>这就是 Online EWC 的思想，其正则项为：</p>

\[L_T^\text{regularization} = \frac{1}{2} \sum_i \hat{F}_{T-1, i}(\theta_i - \theta_{T-1,i}^\text{*})^2\]

<p>其中 \(\hat{F}\) 是 Fisher 信息矩阵 \(F\) 的（带权）累加和：</p>

\[\hat{F}_t = \gamma \hat{F}_{t-1} + F_t\]

\[\hat{F}_1 = F_1\]

<p>\(\gamma &lt; 1\) 是一个超参数，相当于之前的任务上的算出来的参数重要性对最终结果的贡献会逐渐降低。</p>

<p>P.S. 讲道理我也不知道它为啥要取 online EWC 这个名字，我第一眼看到这个名字还以为它要往 online learning 上靠，结果并没有…</p>

<h2 id="mas">MAS</h2>

<p><strong>Memory Aware Synapses: Learning What (Not) to Forget.</strong> <em>Rahaf Aljundi, et al.</em> ECCV 2018. <a href="https://arxiv.org/pdf/1711.09601.pdf" target="_blank">[Paper]</a> <a href="https://github.com/rahafaljundi/MAS-Memory-Aware-Synapses" target="_blank">[Code]</a></p>

<p><strong>MAS（Memory Aware Synapses）</strong></p>

<h3 id="参数重要性-1">参数重要性</h3>

<p>对于第 \(k\) 个输入数据点 \(x_k\)，如果对第 \(i\) 个参数 \(\theta_i\) 做了一个很小的改变 \(\delta\)，就让模型 \(F\) 的输出结果有了很大的变化，就说明 \(\theta_i\) 是很重要的。</p>

<p>模型输出对所有参数 \(\theta = \{\theta_i\}\) 的变化的变化量可以近似为：</p>

\[F(x_k;\theta + \delta) - F(x_k; \theta) \approx \sum_i g_i (x_k) \delta_i\]

\[\rArr g_i(x_k) \approx \frac{\partial F(x_k)}{\partial \theta_i}\]

<p>\(g_i(x_k)\) 可以被看做参数 \(\theta_i\) 的变化对模型对样本 \(x_k\) 的输出的影响。可以看到 \(g_i(x_k)\) 就是模型函数对参数 \(\theta_i\) 的偏导。</p>

<p>重要性 \(\Omega_i\) 为所有样本上的偏导的均值：</p>

\[\Omega_i = \frac{1}{N} \sum_{k=1}^N \| g_i(x_k) \|\]

<p>每个任务训练完后，都会算一个刚训练完的任务中每个参数的重要性，然后累加到之前的 \(\Omega_i\) 上。一直累加可能会让 \(\Omega_i\) 变得很大，造成梯度爆炸，于是该论文一作后来的一篇工作 <a href="https://arxiv.org/pdf/1812.03596.pdf" target="_blank">Task-Free Continual Learning</a> 中用的是迄今为止所有 \(\Omega_i\) 的平均值。</p>

<h3 id="l2-范数">L2 范数</h3>

<p>大多数神经网络的输出 \(F(x_k;\theta)\) 都是一个 \(n\) 维向量，比如分类任务会输出每个类别上的概率。这样在求每个 \(g_i(x_k)\) 的时候，算的都是向量的偏导，需要做 \(n\) 次反向传播。</p>

<p>为了降低计算复杂度，论文给了另一个可选的方法：对 \(F(x_k;\theta)\) 的 <a href="#l2-范数-1">L2 范数</a>（的平方）求偏导，这样算的就是标量的偏导了，只需要一次反向传播：</p>

\[\\[2px]
g_i(x_k) = \frac{\partial [\ell_2^2 (F(x_k))]}{\partial \theta_i}\]

<h2 id="is">IS</h2>

<p><strong>Continual Learning Through Synaptic Intelligence.</strong> <em>Friedemann Zenke, et al.</em> ICML 2017. <a href="https://arxiv.org/pdf/1703.04200.pdf" target="_blank">[Paper]</a> <a href="https://github.com/ganguli-lab/pathint" target="_blank">[Code]</a></p>

<p><strong>IS（Intelligent Synapses）</strong></p>

<p>MAS 算的是参数改变对模型输出的影响，而 IS 算的是参数改变对损失函数的影响：</p>

\[L(\theta(t) + \delta(t)) - L(\theta(t)) \approx \sum_i g_i (t) \delta_i(t)\]

\[\rArr g_i(t) \approx \frac{\partial L}{\partial \theta_i}\]

<p>其中 \(\theta(t)\) 为任务 \(t\) 训练完后的参数。如果算一个任务 \(\mu-1\) 到任务 \(\mu\) 的更新轨迹上所有微小变化的总和，即对更新开始时刻 \(t^{\mu-1}\) 到结束时刻 \(t^\mu\) 积分：</p>

\[\begin{aligned}
    \int_{t^{\mu-1}}^{t^\mu} g(t) \delta(t) dt &amp;= \sum_i \int_{t^{\mu-1}}^{t^\mu} g_i(t) \delta_i(t) dt \\
        &amp;= - \sum_i \omega_i^\mu
\end{aligned}\]

\[\rArr \omega_i^\mu = - \int_{t^{\mu-1}}^{t^\mu} g_i(t) \delta_i(t) dt\]

<p>\(\omega_i^\mu\) 就是参数 \(\theta_i\) 的变化对损失函数输出的影响。在 offline 场景下，\(\omega_i^\mu\) 直接就能通过损失函数输出值的变化量算出来。与 EWC 和 MAS 不同的是，IS 还可以在 online 场景下计算 \(\omega_i^\mu\)，这时 \(g_i(t)\) 可以用 \(g_i(t) = \frac{\partial L}{\partial \theta_i}\) 来近似，而 \(\delta_i(t)\) 就相当于 \(\delta_i(t) = \theta_i'(t) = \frac{\partial \theta_i}{\partial t}\)。</p>

<p>最后，参数重要性的计算公式为：</p>

\[\Omega_i^\mu = \sum_{\nu &lt; \mu} \frac{\omega_\nu^\mu}{(\Delta_i^\nu)^2 + \xi}\]

<p>其中 \(\Delta_i^\nu = \theta_i(t^\nu) - \theta_i(t^{\nu-1})\) 是为了保证 \(\Omega_i^\mu\) 的尺度跟损失函数输出值的尺度是差不多的。为了避免分母为 0 所以加了一个 \(\xi\)。</p>

<h2 id="附录">附录</h2>

<h3 id="海森矩阵">海森矩阵</h3>

<p>令 \(x = (x_1, x_2, \dots, x_n)\)，多元函数 \(f(x)\) 在 \(x=x_0\) 处的的二阶偏导是一个海森矩阵（Hessian matrix）：</p>

\[\\[1pt]
f''(x_0) = H = 

\begin{bmatrix}
    \frac{\partial f}{\partial x_1 x_1} &amp; \frac{\partial f}{\partial x_1 x_2} &amp; \dots &amp; \frac{\partial f}{\partial x_1 x_n} \\[5pt]
    \frac{\partial f}{\partial x_2 x_1} &amp; \frac{\partial f}{\partial x_2 x_2} &amp; \dots &amp; \frac{\partial f}{\partial x_2 x_n} \\[5pt]
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\[5pt]
    \frac{\partial f}{\partial x_n x_1} &amp; \frac{\partial f}{\partial x_n x_2} &amp; \dots &amp; \frac{\partial f}{\partial x_n x_n} \\
\end{bmatrix}_{x=x_0}\]

<h3 id="泰勒展开">泰勒展开</h3>

<p>\(f(x)\) 在 \(x = x_0\) 处的泰勒展开公式为：</p>

\[f(x) = \frac{f(x_0)}{0!} + \frac{f'(x_0)}{1!} \cdot (x - x_0) + \frac{f''(x_0)}{2!} \cdot (x - x_0)^2 + o(x_0) \\[2px]\]

<p>\(o(x_0)\) 为高阶项。在 \(f(x)\) 是多元函数的情况下，一阶导要写成雅克比矩阵（Jacobian matrix），二阶导要写成海森矩阵：</p>

\[f(x) = \frac{f(x_0)}{0!} + \frac{J_f(x_0)}{1!} \cdot (x - x_0) + (x - x_0)^\top \cdot \frac{H_f(x_0)}{2!} \cdot (x - x_0) + o(x_0) \\[2px]\]

<h3 id="l2-范数-1">L2 范数</h3>

<p>向量 \(x = [ x_1, x_2, \dots, x_n ]\) 的 L2 范数（L2 norm）为：</p>

\[\| x \|_2 = \sqrt{\Big ( \sum_{i=1}^n |x_i|^2 \Big )}\]

<h2 id="参考">参考</h2>

<ul>
  <li>
    <p><a href="https://arxiv.org/pdf/1904.07734.pdf" target="_blank">Three Scenarios for Continual Learning.</a> <em>Gido M. van de Ven, et al.</em> arXiv 2019.</p>
  </li>
  <li>
    <p><a href="https://abhishekaich27.github.io/data/WriteUps/EWC_nuts_and_bolts.pdf" target="_blank">Elastic Weight Consolidation (EWC): Nuts and Bolts.</a> <em>Abhishek Aich.</em></p>
  </li>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/86365066" target="_blank">终身持续学习-可塑权重巩固（Elastic Weight Consolidation）</a></p>
  </li>
  <li>
    <p><a href="https://wiseodd.github.io/techblog/2018/03/11/fisher-information/" target="_blank">Fisher Information Matrix</a></p>
  </li>
  <li>
    <p><a href="https://www.zhihu.com/question/26561604" target="_blank">费雪信息 (Fisher information) 的直观意义是什么？</a></p>
  </li>
  <li>
    <p><a href="https://blog.csdn.net/lanran2/article/details/77995062" target="_blank">Fisher Information 学习笔记</a></p>
  </li>
</ul>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2020/08/22/bocd/" data-toggle="tooltip" data-placement="top" title="BOCD">
                        Previous<br>
                        <span>BOCD</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/09/04/bayesian-meta-learning/" data-toggle="tooltip" data-placement="top" title="Bayesian MAML">
                        Next<br>
                        <span>Bayesian MAML</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">
                
                <section class="author-profile">
    <div class="info"> 
        <div class="avatar">
            <img src="/img/header-avatar.jpeg">
        </div>
        <h1>Renovamen</h1>
    </div>
    <span>
        <a href="https://www.jinrishici.com/" target="_blank">
            <i class="fas fa-pencil-alt"></i>
        </a>
        <p id="poem-item">作诗中...</p>
        <br><p id="poem-info"></p>
    </span>
</section>
                
                
                    <!-- Comment container -->

<!-- disqus -->

<div class="comment">
    <div id="gitalk-container"></div>
</div>

<!-- Valine -->

                
            </div>  

            <!-- Side Catalog Container -->
            
                <!-- Side Catalog Container -->
<div class="
    col-lg-2 col-lg-offset-0
    sidebar-container
    catalog-container">
    <div class="side-catalog">
        <hr class="hidden-sm hidden-xs">
        <h5>
            <a class="catalog-toggle" href="#">CATALOG</a>
        </h5>
        <ul class="catalog-body"></ul>
    </div>
</div>
            
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>

<script>
    $("script[type='math/tex']").replaceWith(function() {
        var tex = $(this).text();
        return katex.renderToString(tex, {displayMode: false});
    });
  
    $("script[type='math/tex; mode=display']").replaceWith(function() {
        var tex = $(this).html();
        return katex.renderToString(tex.replace(/%.*/g, ''), {displayMode: true});
    });
</script>
    


<!-- Renovamen: add support for chart and mermaid -->

    <!-- Borrowed from: https://github.com/kitian616/jekyll-TeXt-theme -->
<!-- Chart.js: https://www.chartjs.org/docs/latest/ -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js", function(){
        var $canvas = null, $this = null, _ctx = null, _text = '';
        $('.language-chart').each(function(){
            $this = $(this);
            $canvas = $('<canvas></canvas>');
            _text = $this.text();
            $this.text('').append($canvas);
            _ctx = $canvas.get(0).getContext('2d');
            (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
        });
    })

    $('.language-chart').parent().css({
        "background-color": "transparent",
        "border": "none",
    });
</script>





    <!-- Borrowed from: https://github.com/kitian616/jekyll-TeXt-theme -->
<!-- mermaid.js: https://mermaid-js.github.io/mermaid/ -->
<script>
    LazyLoad.js('https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js', function() {
        mermaid.initialize({
            startOnLoad: true
        });
        mermaid.init(undefined, '.language-mermaid');
    });

    $('.language-mermaid').parent().css({
        "background-color": "transparent",
        "border": "none",
    });
</script>


<!-- Renovamen: add support for additional emoji -->

    <script>
$('.emoji-plus').each(function(){
    var $this = $(this);
    var imgURL = '/img/emoji/bilitv/' + $this.text() + '.gif';
    var $img = $('<img class="emoji-plus" src="' + imgURL + '" height="30" width="30">');
    $this.replaceWith($img);
});
</script>


<!-- comment -->

    <!-- Gitalk start -->
<script type="text/javascript">
    LazyLoad.js(['/js/library/md5.js ', 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js'], function(){
        var gitalk = new Gitalk({
            clientID: 'd6247712dc288a5a60ca',
            clientSecret: 'ed1ec72417828343c79ed910a1b77d140fa715a7',
            repo: 'gitalk-comments',
            owner: 'This-is-an-Apple',
            admin: ['Renovamen', 'This-is-an-Apple'],
            id: md5(location.pathname),
            distractionFreeMode: false
        });
        gitalk.render('gitalk-container');
    })
</script>
<!-- Gitalk end -->






    <!-- anchor.js: http://bryanbraun.github.io/anchorjs/ -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/anchor-js@4.2.2/anchor.min.js", function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


<!-- Renovamen: add support 今日诗词: https://www.jinrishici.com/ -->
<script type="text/javascript">
    LazyLoad.js(['https://sdk.jinrishici.com/v2/browser/jinrishici.js'], function(){
        jinrishici.load(function(result) {
            var poem = document.querySelector('#poem-item');
            var info = document.querySelector('#poem-info');

            if (result.status === "success") {
                var data = result.data
                console.log(data)
                poem.innerHTML = data.content;
                info.innerHTML = '【' + data.origin.dynasty + '】' + data.origin.author + '《' + data.origin.title + '》';
            }
        });
    })
</script>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                <!-- 


<div class="list-inline text-center">

  
  <a target="_blank" href="https://github.com/Renovamen">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-github-alt fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.linkedin.com/in/xiaohan-zou-55bba0160">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.facebook.com/renovamen.zou">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://twitter.com/renovamen_zxh">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.zhihu.com/people/chao-neng-gui-su">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-stack-1x fa-inverse">知</i>
    </span>
  </a>
  
  
  
  <a href="mailto:renovamenzxh@gmail.com">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="/feed.xml">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
</div> -->
                <p class="copyright">
                    &copy; <a href="https://github.com/Renovamen" target="_blank">Renovamen</a> 2018
                    <br>
                    Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & <a href="https://github.com/Renovamen/renovamen.github.io" target="_blank">Gungnir</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<!-- Renovamen: has been included in `head.html` already -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script> -->

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<!-- Renovamen: Maybe don't need this anymore -->
<!-- <script src="/js/library/bootstrap.min.js "></script> -->

<!-- add dark / light detection -->
<!-- dark / light detection, borrowed from gridsome.org -->
<script>
  (function() {
    window.__onThemeChange = function() {};
    function setTheme(newTheme) {
      window.__theme = newTheme;
      preferredTheme = newTheme;
      document.body.setAttribute('data-theme', newTheme);
      window.__onThemeChange(newTheme);
      setThemeIcon(newTheme)
    }

    var preferredTheme;
    try {
      preferredTheme = localStorage.getItem('theme');
    } catch (err) { }

    window.__setPreferredTheme = function(newTheme) {
      setTheme(newTheme);
      try {
        localStorage.setItem('theme', newTheme);
      } catch (err) {}
    }

    var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

    darkQuery.addListener(function(e) {
      window.__setPreferredTheme(e.matches ? 'dark' : 'light');
    });

    setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
  })();
</script>

<!-- Theme JavaScript -->
<script src="/js/gungnir.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js"></script>
<script src="/js/sw-registration.js"></script>



<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!--fastClick.js -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

    <!-- Google Analytics -->
<script>
    // dynamic User by Hux
    var _gaId = 'UA-146858305-1';
    var _gaDomain = 'renovamen.ink';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->

    <!-- Baidu Tongji -->
<script>
    // dynamic User by Hux
    var _baId = '75381d210789d3eaf855fa16246860cc';

    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>



<!-- Side Catalog -->

    <!-- tocbot: https://github.com/tscanlin/tocbot -->

<!-- 
    Didn't use lazyload here because it will cause some bugs in catalog 
    generating when swtiching between two languages. 
    I'm trying to find a better solution.
-->

<link href="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.css" rel="stylesheet" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.min.js"></script>

<script type="text/javascript">
    function generateCatalog(selector) {

        // links page
        if('post' == 'links') {
            _containerSelector = 'div.link-list'
        }
        // interop with multilangual 
        else {
            if ('' == 'true') {
                _containerSelector = 'div.post-container.active'
            } 
            else {
                _containerSelector = 'div.post-container'
            }
        }
        
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: selector,
            // Where to grab the headings to build the table of contents.
            contentSelector: _containerSelector,
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h2, h3, h4, h5, h6',
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))
</script>



<!-- Multi-Lingual -->

    </div>

    <!-- modify styles of navbar on mobile -->
    <div class="mobile-nav">
    <div class="mobile-menu-avatar">
        <div class="avatar-container">
            <img src="/img/header-avatar.jpeg">
        </div>
    </div>
    <p class="mobile-menu-heading">Meow?</p>
    


<div class="list-inline text-center">

  
  <a target="_blank" href="https://github.com/Renovamen">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-github-alt fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.linkedin.com/in/xiaohan-zou-55bba0160">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.facebook.com/renovamen.zou">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://twitter.com/renovamen_zxh">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.zhihu.com/people/chao-neng-gui-su">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-stack-1x fa-inverse">知</i>
    </span>
  </a>
  
  
  
  <a href="mailto:renovamenzxh@gmail.com">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="/feed.xml">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
</div>
    <ul>
        
        <li>
            
            <a href="/" class="faa-parent animated-hover">
            
                
                <i class="fab fa-fort-awesome fa-lg faa-wrench"></i>
                
                Home
            </a>
            
        </li>
        
        <li>
            
            <a href="/about/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-paw fa-lg faa-wrench"></i>
                
                About
            </a>
            
        </li>
        
        <li>
            
            <a href="/archive/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-archive fa-lg faa-wrench"></i>
                
                Archive
            </a>
            
        </li>
        
        <li>
            
            <a href="/links/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-link fa-lg faa-wrench"></i>
                
                Links
            </a>
            
        </li>
        

        <li>
            <a id="mobile-search-btn" class="faa-parent animated-hover">
                <i class="fas fa-search fa-lg faa-wrench"></i> Search
            </a>
        </li>
    </ul>
</div>

    <!-- support search -->
    <div id="search" class="search-page">

    <i class="search-close fas fa-chevron-down"></i>
    <p class="search-title text-center"></p>

    <div class="input">
        <input 
            id="search-input" 
            type="text" 
            class="search-field" 
            placeholder="Just search ..." 
            onkeypress="checkCode()"
            style="background-color: transparent"
        >
    </div>
    <div id="search-results" class="search-results"></div>

    <img class="search-img-right" src="/img/search-right.gif"/>
</div><script>
    // simple-jekyll-search.js
    LazyLoad.js("https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js", function(){
        SimpleJekyllSearch({
            searchInput: document.getElementById('search-input'),
            resultsContainer: document.getElementById('search-results'),
            json: '/search.json',
            searchResultTemplate: '<li class="result-item item"><a href="{url}" title="{desc}"><div class="result-item-title">{title}</div><div class="result-item-subtitle">{subtitle}</div></a></li>',
            noResultsText: '<li class="result-item item"><div class="result-item-title">No Results</div></li>',
            limit: 20,
            fuzzy: false
        })
    })

    // search-results 高度适配
    $('.search-results').css({
        'height': $(window).height() - 200 + "px"
    });

    function checkCode() {
        if (event.keyCode == 13) {
            getCode = $('#search-input').val();
            if(getCode == "cd dark universe") {
                window.location.href = "https://renovamen.gitee.io/dark-universe/";
            }
            else if(getCode == "cd resume") {
                window.location.href = "https://renovamen.ink/Endless-Resume/";
            }
        }
    }

    function autoFocus() {
        setTimeout(function () {
            document.querySelector('.search-page input').focus();
        }, 400);
    }

    // open search page
    $('#search-btn').click(function() {
        $('.search-page').toggleClass('open')
        autoFocus()
    });

    // open search page (mobile)
    $('#mobile-search-btn').click(function() {
        $('.search-page').toggleClass('open')
        autoFocus()
    });

    // close search page
    $('.search-close').click(function() {
        $('.search-page').toggleClass('open')
    });
</script>
    
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
