<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Xiaohan Zou's blog">
    <meta name="keywords"  content="">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="贝叶斯神经网络 - Renovamen (Xiaohan Zou)">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="Radford Neal: I don’t necessarily think that the Bayesian method is the best thing to do in all cases…
">
    
    <meta property="article:published_time" content="2020-08-16T00:00:00Z">
    
    
    <meta property="article:author" content="Renovamen">
    
    
    <meta property="article:tag" content="Machine Learning">
    
    <meta property="article:tag" content="Deep Learning">
    
    <meta property="article:tag" content="Math">
    
    <meta property="article:tag" content="Bayesian">
    
    
    <meta property="og:image" content="https://renovamen.inkimg/header-avatar.jpeg">
    <meta property="og:url" content="https://renovamen.ink/2020/08/16/bayesian-neural-network/">
    <meta property="og:site_name" content="Renovamen (Xiaohan Zou)">
    
    <title>贝叶斯神经网络 - Renovamen (Xiaohan Zou)</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.svg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://renovamen.ink/2020/08/16/bayesian-neural-network/"><!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.2/dist/css/bootstrap.min.css">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200"/>

    <!-- Custom Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" rel="stylesheet" type="text/css">
    
    <!-- Font Awesome Animation -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome-animation@0.2.1/dist/font-awesome-animation.min.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/gungnir.css">
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script>

    <!-- Lazyload (.js & .css)-->
    <script>// https://github.com/rgrove/lazyload

/*jslint browser: true, eqeqeq: true, bitwise: true, newcap: true, immed: true, regexp: false */

/**
LazyLoad makes it easy and painless to lazily load one or more external
JavaScript or CSS files on demand either during or after the rendering of a web
page.
Supported browsers include Firefox 2+, IE6+, Safari 3+ (including Mobile
Safari), Google Chrome, and Opera 9+. Other browsers may or may not work and
are not officially supported.
Visit https://github.com/rgrove/lazyload/ for more info.
Copyright (c) 2011 Ryan Grove <ryan@wonko.com>
All rights reserved.
Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the 'Software'), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
@module lazyload
@class LazyLoad
@static
*/

LazyLoad = (function (doc) {
    // -- Private Variables ------------------------------------------------------
  
    // User agent and feature test information.
    var env,
  
    // Reference to the <head> element (populated lazily).
    head,
  
    // Requests currently in progress, if any.
    pending = {},
  
    // Number of times we've polled to check whether a pending stylesheet has
    // finished loading. If this gets too high, we're probably stalled.
    pollCount = 0,
  
    // Queued requests.
    queue = {css: [], js: []},
  
    // Reference to the browser's list of stylesheets.
    styleSheets = doc.styleSheets;
  
    // -- Private Methods --------------------------------------------------------
  
    /**
    Creates and returns an HTML element with the specified name and attributes.
    @method createNode
    @param {String} name element name
    @param {Object} attrs name/value mapping of element attributes
    @return {HTMLElement}
    @private
    */
    function createNode(name, attrs) {
        var node = doc.createElement(name), attr;
    
        for (attr in attrs) {
            if (attrs.hasOwnProperty(attr)) {
                node.setAttribute(attr, attrs[attr]);
            }
        }
    
        return node;
    }
  
    /**
    Called when the current pending resource of the specified type has finished
    loading. Executes the associated callback (if any) and loads the next
    resource in the queue.
    @method finish
    @param {String} type resource type ('css' or 'js')
    @private
    */
    function finish(type) {
        var p = pending[type],
            callback,
            urls;
    
        if (p) {
            callback = p.callback;
            urls     = p.urls;
    
            urls.shift();
            pollCount = 0;
    
            // If this is the last of the pending URLs, execute the callback and
            // start the next request in the queue (if any).
            if (!urls.length) {
                callback && callback.call(p.context, p.obj);
                pending[type] = null;
                queue[type].length && load(type);
            }
        }
    }
  
    /**
    Populates the <code>env</code> variable with user agent and feature test
    information.
    @method getEnv
    @private
    */
    function getEnv() {
        var ua = navigator.userAgent;
    
        env = {
            // True if this browser supports disabling async mode on dynamically
            // created script nodes. See
            // http://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order
            async: doc.createElement('script').async === true
        };
    
        (env.webkit = /AppleWebKit\//.test(ua))
            || (env.ie = /MSIE|Trident/.test(ua))
            || (env.opera = /Opera/.test(ua))
            || (env.gecko = /Gecko\//.test(ua))
            || (env.unknown = true);
    }
  
    /**
    Loads the specified resources, or the next resource of the specified type
    in the queue if no resources are specified. If a resource of the specified
    type is already being loaded, the new request will be queued until the
    first request has been finished.
    When an array of resource URLs is specified, those URLs will be loaded in
    parallel if it is possible to do so while preserving execution order. All
    browsers support parallel loading of CSS, but only Firefox and Opera
    support parallel loading of scripts. In other browsers, scripts will be
    queued and loaded one at a time to ensure correct execution order.
    @method load
    @param {String} type resource type ('css' or 'js')
    @param {String|Array} urls (optional) URL or array of URLs to load
    @param {Function} callback (optional) callback function to execute when the
      resource is loaded
    @param {Object} obj (optional) object to pass to the callback function
    @param {Object} context (optional) if provided, the callback function will
      be executed in this object's context
    @private
    */
    function load(type, urls, callback, obj, context) {
        var _finish = function () { finish(type); },
            isCSS   = type === 'css',
            nodes   = [],
            i, len, node, p, pendingUrls, url;
  
        env || getEnv();
  
        if (urls) {
            // If urls is a string, wrap it in an array. Otherwise assume it's an
            // array and create a copy of it so modifications won't be made to the
            // original.
            urls = typeof urls === 'string' ? [urls] : urls.concat();
    
            // Create a request object for each URL. If multiple URLs are specified,
            // the callback will only be executed after all URLs have been loaded.
            //
            // Sadly, Firefox and Opera are the only browsers capable of loading
            // scripts in parallel while preserving execution order. In all other
            // browsers, scripts must be loaded sequentially.
            //
            // All browsers respect CSS specificity based on the order of the link
            // elements in the DOM, regardless of the order in which the stylesheets
            // are actually downloaded.
            if (isCSS || env.async || env.gecko || env.opera) {
                // Load in parallel.
                queue[type].push({
                    urls    : urls,
                    callback: callback,
                    obj     : obj,
                    context : context
                });
            } 
            else {
                // Load sequentially.
                for (i = 0, len = urls.length; i < len; ++i) {
                    queue[type].push({
                        urls    : [urls[i]],
                        callback: i === len - 1 ? callback : null, // callback is only added to the last URL
                        obj     : obj,
                        context : context
                    });
                }
            }
        }
  
        // If a previous load request of this type is currently in progress, we'll
        // wait our turn. Otherwise, grab the next item in the queue.
        if (pending[type] || !(p = pending[type] = queue[type].shift())) {
            return;
        }
    
        head || (head = doc.head || doc.getElementsByTagName('head')[0]);
        pendingUrls = p.urls.concat();

        for (i = 0, len = pendingUrls.length; i < len; ++i) {
            url = pendingUrls[i];
    
            if (isCSS) {
                node = env.gecko ? createNode('style') : createNode('link', {
                    href: url,
                    rel : 'stylesheet'
                });
            } 
            else {
                node = createNode('script', {src: url});
                node.async = false;
            }
    
            node.className = 'lazyload';
            node.setAttribute('charset', 'utf-8');
    
            if (env.ie && !isCSS && 'onreadystatechange' in node && !('draggable' in node)) {
                node.onreadystatechange = function () {
                    if (/loaded|complete/.test(node.readyState)) {
                        node.onreadystatechange = null;
                        _finish();
                    }
                };
            } 
            else if (isCSS && (env.gecko || env.webkit)) {
                // Gecko and WebKit don't support the onload event on link nodes.
                if (env.webkit) {
                    // In WebKit, we can poll for changes to document.styleSheets to
                    // figure out when stylesheets have loaded.
                    p.urls[i] = node.href; // resolve relative URLs (or polling won't work)
                    pollWebKit();
                } 
                else {
                    // In Gecko, we can import the requested URL into a <style> node and
                    // poll for the existence of node.sheet.cssRules. Props to Zach
                    // Leatherman for calling my attention to this technique.
                    node.innerHTML = '@import "' + url + '";';
                    pollGecko(node);
                }
            } 
            else {
                node.onload = node.onerror = _finish;
            }
    
            nodes.push(node);
        }
    
        for (i = 0, len = nodes.length; i < len; ++i) {
            head.appendChild(nodes[i]);
        }
    }
  
    /**
    Begins polling to determine when the specified stylesheet has finished loading
    in Gecko. Polling stops when all pending stylesheets have loaded or after 10
    seconds (to prevent stalls).
    Thanks to Zach Leatherman for calling my attention to the @import-based
    cross-domain technique used here, and to Oleg Slobodskoi for an earlier
    same-domain implementation. See Zach's blog for more details:
    http://www.zachleat.com/web/2010/07/29/load-css-dynamically/
    @method pollGecko
    @param {HTMLElement} node Style node to poll.
    @private
    */
    function pollGecko(node) {
        var hasRules;
    
        try {
            // We don't really need to store this value or ever refer to it again, but
            // if we don't store it, Closure Compiler assumes the code is useless and
            // removes it.
            hasRules = !!node.sheet.cssRules;
        } 
        catch (ex) {
            // An exception means the stylesheet is still loading.
            pollCount += 1;

            if (pollCount < 200) {
                setTimeout(function () { pollGecko(node); }, 50);
            } 
            else {
                // We've been polling for 10 seconds and nothing's happened. Stop
                // polling and finish the pending requests to avoid blocking further
                // requests.
                hasRules && finish('css');
            }
            return;
        }
    
        // If we get here, the stylesheet has loaded.
        finish('css');
    }
    
    /**
    Begins polling to determine when pending stylesheets have finished loading
    in WebKit. Polling stops when all pending stylesheets have loaded or after 10
    seconds (to prevent stalls).
    @method pollWebKit
    @private
    */
    function pollWebKit() {
        var css = pending.css, i;

        if (css) {
            i = styleSheets.length;

            // Look for a stylesheet matching the pending URL.
            while (--i >= 0) {
                if (styleSheets[i].href === css.urls[0]) {
                    finish('css');
                    break;
                }
            }

            pollCount += 1;
    
            if (css) {
                if (pollCount < 200) {
                    setTimeout(pollWebKit, 50);
                } 
                else {
                    // We've been polling for 10 seconds and nothing's happened, which may
                    // indicate that the stylesheet has been removed from the document
                    // before it had a chance to load. Stop polling and finish the pending
                    // request to prevent blocking further requests.
                    finish('css');
                }
            }
        }
    }
    
    return {
    
        /**
         Requests the specified CSS URL or URLs and executes the specified
        callback (if any) when they have finished loading. If an array of URLs is
        specified, the stylesheets will be loaded in parallel and the callback
        will be executed after all stylesheets have finished loading.
        @method css
        @param {String|Array} urls CSS URL or array of CSS URLs to load
        @param {Function} callback (optional) callback function to execute when
        the specified stylesheets are loaded
        @param {Object} obj (optional) object to pass to the callback function
        @param {Object} context (optional) if provided, the callback function
        will be executed in this object's context
        @static
        */
        css: function (urls, callback, obj, context) {
            load('css', urls, callback, obj, context);
        },
    
        /**
         Requests the specified JavaScript URL or URLs and executes the specified
        callback (if any) when they have finished loading. If an array of URLs is
        specified and the browser supports it, the scripts will be loaded in
        parallel and the callback will be executed after all scripts have
        finished loading.
        Currently, only Firefox and Opera support parallel loading of scripts while
        preserving execution order. In other browsers, scripts will be
        queued and loaded one at a time to ensure correct execution order.
        @method js
        @param {String|Array} urls JS URL or array of JS URLs to load
        @param {Function} callback (optional) callback function to execute when
        the specified scripts are loaded
        @param {Object} obj (optional) object to pass to the callback function
        @param {Object} context (optional) if provided, the callback function
        will be executed in this object's context
        @static
        */
        js: function (urls, callback, obj, context) {
            load('js', urls, callback, obj, context);
        }
    };
})(this.document);</script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Renovamen: add menu button -->
    <div class="menu-btn-container">
    <div class="menu-btn-wrapper">
        <div class="menu-btn">
            <div class="menu-btn-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="menu-text"></div>
            <svg class="menu-svg">
                <circle class="menu-border" cx="50%" cy="50%" r="48%"></circle>
            </svg>
        </div>
        <div class="menu-btn-child-wrapper">
            <div class="menu-btn-child" id="menu-theme-btn">
                <span class="fa icon-theme"></span>
            </div>
            <div class="menu-btn-child" onclick="smoothTo('bottom')">
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="menu-btn-child" onclick="smoothTo('top')">
                <i class="fas fa-chevron-up"></i>
            </div>
            
            
            <div class="menu-btn-child" id="menu-toc-btn">
                <i class="fas fa-list-ul"></i>
            </div>
            
            
            <div class="menu-btn-child" id="menu-navbar-btn">
                <i class="far fa-window-restore"></i>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // open menu
    $('.menu-btn').click(function() {
        $('.menu-btn-container').toggleClass('open');
    });
    
    // open navbar
    $('#menu-navbar-btn').click(function() {
        mobileNavToggle();
    });

    // open catalog
    $('#menu-toc-btn').click(function() {
        $('.side-catalog').toggleClass('open');
    });

    // set theme icon in menu
    function setThemeIcon(newTheme) {
        const icons = {
            'light': '"\\f185"', 
            'dark': '"\\f186"', 
            'sepia': '"\\f0f4"'
        }
        $('#menu-theme-btn').append(
            '<style>.icon-theme:before{content:' + icons[newTheme] + '}</style>'
        );
    }

    function toggleTheme() {
        const themes = ['light', 'dark', 'sepia']
        // get current theme
        const currentTheme = window.__theme
        const currentIndex = themes.indexOf(currentTheme)
        // set next theme
        const nextIndex = (currentIndex + 1) % themes.length
        const nextTheme = themes[nextIndex]
        window.__setPreferredTheme(nextTheme)
        setThemeIcon(nextTheme)
    }

    // change theme
    $('#menu-theme-btn').click(function() {
        toggleTheme()
    });
</script>

    <div class="main-container">
    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <!-- navbar toggle for old mobile menu button (by Hux) -->
            <!-- <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button> -->
            <a class="navbar-brand" href="/">$ cd /home/</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">

                    
                    <li>
                        
                        <a href="/" class="faa-parent animated-hover">
                        
                            
                            <i class="fab fa-fort-awesome fa-lg faa-wrench"></i>
                            
                            Home
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/about/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-paw fa-lg faa-wrench"></i>
                            
                            About
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/archive/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-archive fa-lg faa-wrench"></i>
                            
                            Archive
                        </a>
                        
                    </li>
                    
                    <li>
                        
                        <a href="/links/" class="faa-parent animated-hover">
                        
                            
                            <i class="fas fa-link fa-lg faa-wrench"></i>
                            
                            Links
                        </a>
                        
                    </li>
                    
                    <li>
                        <a id="search-btn" class="faa-parent animated-hover">
                            <i class="fas fa-search fa-lg faa-wrench"></i> Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Old Mobile Navbar Script (By Hux) -->
<!-- <script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script> -->

    <!-- Image to hack wechat -->
<!-- <img src="/img/in-post/2020-08-16/header.png" width="0" height="0"> -->

<!-- Post Header -->



    
    <style type="text/css">
        header.intro-header{
            position: relative;
            background-image: url('/img/in-post/2020-08-16/header.png');
            background: ;
        }

        
    </style>
    
    





<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Machine+Learning" title="Machine Learning">Machine Learning</a>
                        
                        <a class="tag" href="/archive/?tag=Deep+Learning" title="Deep Learning">Deep Learning</a>
                        
                        <a class="tag" href="/archive/?tag=Math" title="Math">Math</a>
                        
                        <a class="tag" href="/archive/?tag=Bayesian" title="Bayesian">Bayesian</a>
                        
                    </div>
                    <h1>贝叶斯神经网络</h1>
                    
                    <h2 class="subheading">万恶的贝叶斯嗷，真的学得会吗</h2>
                    
                    <span class="meta">Posted by Renovamen on August 16, 2020</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>











<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<p>Radford Neal: I don’t necessarily think that the Bayesian method is the best thing to do in all cases…</p>

<p>Geoff Hinton: Sorry Radford, my prior probability for you saying this is zero, so I couldn’t hear what you said.</p>

<h2 id="关于贝叶斯估计">关于贝叶斯估计</h2>

<p>\(X\) 的概率密度函数为 \(p_\theta(X)\)，现在观测到了一组样本 \((X_1, X_2, \dots, X_n) = (x_1, x_2, \dots, x_n)\)，要估计参数 \(\theta\)。</p>

<h3 id="极大似然估计">极大似然估计</h3>

<p><strong>极大似然估计（Maximum Likelihood Estimation，MLE）</strong>，频率学派的思想。频率学派的观点是：模型参数 \(\theta\) 存在唯一真值，只是这个真值是未知的。如果当 \(\theta = 
\hat{\theta}_{\text{MLE}}\) 时，事件 \((X_1, X_2, \dots, X_n) = (x_1, x_2, \dots, x_n)\) 发生的可能性最大，那么就说 \(\hat{\theta}_{\text{MLE}}\) 是 \(\theta\) 的极大似然估计。</p>

\[\begin{aligned}
  \hat{\theta}_{\text{MLE}}&amp;= \arg \max_\theta p_\theta(x) \\
    &amp;= \arg \max_\theta \prod_{i=1}^n p_\theta(x_i) \\
    &amp;= \arg \max_\theta \log \prod_{i=1}^n p_\theta(x_i) \\
    &amp;= \arg \max_\theta \sum_{i=1}^n \log p_\theta(x_i) \\
    &amp;= \arg \min_\theta - \sum_{i=1}^n \log p_\theta(x_i)
\end{aligned}\]

<p>也就是说最后需要优化的是 Negative Log Likelihood (NLL)。经常看到的用频率学派的方法求抛硬币概率的问题，本质上就是在优化 NLL：</p>

<p>抛硬币可以看做参数为 \(\theta\) 的 Bernoulli 分布：</p>

\[p_\theta(x_i) = 

\begin{cases}
  \theta &amp;x_i = 1 \\
  1 - \theta &amp;x_i = 0
\end{cases}

= \theta^{x_i} (1 - \theta)^{1-x_i}\]

<p>那么 NLL：</p>

\[\text{NLL} = - \sum_{i=1}^n \log p_\theta(x_i) = - \sum_{i=1}^n \log \theta^{x_i} (1 - \theta)^{1-x_i}\]

<p>令导数为 0 来求极值：</p>

\[\text{NLL}' = - \sum_{i=1}^n \left (\frac{x_i}{\theta} + (1-x_i) \frac{-1}{1 - \theta} \right ) = 0\]

\[\rArr \frac{\sum_{i=1}^n x_i}{\theta} - \frac{n - \sum_{i=1}^n x_i}{1 - \theta}  = 0\]

\[\rArr \theta = \frac{\sum_{i=1}^n x_i}{n}\]

<p>即 \(\theta\) 为正面的次数除以总共的抛硬币次数。</p>

<h3 id="贝叶斯估计">贝叶斯估计</h3>

<p><strong>贝叶斯估计（Bayesian Estimation）</strong>，贝叶斯学派的思想。贝叶斯学派认为 \(\theta\) 也是随机的，和一般的随机变量没有本质区别，因此只能根据观测样本去估计参数 \(\theta\) 的分布。其基础是贝叶斯公式：</p>

\[p(\theta \mid x) = \frac{p(x \mid \theta)p(\theta)}{p(x)}\]

\[p(x) = \sum_\theta p(x \mid \theta)p(\theta)\]

\[\hat{\theta}_{\text{BE}} = \mathbb{E}[p(\theta \mid x)]\]

<p>其中：</p>

<ul>
  <li>
    <p>\(p(\theta)\)：<strong>先验（prior）</strong>，指在没有观测到任何数据时对 \(\theta\) 的预先判断，比如认为硬币大概率是均匀的，所以 \(\theta\) 的先验可以是最大值取在 0.5 处的 Beta 分布；</p>
  </li>
  <li>
    <p>\(p(x \mid \theta)\)：<strong>似然（likelihood）</strong>，假设 \(\theta\) 已知后，观测数据应该是什么样子；</p>
  </li>
  <li>
    <p>\(p(\theta \mid x)\)：<strong>后验（posterior）</strong>，最终的参数分布；</p>
  </li>
  <li>
    <p>\(p(x)\)，样本的先验，一个常量（和要估计的参数无关）。</p>
  </li>
</ul>

<p>相当于贝叶斯估计是在 \(\theta\) 服从先验分布 \(p(\theta)\) 的前提下，然后根据观测到的样本去校正先验分布，最终得到后验分布 \(p(\theta \mid x)\)，然后取后验分布的期望作为参数的估计值。</p>

<p>如果先验是均匀分布，则贝叶斯估计等价于极大似然，因为先验是均匀分布相当于对参数没有任何预判。</p>

<h3 id="最大后验估计">最大后验估计</h3>

<p>贝叶斯估计估计的是 \(\theta\) 的后验分布，而<strong>最大后验估计（Maximum a Posteriori，MAP）</strong>考虑的是后验分布极大化时 \(\theta\) 的取值：</p>

\[\begin{aligned}
  \hat{\theta}_{\text{MAP}}&amp;= \arg \max_\theta p(\theta \mid x) \\
    &amp;= \arg \min_\theta - \log p(\theta \mid x) \\
    &amp;=  \arg \min_\theta - \log \frac{p(x \mid \theta)p(\theta)}{p(x)}\\
    &amp;=  \arg \min_\theta - \log p(x \mid \theta) - \log p(\theta) + \log p(x)\\
    &amp;=  \arg \min_\theta - \log p(x \mid \theta) - \log p(\theta)
\end{aligned}\]

<p>\(- \log p(x \mid \theta)\) 就是 NLL，所以相比 MLE，MAP 就是在优化时多了一个先验项 \(p(\theta)\)。在有的情况下，\(- \log p(\theta)\) 可以看做用 MLE 时结构化风险里的正则化项，比如当先验是一个高斯分布：</p>

\[\\[2px]
p(\theta) = \text{constant} \times e^{- \frac{\theta^2}{2 \sigma^2}}\]

<p>constant 是一个参数无关的常数项，在上式中它相当于 \(\frac{1}{\sqrt{2 \pi} \sigma}\)。那么：</p>

\[- \log p(\theta) = \text{constant} + \frac{\theta^2}{2 \sigma^2}\]

<p>这时的 \(- \log p(\theta)\) 就相当于一个 L2 正则化项（倾向于取小值）。</p>

<p>而当先验是一个拉普拉斯分布（Laplace Distribution）时，\(- \log p(\theta)\) 相当于一个 L1 正则化（倾向于取 0 使权重稀疏）。</p>

<p>MAP 提供了一个直观的方法来设计复杂但可解释的正则化项，比如可以通过把混合高斯分布作为先验来得到更复杂的正则化项。</p>

<h2 id="贝叶斯神经网络">贝叶斯神经网络</h2>

<p>这一节主要基于论文：</p>

<p><strong>Weight Uncertainty in Neural Networks.</strong> <em>Charles Blundell, et al.</em> ICML 2015. <a href="https://arxiv.org/pdf/1505.05424.pdf" target="_blank">[Paper]</a></p>

<p>在看这一节之前，或许先去看看<a href="https://notebook.renovamen.ink/ai/ml/pcg/" target="_blank">概率图模型</a>中的贝叶斯网络部分比较好。</p>

<p>优点：</p>

<ul>
  <li>
    <p>贝叶斯神经网络中的权重都是随机变量，做预测的时候用的是采样后的权重，所以可以集成某权重分布上的多组神经网络进行预测，相当于 ensemble。</p>
  </li>
  <li>
    <p>反应数据中的不确定性（aleatoric uncertainty）</p>

    <ul>
      <li>
        <p><a href="https://alexgkendall.com/computer_vision/bayesian_deep_learning_for_safe_ai/" target="_blank">Deep Learning Is Not Good Enough, We Need Bayesian Deep Learning for Safe AI</a></p>
      </li>
      <li>
        <p><a href="https://zhuanlan.zhihu.com/p/88654038" target="_blank">贝叶斯神经网络建模两类不确定性</a></p>
      </li>
    </ul>
  </li>
  <li>
    <p>为权重引入不确定性进行正则化</p>
  </li>
</ul>

<h3 id="神经网络模型">神经网络模型</h3>

<p>这是一个神经元：</p>

<p><img src="/img/in-post/2020-08-16/neuron.png" alt="neuron" width="400px" /></p>

<p>一般的神经网络中，\(w\) 和 \(b\) 都是确定的值。对于数据集 \(D = \{(x_1, y_1), \dots, (x_n, y_n)\}\)，其学习可以视作是一个极大似然估计：</p>

\[\begin{aligned}
  w_{\text{MLE}}&amp;= \arg \max_w \log p(D \mid w) \\
    &amp;= \arg \max_w \sum_{i=1}^n \log p(y_i \mid x_i, w)
\end{aligned}\]

<p>有些时候我们对 \(w\) 有一些偏好，于是如<a href="#最大后验估计">之前</a>所说，引入先验（最大后验估计）可以引入正则化项：</p>

\[\begin{aligned}
  w_{\text{MAP}}&amp;= \arg \max_w \log p(w \mid D) \\
    &amp;= \arg \max_w \log p(D \mid w) + \log p(w)
\end{aligned}\]

<h3 id="气氛突然贝叶斯了起来">气氛突然贝叶斯了起来</h3>

<p>而在<strong>贝叶斯神经网络（Bayesian Neural Network，BNN）</strong>中，\(w\) 和 \(b\) 由确定的值变为了分布，因此概率模型就变为了：</p>

\[p(y \mid x) = \mathbb{E}_{p(w \mid D)} [p(y \mid x, w)]\]

<p>那么存在两个问题：</p>

<ul>
  <li>
    <p>后验 \(p(w \mid D)\) 是 intractable 的。由贝叶斯公式：</p>

\[p(w \mid D) = \frac{p(D \mid w)p(w)}{p(D)}\]

    <p>而输入数据分布 \(p(D)\) 通常是是 intractable 的，因为这相当于要对所有可能的 \(w\) 求和（或积分）：</p>

\[p(D) = \sum_w p(D \mid w)p(w)\]
  </li>
  <li>
    <p>期望 \(p(y \mid x)\) 也不好求，因为这相当于要对每一个可能的 \(p(w \mid D)\) 计算神经网络的预测值</p>
  </li>
</ul>

<p>朋友，搞不定的分布就上<strong>变分推断</strong>，乌拉！（不是</p>

<h3 id="变分推断">变分推断</h3>

<p>对于第一个问题求后验 \(p(w \mid D)\)，可以用变分推断（variational inference）来解决。变分推断可以参考<a href="https://notebook.renovamen.ink/ai/ml/pcg/variational-inference/" target="_blank">这里</a>，其思想是用一个由参数 \(\theta\) 控制的分布 \(q(w \mid \theta)\) 来近似 \(p(w \mid D)\)，这两个分布之间的 KL 散度要尽可能小：</p>

\[\begin{aligned}
  \theta^\text{*} &amp;= \arg \min_\theta \text{KL} [q(w | \theta) \| p(w | D)] \\
    &amp;= \arg \min_\theta \sum_w q(w | \theta) \log \frac{q(w | \theta)}{p(w | D)} \\
    &amp;= \arg \min_\theta \sum_w q(w | \theta) \log \frac{q(w | \theta)p(D)}{p(D | w)p(w)} \\
    &amp;= \arg \min_\theta \sum_w q(w | \theta) \log \frac{q(w | \theta)}{p(w)} - \sum_w q(w | \theta) \log p(D | w) + \sum_w q(w | \theta) \log p(D) \\
    &amp;= \arg \min_\theta \text{KL} [q(w | \theta) \| p(w)] - \mathbb{E}_{q(w|\theta)} [\log p(D|w)]
\end{aligned}\]

<p>写成目标函数就是：</p>

\[F(D,\theta) = \underbrace{\text{KL} [q(w \mid \theta) \| p(w)]}_{\text{complexity
cost}} - \underbrace{\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)]}_{\text{likelihood cost}} \tag{1}\]

<p>这个函数也被称为 variational free energy，就是 ELBO 加个负号。所以我们要最大化 ELBO，但要最小化 variational free energy。</p>

<p>式 (1) 可以被看做两种代价的组合：</p>

<ul>
  <li>
    <p>complexity cost：权重和其先验的差距</p>
  </li>
  <li>
    <p>likelihood cost：对样本的拟合程度</p>
  </li>
</ul>

<p>相当于既要尽可能拟合样本，又要尽可能符合先验，在两种代价中取平衡，是一个 trade-off 的过程，可以看做正则化。</p>

<p>式 (1) 是个优化问题，所以可以上梯度下降。但在这之前，还有一些问题需要解决，因为式 (1) 没法求梯度。</p>

<h3 id="蒙特卡洛采样">蒙特卡洛采样</h3>

<p>式 (1) 的第一项中，\(q(w \mid \theta)\) 是个我们自己定的分布（通常是高斯分布），\(p(w)\) 是个我们自己定的先验（通常也是高斯分布），都有闭式解，可以直接对 \(\theta\) 求梯度。</p>

<p>主要问题在第二项 \(\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)]\) 上。这是个期望，它不好求，那么算它的时候一般会喜闻乐见地用蒙特卡洛采样来近似，即根据 \(q(w \mid \theta)\) 采样 M 个 \(w_i\)，然后有：</p>

\[\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)] \approx \frac{1}{M} \sum_{i=1}^M \log p(D \mid w_i)\]

<p>于是近似之后这一项就变得跟参数 \(\theta\) 无关了，梯度下降时这一项关于 \(\theta\) 的梯度会为 0。这是因为 \(z\) 和 \(\theta\) 之间不是确定性函数关系，而是一种采样的关系。于是就有一种叫<strong>重参数化</strong>的 trick，把这种采样的关系转变成确定性函数关系。</p>

<h3 id="重参数化">重参数化</h3>

<p><strong>重参数化（reparameterization）</strong>是<a href="https://notebook.renovamen.ink/ai/dl/generative-models/vae/" target="_blank">变分自编码器（Variational Auto-Encoder, VAE）</a>引入的操作。先引入一个分布为 \(p(\epsilon)\) 的随机变量 \(\epsilon\)，然后把期望 \(\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)]\) 重写为：</p>

\[\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)] = \mathbb{E}_{p(\epsilon)} [\log p(D \mid t(\theta, \epsilon))]\]

<p>其中 \(w \triangleq t(\theta, \epsilon)\)，是一个确定性函数，这样就可以先从 \(p(\epsilon)\) 中采样出 \(\epsilon\)，然后可导地引入 \(w\)。例如 \(q(w \mid \theta) = \mathcal{N}(\mu, \sigma^2)\)，\(\mu, \sigma\) 依赖于参数 \(\theta\)，那么可以把 \(w\) 写为：</p>

\[w \triangleq t(\theta, \epsilon) = \mu + \sigma \odot \epsilon\]

<p>其中 \(\epsilon \thicksim \mathcal{N}(0, 1)\)。</p>

<hr />

<p>而该论文对此作了推广。对于期望 \(\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)]\)，它的梯度 \(\frac{\partial}{\partial \theta} \mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)]\) 不好直接算，采样之后梯度又为 0，那么能不能把求导移到期望里面去：\(\mathbb{E}_{q(w \mid \theta)} [\frac{\partial}{\partial \theta} \log p(D \mid w)]\)？</p>

<p>并不能，因为期望（积分）是跟参数 \(\theta\) 有关的，而 \(\log p(D \mid w)\) 是与 \(\theta\) 无关的，把求导移进去的话梯度又为 0 了。因此该论文把 \(w\) 写为 \(t(\theta, \epsilon)\)，其中 \(\epsilon \thicksim q(\epsilon)\)。然后它证明了对于函数 \(f(w, \theta)\)，只要有 \(q(\epsilon)d \epsilon = q(w \mid \theta)dw\)，就有：</p>

\[\begin{aligned}
  \frac{\partial}{\partial \theta} \mathbb{E}_{q(w \mid \theta)} [f(w, \theta)] &amp;= \frac{\partial}{\partial \theta} \int f(w, \theta)q(w \mid \theta) dw \\
    &amp;= \frac{\partial}{\partial \theta} \int f(w, \theta) q(\epsilon)d \epsilon\\
    &amp;= \mathbb{E}_{q(\epsilon)} \left [\frac{\partial f(w, \theta)}{\partial w} \frac{\partial w}{\partial \theta} +  \frac{\partial f(w, \theta)}{\partial \theta} \right ]
\end{aligned}\]

<p>这时就可以把求导移进期望里了。从直觉上来理解的话，现在 \(\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)]\) 可以写成：</p>

\[\mathbb{E}_{q(w \mid \theta)} [\log p(D \mid w)] = \mathbb{E}_{q(\epsilon)} [\log p(D \mid t(\theta, \epsilon))]\]

<p>那么现在期望就和 \(\theta\) 无关，而似然则和 \(\theta\) 有关了，于是就可以把求导移进去了。</p>

<hr />

<p>论文里令 \(f(w \mid \theta) = \log q(w \mid \theta) - \log p(w)p(D \mid w)\)，则：</p>

\[F(D,\theta) = \mathbb{E}_{q(w \mid \theta)} [f(w \mid \theta)] \approx \sum_{i=1}^n \log q(w_i \mid \theta) - \log p(w_i) - \log p(D \mid w_i)\]

<p>这个近似把 KL 散度也蒙特卡洛了，这种做法摆脱了对 KL 散度有闭式解的要求。虽然在很多情况下 KL 散度能写出闭式解，但这样可以适配更多的先验后验分布形式。</p>

<h3 id="梯度下降">梯度下降</h3>

<p>为了计算方便，论文用了平均场近似（mean-field approximation）。即令变分后验 \(q(w \mid \theta)\) 为一个<a href="https://notebook.renovamen.ink/ai/ml/pcg/variational-inference/#平均场分布族" target="_blank">平均场分布族</a>，即认为各个参数 \(w_i\) 之间相互独立，每个参数 \(w_i\) 都服从高斯分布（也即协方差矩阵除了对角线以外都为 0，所以原文用的是 diagonal Gaussian distribution 这个词），那么有：</p>

\[q(w \mid \theta) = \prod_i q_i(w_i \mid \theta) = \prod_i \mathcal{N}(w_i \mid \mu_i, \sigma_i^2)\]

<p>按照之前说的重参数化操作，\(w_i\) 可以写为：</p>

\[w_i = \mu_i + \sigma_i \odot \epsilon_i\]

\[\epsilon_i \thicksim \mathcal{N}(0, 1)\]

<p>然后令 \(f(w \mid \theta) = \log q(w \mid \theta) - \log p(w) - p(D \mid w)\)。因为最大化 \(p(D \mid w)\) 跟最小化 \(L(w)\) 是一回事，所以也可以写成 \(f(w \mid \theta) = \log q(w \mid \theta) - \log p(w) + L(w)\)。</p>

<p>而 \(\theta = (\mu, \sigma)\)，那么分别对 \(\mu\) 和 \(\sigma\) 求梯度：</p>

\[\Delta_{\mu} = \frac{\partial f(w, \theta)}{\partial w} +  \frac{\partial f(w, \theta)}{\partial \mu}\]

\[\Delta_{\sigma} = \frac{\partial f(w, \theta)}{\partial w} \cdot \epsilon +  \frac{\partial f(w, \theta)}{\partial \sigma}\]

<p>为了保证 \(\sigma\) 非负，论文又把 \(\sigma\) 写成了 \(\sigma = \log (1 + \exp(\rho))\)，所以现在变成了 \(\theta = (\mu, \rho)\)，关于 \(\rho\) 的梯度为：</p>

\[\Delta_{\rho} = \frac{\partial f(w, \theta)}{\partial w} \frac{\epsilon}{1 + \exp(- \rho)} +  \frac{\partial f(w, \theta)}{\partial \rho}\]

<p>然后按梯度下降更新 \(\mu, \rho\) 即可：</p>

\[\mu \larr \mu - \alpha \Delta_{\mu}\]

\[\rho \larr \rho - \alpha \Delta_{\rho}\]

<h2 id="胡思乱想">胡思乱想</h2>

<h3 id="0x00">0x00</h3>

<p>打算理 BNN 是因为看到了一篇论文：</p>

<p><strong>Uncertainty-guided Ccontinual Learning with Bayesian Neural Networks.</strong> <em>Sayna Ebrahimi, et al.</em> ICLR 2020. <a href="https://arxiv.org/pdf/1906.02425.pdf" target="_blank">[Paper]</a> <a href="https://github.com/SaynaEbrahimi/UCB" target="_blank">[Code]</a></p>

<p>个人觉得它的思想非常简洁，就是对 BNN 参数更新的学习率 \(\alpha\) 做了修改，以至于让我这种菜鸡都能立马理解，甚至觉得我要是早点入这个坑我也能想出这个 idea（不是没有我没这样说过</p>

<p>方差 \(\sigma_i\) 可以被看做参数 \(w_i\) 的不确定度（uncertainty），方差越大说明这个参数对当前任务越重要，那么在后面的任务中它的更新幅度就应该小一点，反之则应该大一点。也就是说参数重要性 \(\Omega\) 被定义为：</p>

\[\Omega_i \propto \frac{1}{\sigma_i}\]

<p>而与一般的 regularization-based continual learning 方法加正则项的做法不同，这篇论文直接通过控制学习率来控制更新幅度，不过它只更新了 \(\mu\) 的学习率，\(\rho\) 的学习率则一直保持不变：</p>

\[\alpha_i^\mu \larr \frac{\alpha_i^\mu}{\Omega_i}\]

<h3 id="0x01">0x01</h3>

<p>贝叶斯神经网络是一种深度学习方法，诞生在一个 Autograd 工具大行其道的时代，因此对于最小化 \(\mathbb{E}_{q(w \mid \theta)} [f(w, \theta)]\) 这个优化问题，它可以直接上梯度下降。</p>

<p>还有一种贝叶斯系方法叫 ADF（Assumed Density Filtering），或者叫它在线变分贝叶斯（Online Variational Bayes）可能还更容易理解一点。在第 \(n\) 个数据集 \(D_n\) 上估计参数时，它会把 \(f(w, \theta)\) 中的参数先验 \(p_n(w)\) 替换为上一个数据集上的参数后验 \(p_{n-1}(w \mid D_{n-1}) = q_{n-1}(w)\)。</p>

<p>在 ADF 诞生的那个年代，深度学习还是个冷门领域，也并没有什么 Autograd 工具能给你用。因此 ADF 在求极小值时直接用了“使导数为 0”这种硬核方法：</p>

\[\frac{\partial}{\partial \theta} \mathbb{E}_{q(w \mid \theta)} [f(w, \theta)] = \mathbb{E}_{q(\epsilon)} \left [\frac{\partial f(w, \theta)}{\partial w} \frac{\partial w}{\partial \theta} +  \frac{\partial f(w, \theta)}{\partial \theta} \right ] = 0\]

<p>因为 \(q\) 是指数族分布，所以上式是有闭式解的，只是推导过程比较复杂，感兴趣的话可以看看<a href="https://zhuanlan.zhihu.com/p/150187256" target="_blank">这篇文章</a>。之所以提到这个，是因为下面这篇论文就是套的 ADF 框架，并直接通过闭式解来更新参数：</p>

<p><strong>Task Agnostic Continual Learning Using Online Variational Bayes.</strong> <em>Chen Zeno, et al.</em> arXiv 2018. <a href="https://arxiv.org/pdf/1803.10123.pdf" target="_blank">[Paper]</a> <a href="https://github.com/igolan/bgd" target="_blank">[Code]</a></p>

<p>而用贝叶斯性来做 continual learning 的开山之作 VCL 跟上面那篇论文的主要不同点在于，VCL 在更新参数时用了梯度下降，相当于在套 ADF 框架的同时又利用了 Autograd 的好处：</p>

<p><strong>Variational Continual Learning.</strong> <em>Cuong V. Nguyen, et al.</em> ICLR 2018. <a href="https://openreview.net/pdf?id=BkQqq0gRb">[Paper]</a> <a href="https://github.com/nvcuong/variational-continual-learning">[Code]</a></p>

<p>当然 VCL 还采样了一部分旧数据作为 coreset，coreset 也会被用于当前任务的训练，这种喜闻乐见的方法可以提高效果。</p>

<p>然后有空的话我或许会理一理 ADF…</p>

<h2 id="参考">参考</h2>

<ul>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/32480810" target="_blank">聊一聊机器学习的 MLE 和 MAP：最大似然估计和最大后验估计</a></p>
  </li>
  <li>
    <p><a href="https://arxiv.org/pdf/1505.05424.pdf" target="_blank">Weight Uncertainty in Neural Networks.</a> <em>Charles Blundell, et al.</em> ICML 2015.</p>
  </li>
  <li>
    <p><a href="https://www.zhihu.com/question/352295592" target="_blank">贝叶斯深度学习是什么，和传统神经网络有何不同？</a></p>
  </li>
  <li>
    <p><a href="https://alexgkendall.com/computer_vision/bayesian_deep_learning_for_safe_ai/" target="_blank">Deep Learning Is Not Good Enough, We Need Bayesian Deep Learning for Safe AI</a></p>
  </li>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/88654038" target="_blank">贝叶斯神经网络建模两类不确定性</a></p>
  </li>
  <li>
    <p><a href="https://zhuanlan.zhihu.com/p/81170602" target="_blank">Bayesian Neural Networks：贝叶斯神经网络</a></p>
  </li>
</ul>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2020/08/05/meta-learning/" data-toggle="tooltip" data-placement="top" title="元学习：一种套娃算法">
                        Previous<br>
                        <span>元学习：一种套娃算法</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/08/22/bocd/" data-toggle="tooltip" data-placement="top" title="BOCD">
                        Next<br>
                        <span>BOCD</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">
                
                <section class="author-profile">
    <div class="info"> 
        <div class="avatar">
            <img src="/img/header-avatar.jpeg">
        </div>
        <h1>Renovamen</h1>
    </div>
    <span>
        <a href="https://www.jinrishici.com/" target="_blank">
            <i class="fas fa-pencil-alt"></i>
        </a>
        <p id="poem-item">作诗中...</p>
        <br><p id="poem-info"></p>
    </span>
</section>
                
                
                    <!-- Comment container -->

<!-- disqus -->

<div class="comment">
    <div id="gitalk-container"></div>
</div>

<!-- Valine -->

                
            </div>  

            <!-- Side Catalog Container -->
            
                <!-- Side Catalog Container -->
<div class="
    col-lg-2 col-lg-offset-0
    sidebar-container
    catalog-container">
    <div class="side-catalog">
        <hr class="hidden-sm hidden-xs">
        <h5>
            <a class="catalog-toggle" href="#">CATALOG</a>
        </h5>
        <ul class="catalog-body"></ul>
    </div>
</div>
            
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>

<script>
    $("script[type='math/tex']").replaceWith(function() {
        var tex = $(this).text();
        return katex.renderToString(tex, {displayMode: false});
    });
  
    $("script[type='math/tex; mode=display']").replaceWith(function() {
        var tex = $(this).html();
        return katex.renderToString(tex.replace(/%.*/g, ''), {displayMode: true});
    });
</script>
    


<!-- Renovamen: add support for chart and mermaid -->

    <!-- Borrowed from: https://github.com/kitian616/jekyll-TeXt-theme -->
<!-- Chart.js: https://www.chartjs.org/docs/latest/ -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js", function(){
        var $canvas = null, $this = null, _ctx = null, _text = '';
        $('.language-chart').each(function(){
            $this = $(this);
            $canvas = $('<canvas></canvas>');
            _text = $this.text();
            $this.text('').append($canvas);
            _ctx = $canvas.get(0).getContext('2d');
            (_ctx && _text) && (new Chart(_ctx, JSON.parse(_text)) && $this.attr('data-processed', true));
        });
    })

    $('.language-chart').parent().css({
        "background-color": "transparent",
        "border": "none",
    });
</script>





    <!-- Borrowed from: https://github.com/kitian616/jekyll-TeXt-theme -->
<!-- mermaid.js: https://mermaid-js.github.io/mermaid/ -->
<script>
    LazyLoad.js('https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js', function() {
        mermaid.initialize({
            startOnLoad: true
        });
        mermaid.init(undefined, '.language-mermaid');
    });

    $('.language-mermaid').parent().css({
        "background-color": "transparent",
        "border": "none",
    });
</script>


<!-- Renovamen: add support for additional emoji -->

    <script>
$('.emoji-plus').each(function(){
    var $this = $(this);
    var imgURL = '/img/emoji/bilitv/' + $this.text() + '.gif';
    var $img = $('<img class="emoji-plus" src="' + imgURL + '" height="30" width="30">');
    $this.replaceWith($img);
});
</script>


<!-- comment -->

    <!-- Gitalk start -->
<script type="text/javascript">
    LazyLoad.js(['/js/library/md5.js ', 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js'], function(){
        var gitalk = new Gitalk({
            clientID: 'd6247712dc288a5a60ca',
            clientSecret: 'ed1ec72417828343c79ed910a1b77d140fa715a7',
            repo: 'gitalk-comments',
            owner: 'This-is-an-Apple',
            admin: ['Renovamen', 'This-is-an-Apple'],
            id: md5(location.pathname),
            distractionFreeMode: false
        });
        gitalk.render('gitalk-container');
    })
</script>
<!-- Gitalk end -->






    <!-- anchor.js: http://bryanbraun.github.io/anchorjs/ -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/anchor-js@4.2.2/anchor.min.js", function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


<!-- Renovamen: add support 今日诗词: https://www.jinrishici.com/ -->
<script type="text/javascript">
    LazyLoad.js(['https://sdk.jinrishici.com/v2/browser/jinrishici.js'], function(){
        jinrishici.load(function(result) {
            var poem = document.querySelector('#poem-item');
            var info = document.querySelector('#poem-info');

            if (result.status === "success") {
                var data = result.data
                console.log(data)
                poem.innerHTML = data.content;
                info.innerHTML = '【' + data.origin.dynasty + '】' + data.origin.author + '《' + data.origin.title + '》';
            }
        });
    })
</script>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                <!-- 


<div class="list-inline text-center">

  
  <a target="_blank" href="https://github.com/Renovamen">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-github-alt fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.linkedin.com/in/xiaohan-zou-55bba0160">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.facebook.com/renovamen.zou">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://twitter.com/renovamen_zxh">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.zhihu.com/people/chao-neng-gui-su">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-stack-1x fa-inverse">知</i>
    </span>
  </a>
  
  
  
  <a href="mailto:renovamenzxh@gmail.com">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="/feed.xml">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
</div> -->
                <p class="copyright">
                    &copy; <a href="https://github.com/Renovamen" target="_blank">Renovamen</a> 2018
                    <br>
                    Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & <a href="https://github.com/Renovamen/renovamen.github.io" target="_blank">Gungnir</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<!-- Renovamen: has been included in `head.html` already -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script> -->

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<!-- Renovamen: Maybe don't need this anymore -->
<!-- <script src="/js/library/bootstrap.min.js "></script> -->

<!-- add dark / light detection -->
<!-- dark / light detection, borrowed from gridsome.org -->
<script>
  (function() {
    window.__onThemeChange = function() {};
    function setTheme(newTheme) {
      window.__theme = newTheme;
      preferredTheme = newTheme;
      document.body.setAttribute('data-theme', newTheme);
      window.__onThemeChange(newTheme);
      setThemeIcon(newTheme)
    }

    var preferredTheme;
    try {
      preferredTheme = localStorage.getItem('theme');
    } catch (err) { }

    window.__setPreferredTheme = function(newTheme) {
      setTheme(newTheme);
      try {
        localStorage.setItem('theme', newTheme);
      } catch (err) {}
    }

    var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

    darkQuery.addListener(function(e) {
      window.__setPreferredTheme(e.matches ? 'dark' : 'light');
    });

    setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
  })();
</script>

<!-- Theme JavaScript -->
<script src="/js/gungnir.min.js"></script>

<!-- Service Worker -->

<script src="/js/snackbar.js"></script>
<script src="/js/sw-registration.js"></script>



<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!--fastClick.js -->
<script>
    LazyLoad.js("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

    <!-- Google Analytics -->
<script>
    // dynamic User by Hux
    var _gaId = 'UA-146858305-1';
    var _gaDomain = 'renovamen.ink';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->

    <!-- Baidu Tongji -->
<script>
    // dynamic User by Hux
    var _baId = '75381d210789d3eaf855fa16246860cc';

    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>



<!-- Side Catalog -->

    <!-- tocbot: https://github.com/tscanlin/tocbot -->

<!-- 
    Didn't use lazyload here because it will cause some bugs in catalog 
    generating when swtiching between two languages. 
    I'm trying to find a better solution.
-->

<link href="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.css" rel="stylesheet" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.min.js"></script>

<script type="text/javascript">
    function generateCatalog(selector) {

        // links page
        if('post' == 'links') {
            _containerSelector = 'div.link-list'
        }
        // interop with multilangual 
        else {
            if ('' == 'true') {
                _containerSelector = 'div.post-container.active'
            } 
            else {
                _containerSelector = 'div.post-container'
            }
        }
        
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: selector,
            // Where to grab the headings to build the table of contents.
            contentSelector: _containerSelector,
            // Which headings to grab inside of the contentSelector element.
            headingSelector: 'h2, h3, h4, h5, h6',
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))
</script>



<!-- Multi-Lingual -->

    </div>

    <!-- modify styles of navbar on mobile -->
    <div class="mobile-nav">
    <div class="mobile-menu-avatar">
        <div class="avatar-container">
            <img src="/img/header-avatar.jpeg">
        </div>
    </div>
    <p class="mobile-menu-heading">Meow?</p>
    


<div class="list-inline text-center">

  
  <a target="_blank" href="https://github.com/Renovamen">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-github-alt fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.linkedin.com/in/xiaohan-zou-55bba0160">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin-in fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.facebook.com/renovamen.zou">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://twitter.com/renovamen_zxh">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="https://www.zhihu.com/people/chao-neng-gui-su">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-stack-1x fa-inverse">知</i>
    </span>
  </a>
  
  
  
  <a href="mailto:renovamenzxh@gmail.com">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
  
  <a target="_blank" href="/feed.xml">
    <span class="fa-stack fa-lg">
      <i class="fas fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
  
</div>
    <ul>
        
        <li>
            
            <a href="/" class="faa-parent animated-hover">
            
                
                <i class="fab fa-fort-awesome fa-lg faa-wrench"></i>
                
                Home
            </a>
            
        </li>
        
        <li>
            
            <a href="/about/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-paw fa-lg faa-wrench"></i>
                
                About
            </a>
            
        </li>
        
        <li>
            
            <a href="/archive/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-archive fa-lg faa-wrench"></i>
                
                Archive
            </a>
            
        </li>
        
        <li>
            
            <a href="/links/" class="faa-parent animated-hover">
            
                
                <i class="fas fa-link fa-lg faa-wrench"></i>
                
                Links
            </a>
            
        </li>
        

        <li>
            <a id="mobile-search-btn" class="faa-parent animated-hover">
                <i class="fas fa-search fa-lg faa-wrench"></i> Search
            </a>
        </li>
    </ul>
</div>

    <!-- support search -->
    <div id="search" class="search-page">

    <i class="search-close fas fa-chevron-down"></i>
    <p class="search-title text-center"></p>

    <div class="input">
        <input 
            id="search-input" 
            type="text" 
            class="search-field" 
            placeholder="Just search ..." 
            onkeypress="checkCode()"
            style="background-color: transparent"
        >
    </div>
    <div id="search-results" class="search-results"></div>

    <img class="search-img-right" src="/img/search-right.gif"/>
</div><script>
    // simple-jekyll-search.js
    LazyLoad.js("https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js", function(){
        SimpleJekyllSearch({
            searchInput: document.getElementById('search-input'),
            resultsContainer: document.getElementById('search-results'),
            json: '/search.json',
            searchResultTemplate: '<li class="result-item item"><a href="{url}" title="{desc}"><div class="result-item-title">{title}</div><div class="result-item-subtitle">{subtitle}</div></a></li>',
            noResultsText: '<li class="result-item item"><div class="result-item-title">No Results</div></li>',
            limit: 20,
            fuzzy: false
        })
    })

    // search-results 高度适配
    $('.search-results').css({
        'height': $(window).height() - 200 + "px"
    });

    function checkCode() {
        if (event.keyCode == 13) {
            getCode = $('#search-input').val();
            if(getCode == "cd dark universe") {
                window.location.href = "https://renovamen.gitee.io/dark-universe/";
            }
            else if(getCode == "cd resume") {
                window.location.href = "https://renovamen.ink/Endless-Resume/";
            }
        }
    }

    function autoFocus() {
        setTimeout(function () {
            document.querySelector('.search-page input').focus();
        }, 400);
    }

    // open search page
    $('#search-btn').click(function() {
        $('.search-page').toggleClass('open')
        autoFocus()
    });

    // open search page (mobile)
    $('#mobile-search-btn').click(function() {
        $('.search-page').toggleClass('open')
        autoFocus()
    });

    // close search page
    $('.search-close').click(function() {
        $('.search-page').toggleClass('open')
    });
</script>
    
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
