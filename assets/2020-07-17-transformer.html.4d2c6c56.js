import{c as s}from"./app.4a7360b6.js";import{_ as a}from"./plugin-vue_export-helper.21dcd24c.js";var n="/img/in-post/2020-07-17/transformer.png",p="/img/in-post/2020-07-17/positional-embedding.png",t="/img/in-post/2020-07-17/wave.png",e="/img/in-post/2020-07-17/encoder.png",l="/img/in-post/2020-07-17/multi-head-self-attention.png",m="/img/in-post/2020-07-17/attention.png",r="/img/in-post/2020-07-17/encoder-decoder.png",i="/img/in-post/2020-07-17/decoder.png",c="/img/in-post/2020-07-17/mask.png",h="/img/in-post/2020-07-17/complexity.png";const o={},g=s('<p><strong>Attention Is All You Need.</strong> <em>Ashish Vaswani, et al.</em> NIPS 2017. <a href="https://papers.nips.cc/paper/7181-attention-is-all-you-need.pdf" target="_blank" rel="noopener noreferrer">[Paper]</a> <a href="https://github.com/tensorflow/tensor2tensor/blob/master/tensor2tensor/models/transformer.py" target="_blank" rel="noopener noreferrer">[Code]</a></p><p>\u8003\u8651\u5230 RNN \u53EA\u80FD\u5355\u5411\u4F9D\u6B21\u8BA1\u7B97\uFF0C\u6240\u4EE5\u5B58\u5728\u4EE5\u4E0B\u95EE\u9898\uFF1A</p><ul><li><p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> \u65F6\u523B\u7684\u8BA1\u7B97\u4F9D\u8D56\u4E0E <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">\u2212</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> \u65F6\u523B\u7684\u8BA1\u7B97\u7ED3\u679C\uFF0C\u9650\u5236\u4E86\u6A21\u578B\u7684\u5E76\u884C\u80FD\u529B</p></li><li><p>RNN \u7684\u957F\u671F\u4F9D\u8D56\u95EE\u9898</p></li></ul><p>\u4E8E\u662F\u8FD9\u7BC7\u8BBA\u6587\u6254\u6389\u4E86 encoder \u548C decoder \u4E2D\u7684 RNN \u7ED3\u6784\uFF0C\u5B8C\u5168\u7528 attention \u6765\u641E machine translation\uFF1A</p><ul><li><p>\u6CA1\u6709 RNN \u7ED3\u6784\uFF0C\u6240\u4EE5\u6709\u66F4\u597D\u7684\u5E76\u884C\u80FD\u529B</p></li><li><p>attention \u673A\u5236\u5BF9\u5168\u5C40\u4FE1\u606F\u7684\u5904\u7406\u66F4\u6709\u6548</p></li></ul><p>Transformer \u6574\u4F53\u7ED3\u6784\u5982\u4E0B\uFF1A</p><img src="'+n+'" width="400px" alt="Transformer"><h2 id="position-embedding" tabindex="-1"><a class="header-anchor" href="#position-embedding" aria-hidden="true">#</a> Position Embedding</h2><p>Transformer \u6254\u6389\u4E86 RNN\uFF0C\u5BF9\u8F93\u5165\u53E5\u5B50\u7684\u6240\u6709\u5355\u8BCD\u90FD\u662F\u540C\u65F6\u5904\u7406\u7684\uFF0C\u6240\u4EE5\u5931\u53BB\u4E86\u6355\u6349\u5355\u8BCD\u7684\u6392\u5E8F\u548C\u4F4D\u7F6E\u4FE1\u606F\u7684\u80FD\u529B\u3002\u5982\u679C\u4E0D\u89E3\u51B3\u8BCD\u5E8F\u7684\u95EE\u9898\uFF0C\u90A3\u5373\u4F7F\u628A\u4E00\u53E5\u8BDD\u6253\u4E71\uFF0Cattention \u51FA\u6765\u7684\u7ED3\u679C\u4E5F\u662F\u4E00\u6837\u7684\uFF0C\u76F8\u5F53\u4E8E\u8FD9\u5C31\u53EA\u662F\u4E00\u4E2A\u8BCD\u888B\u6A21\u578B\u3002\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u8BBA\u6587\u5F15\u5165 position embedding \u6765\u5BF9\u5355\u8BCD\u7684\u4F4D\u7F6E\u4FE1\u606F\u8FDB\u884C\u7F16\u7801\u3002\u6700\u7EC8\u7684\u8F93\u5165\u8BCD\u5411\u91CF = word embedding + position embedding\uFF1A</p><p><img src="'+p+'" alt="Positional Embedding"></p><p class="desc">\u56FE\u7247\u6765\u6E90\uFF1A<a href="http://jalammar.github.io/illustrated-transformer#representing-the-order-of-the-sequence-using-positional-encoding" target="_blank">The Illustrated Transformer</a></p><p>\u6709\u4E24\u79CD\u641E\u5230 position embedding \u7684\u601D\u8DEF\uFF1A</p><ul><li><p>\u5B66\u4E60\u51FA\u4E00\u4EFD position embedding\uFF08<a href="http://proceedings.mlr.press/v70/gehring17a/gehring17a.pdf" target="_blank" rel="noopener noreferrer"><strong>Convolutional Sequence to Sequence Learning</strong></a>. <em>Jonas Gehring et al.</em> ICML 2017.\uFF09</p></li><li><p>\u76F4\u63A5\u7528\u4E0D\u540C\u9891\u7387\u7684 sin \u548C cos \u51FD\u6570\u7B97\u51FA\u6765</p></li></ul><p>\u7ECF\u8FC7\u5B9E\u9A8C\uFF0C\u8BBA\u6587\u53D1\u73B0\u8FD9\u4FE9\u65B9\u6CD5\u6548\u679C\u5DEE\u4E0D\u591A\uFF0C\u6240\u4EE5\u9009\u4E86\u7B2C\u4E8C\u79CD\u65B9\u6CD5\uFF0C\u56E0\u4E3A\u5B83\u6709\u4EE5\u4E0B\u597D\u5904\uFF1A</p><ul><li><p>\u4E0D\u9700\u8981\u52A0\u989D\u5916\u7684\u8BAD\u7EC3\u53C2\u6570</p></li><li><p>\u5B66\u4E60\u51FA\u6765\u7684 position embedding \u4F1A\u53D7\u5230\u8BAD\u7EC3\u96C6\u4E2D\u5E8F\u5217\u7684\u957F\u5EA6\u7684\u9650\u5236\uFF0C\u4F46\u4E09\u89D2\u51FD\u6570\u660E\u663E\u4E0D\u53D7\u5E8F\u5217\u957F\u5EA6\u7684\u9650\u5236\uFF0C\u6240\u4EE5\u80FD\u591F\u5904\u7406\u8BAD\u7EC3\u96C6\u4E2D\u6CA1\u89C1\u8FC7\u7684\u5E8F\u5217\u957F\u5EA6</p></li></ul><p>\u5177\u4F53\u7684\u4F4D\u7F6E\u7F16\u7801\u516C\u5F0F\u4E3A\uFF1A</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1195em;vertical-align:-1.0119em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.1219em;"></span><span class="mord"><span class="mord">1000</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.1219em;"><span style="top:-3.5234em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8551em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6944em;"></span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">model</span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.3496em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.5937em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.3519em;"><span class="pstrut" style="height:3.1219em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7989em;"><span class="pstrut" style="height:3.1219em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:1.0119em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1195em;vertical-align:-1.0119em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.1219em;"></span><span class="mord"><span class="mord">1000</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.1219em;"><span style="top:-3.5234em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8551em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6944em;"></span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">model</span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.3496em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.5937em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.3519em;"><span class="pstrut" style="height:3.1219em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7989em;"><span class="pstrut" style="height:3.1219em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:1.0119em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p><p>\u5176\u4E2D <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">model</span></span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> \u4E3A\u8BCD\u5D4C\u5165\u7EF4\u5EA6\uFF08\u8BBA\u6587\u4E2D\u4E3A 512\uFF09\uFF0Cpos \u4E3A\u8BE5\u5355\u8BCD\u5728\u5E8F\u5217\u4E2D\u7684\u4F4D\u7F6E\uFF0C<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord">2</span><span class="mord mathnormal">i</span></span></span></span> \u4E3A\u8BCD\u5411\u91CF\u7684\u5076\u6570\u7EF4\u5EA6\uFF08\u7528\u7B2C\u4E00\u4E2A\u516C\u5F0F\uFF09\uFF0C<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> \u6307\u8BCD\u5411\u91CF\u7684\u5947\u6570\u7EF4\u5EA6\uFF08\u7528\u7B2C\u4E8C\u4E2A\u516C\u5F0F\uFF09\u3002\u6CE2\u7684\u9891\u7387\u548C\u504F\u79FB\u5BF9\u4E8E\u6BCF\u4E2A\u7EF4\u5EA6\u662F\u4E0D\u540C\u7684\uFF1A</p><p><img src="'+t+'" alt="wave"></p><p class="desc">\u56FE\u7247\u6765\u6E90\uFF1A<a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#positional-encoding" target="_blank">The Annotated Transformer</a></p><p>\u56E0\u4E3A\u4E09\u89D2\u51FD\u6570\u8FD8\u6709\u4EE5\u4E0B\u7279\u6027\uFF1A</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">\u03B1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">\u03B2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">\u03B1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">\u03B2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">\u2212</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">\u03B1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">\u03B2</span><span class="mclose">)</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">\u03B1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">\u03B2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">\u03B1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">\u03B2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">\u03B1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">\u03B2</span><span class="mclose">)</span></span></span></span></span></p><p>\u6240\u4EE5\u4EFB\u610F\u4F4D\u7F6E\u7684 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span> \u90FD\u80FD\u901A\u8FC7 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mclose">)</span></span></span></span> \u7EBF\u6027\u8868\u8FBE\uFF0C\u8FD9\u4E3A\u6A21\u578B\u6355\u6349\u5355\u8BCD\u4E4B\u95F4\u7684\u76F8\u5BF9\u4F4D\u7F6E\u5173\u7CFB\u63D0\u4F9B\u4E86\u975E\u5E38\u5927\u7684\u4FBF\u5229\u3002</p><h2 id="encoder" tabindex="-1"><a class="header-anchor" href="#encoder" aria-hidden="true">#</a> Encoder</h2><p>\u8BBA\u6587\u4E2D\u7684 encoder \u7531 N = 6 \u4E2A\u76F8\u540C\u7684 layer \u5806\u53E0\u800C\u6210\uFF1A</p><img src="'+e+'" width="180px" alt="encoder"><p>\u6BCF\u4E2A layer \u7531\u4E24\u4E2A sub-layer \u7EC4\u6210\uFF0C\u5206\u522B\u4E3A multi-head self-attention \u548C fully connected feed-forward network\u3002</p><p>\u5E76\u4E14\u6BCF\u4E2A sub-layer \u90FD\u52A0\u4E86\uFF1A</p><ul><li><p>Residual Connection\uFF1A\u89E3\u51B3\u591A\u5C42\u795E\u7ECF\u7F51\u7EDC\u8BAD\u7EC3\u56F0\u96BE\u7684\u95EE\u9898\uFF0C\u901A\u8FC7\u5C06\u524D\u4E00\u5C42\u7684\u4FE1\u606F\u65E0\u5DEE\u7684\u4F20\u9012\u5230\u4E0B\u4E00\u5C42\uFF0C\u53EF\u4EE5\u6709\u6548\u7684\u4EC5\u5173\u6CE8\u5DEE\u5F02\u90E8\u5206</p></li><li><p>Layer Normalisation\uFF1A\u5BF9\u5C42\u7684\u6FC0\u6D3B\u503C\u8FDB\u884C\u5F52\u4E00\u5316\uFF0C\u53EF\u4EE5\u52A0\u901F\u6A21\u578B\u7684\u8BAD\u7EC3\u8FC7\u7A0B\uFF0C\u4F7F\u5176\u66F4\u5FEB\u7684\u6536\u655B</p><p><a href="https://arxiv.org/pdf/1607.06450.pdf" target="_blank" rel="noopener noreferrer"><strong>Layer Normalization</strong></a>. <em>Jimmy Lei Ba, et al.</em> arXiv 2016.</p></li></ul><p>\u4E5F\u5C31\u662F\u8F93\u5165\u4F1A\u5148\u8FDB LayerNorm\uFF0C\u518D\u8FDB sub-layer\uFF0C\u7136\u540E\u52A0\u5728\u539F\u59CB\u8F93\u5165\u4E0A\uFF08\u867D\u7136\u56FE\u4E0A LayerNorm \u4F3C\u4E4E\u5728 sub-layer \u540E\u9762\uFF0C\u4F46<a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#encoder" target="_blank" rel="noopener noreferrer">\u4EE3\u7801</a>\u91CC\u7684\u786E\u662F\u5148\u8FDB LayerNorm\uFF09\u3002\u6700\u540E 6 \u4E2A layer \u90FD\u8DD1\u5B8C\u4E4B\u540E\u8FD8\u8981\u518D\u5355\u72EC norm \u4E00\u6B21\uFF08\u867D\u7136\u56FE\u4E0A\u6CA1\u753B\u4F46<a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html#encoder" target="_blank" rel="noopener noreferrer">\u4EE3\u7801</a>\u91CC\u5199\u4E86\uFF09\u3002</p><h3 id="muti-head-self-attention" tabindex="-1"><a class="header-anchor" href="#muti-head-self-attention" aria-hidden="true">#</a> Muti-Head Self-Attention</h3><p>attention \u53EF\u4EE5\u8868\u793A\u4E3A\u4EE5\u4E0B\u5F62\u5F0F\uFF1A</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9251em;vertical-align:-0.31em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span></span></p><p>\u5176\u4E2D <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>\uFF08value\uFF09\u7528\u6765\u6C42\u52A0\u6743\u548C\u5F97\u5230\u6700\u7EC8\u7684\u4E0A\u4E0B\u6587\u5411\u91CF\uFF0C\u800C <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>\uFF08query\uFF09\u548C\u6240\u6709\u7684 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>\uFF08key\uFF09\u4F1A\u88AB\u7528\u6765\u8BA1\u7B97\u6CE8\u610F\u529B\u6743\u91CD\u3002\u5982\u5728\u4F20\u7EDF\u7684 seq2seq \u7ED3\u6784\u4E2D\uFF0C\u5B83\u4EEC\u5206\u522B\u7531\u4EE5\u4E0B\u503C\u7ECF\u8FC7\u7EBF\u6027\u53D8\u6362\u5F97\u5230\uFF1A</p><ul><li><p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>\uFF1Adecoder \u7684\u5F53\u524D\u8F93\u5165</p></li><li><p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>\uFF1Aencoder \u7684\u8F93\u51FA\uFF08<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">\u2026</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>\uFF09</p></li><li><p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>\uFF1A\u540C <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></p></li></ul><p>\u800C\u8FD9\u91CC\u662F self-attention\uFF0C\u6240\u4EE5 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> \u7531\u540C\u4E00\u4E2A\u503C <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> \u7ECF\u8FC7\u7EBF\u6027\u53D8\u6362\u5F97\u5230\uFF0C<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> \u5728\u7B2C\u4E00\u4E2A layer \u4E3A\u8F93\u5165\u7684\u8BCD\u5411\u91CF\u5E8F\u5217\uFF0C\u5728\u4E4B\u540E\u7684 layer \u5219\u4E3A\u4E0A\u4E00\u4E2A layer \u7684\u8F93\u51FA\u3002</p><p>\u800C multi-head attention \u5C31\u662F\u901A\u8FC7 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span></span></span></span> \u4E2A\u4E0D\u540C\u7684\u7EBF\u6027\u53D8\u6362\u5F97\u5230\u4E0D\u540C\u7684 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span>\uFF0C\u6700\u540E\u5C06\u8FD9 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span> \u4E2A attention \u7ED3\u679C\u62FC\u63A5\u8D77\u6765\uFF1A</p><p><img src="'+l+`" alt="multi-head sekf-attention"></p><p class="desc">\u56FE\u7247\u6765\u6E90\uFF1A<a href="http://jalammar.github.io/illustrated-transformer#the-beast-with-many-heads" target="_blank">The Illustrated Transformer</a></p><p>\u8FD9\u91CC\u7684 attention \u8BA1\u7B97\u516C\u5F0F\u4E3A\uFF08scaled dot-product\uFF09\uFF1A</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Attention</span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4483em;vertical-align:-0.93em;"></span><span class="mord text"><span class="mord">softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.2528em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><p>\u6CE8\u610F\uFF1A\u8FD9\u91CC\u8DDF <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> \u662F<strong>\u77E9\u9635\u76F8\u4E58</strong>\uFF0C\u4E0D\u662F element-wise \u76F8\u4E58\u3002</p><p><img src="`+m+`" alt="attention"></p><p>\u5176\u4E2D <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">model</span></span></span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">512/8</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">64</span></span></span></span>\u3002\u9664\u4EE5 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1828em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span></span></span></span> \u662F\u56E0\u4E3A\uFF0C<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> \u8D8A\u5927 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> \u5C31\u4F1A\u8D8A\u5927\uFF0C\u53EF\u80FD\u5C31\u4F1A\u5C06 softmax \u51FD\u6570\u63A8\u5165\u68AF\u5EA6\u6781\u5C0F\u7684\u533A\u57DF\uFF0C\u6240\u4EE5\u8981\u7528 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1828em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span></span></span></span> \u5BF9 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span> \u8FDB\u884C\u7F29\u653E\u3002</p><p>\u56FE\u4E2D\u7684 mask \u53EA\u4F1A\u5728 <a href="#masked-multi-head-self-attention">decoder</a> \u4E2D\u88AB\u7528\u5230\u3002</p><h3 id="feed-forward-network" tabindex="-1"><a class="header-anchor" href="#feed-forward-network" aria-hidden="true">#</a> Feed-Forward Network</h3><p>\u7B2C\u4E8C\u4E2A sub-layer \u662F\u4E00\u4E2A\u524D\u9988\u7F51\u7EDC\uFF1A</p><p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">FFN</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><h2 id="decoder" tabindex="-1"><a class="header-anchor" href="#decoder" aria-hidden="true">#</a> Decoder</h2><p>encoder-decoder \u7ED3\u6784\uFF1A</p><p><img src="`+r+'" alt="encoder-decoder"></p><p class="desc">\u56FE\u7247\u6765\u6E90\uFF1A<a href="http://jalammar.github.io/illustrated-transformer#the-residuals" target="_blank">The Illustrated Transformer</a></p><p><a href="http://jalammar.github.io/illustrated-transformer#the-decoder-side" target="_blank" rel="noopener noreferrer">\u8FD9\u91CC</a>\u8FD8\u6709\u4E24\u4E2A\u6E05\u695A\u7684\u89E3\u91CA\u4E86 encoder \u548C decoder \u7684\u5DE5\u4F5C\u65B9\u5F0F\u7684\u52A8\u753B\u3002</p><p>decoder \u4E5F\u7531 N = 6 \u4E2A\u76F8\u540C\u7684 layer \u5806\u53E0\u800C\u6210\uFF0C\u6BCF\u4E2A layer \u7531\u4E09\u4E2A sub-layer \u7EC4\u6210\uFF1A</p><img src="'+i+'" width="180px" alt="decoder"><h3 id="masked-multi-head-self-attention" tabindex="-1"><a class="header-anchor" href="#masked-multi-head-self-attention" aria-hidden="true">#</a> Masked Multi-Head Self-Attention</h3><p>\u5728\u8BAD\u7EC3\u65F6\uFF0Cdecoder \u5728\u9884\u6D4B\u7B2C <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> \u4E2A\u4F4D\u7F6E\u65F6\u4E0D\u5E94\u8BE5\u770B\u5230\u672A\u6765\u7684\u4FE1\u606F\uFF0C\u4F46 self-attention \u673A\u5236\u80FD\u8BA9\u5B83\u770B\u5230\u5168\u5C40\u4FE1\u606F\uFF08\u6807\u7B7E\u6CC4\u9732\uFF09\u3002\u6240\u4EE5\u4F1A\u5BF9\u5728 self-attention \u7684 softmax \u5C42\u524D\u52A0 mask\uFF0C\u5C06\u672A\u6765\u4FE1\u606F\u5C4F\u853D\u6389\u3002</p><p>mask \u662F\u4E00\u4E2A\u4E0B\u4E09\u89D2\u77E9\u9635\uFF0C\u5BF9\u89D2\u7EBF\u4EE5\u53CA\u5BF9\u89D2\u7EBF\u5DE6\u4E0B\u90FD\u662F1\uFF0C\u5176\u4F59\u90FD\u662F0\uFF1A</p><img src="'+c+'" width="300px" alt="mask"><p class="desc">mask \u77E9\u9635\uFF0C\u84DD\u8272\u90E8\u5206\u662F 1\uFF0C\u767D\u8272\u90E8\u5206\u662F 0\uFF08\u56FE\u7247\u6765\u6E90\uFF1A<a href="https://spaces.ac.cn/archives/6933#\u5355\u5411\u8BED\u8A00\u6A21\u578B" target="_blank">\u4ECE\u8BED\u8A00\u6A21\u578B\u5230 Seq2Seq\uFF1ATransformer \u5982\u620F\uFF0C\u5168\u9760 Mask</a>\uFF09</p><p>\u77E9\u9635\u7684\u884C\u4E3A\u5F53\u524D\u9884\u6D4B\u5230\u7B2C\u51E0\u4E2A\u5355\u8BCD\uFF0C\u5217\u4E3A\u5F53\u524D\u5141\u8BB8\u770B\u5230\u524D\u51E0\u4E2A\u4F4D\u7F6E\u7684\u4FE1\u606F\u3002\u7136\u540E mask=0 \u7684\u4F4D\u7F6E\u4E0A\u7684\u5143\u7D20\u4F1A\u90FD\u88AB\u66FF\u6362\u4E3A <code>-inf</code>\u3002</p><h3 id="multi-head-attention" tabindex="-1"><a class="header-anchor" href="#multi-head-attention" aria-hidden="true">#</a> Multi-head Attention</h3><p>\u5373\u8BBA\u6587 3.2.3 \u8282\u4E2D\u7684 encoder-decoder attention\u3002\u5B83\u7684 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> \u6765\u81EA\u4E8E\u4E0A\u4E00\u4F4D\u7F6E\u7684 decoder \u7684\u8F93\u51FA\uFF08\u7B2C\u4E00\u4E2A layer\uFF09\u6216\u4E0A\u4E00\u4E2A decoder layer \u7684\u8F93\u51FA\uFF08\u4E4B\u540E\u7684 layer\uFF09\uFF0C\u800C <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> \u548C <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> \u6765\u81EA\u4E8E encoder \u7684\u8F93\u51FA\u3002\u8FD9\u8BA9 decoder \u7684\u6BCF\u4E00\u4E2A\u4F4D\u7F6E\u90FD\u53EF\u4EE5\u770B\u5230\u5230\u8F93\u5165\u5E8F\u5217\u7684\u5168\u5C40\u4FE1\u606F\u3002</p><p>\u7F16\u7801\u53EF\u4EE5\u5E76\u884C\u8BA1\u7B97\uFF0C\u4F46\u89E3\u7801\u65F6\uFF0C\u56E0\u4E3A\u9700\u8981\u4E0A\u4E00\u65F6\u523B\u7684\u8F93\u51FA\u5F53\u4F5C <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>\uFF0C\u6240\u4EE5\u65E0\u6CD5\u5E76\u884C\u8BA1\u7B97\u3002</p><h3 id="feed-forward-network-1" tabindex="-1"><a class="header-anchor" href="#feed-forward-network-1" aria-hidden="true">#</a> Feed-Forward Network</h3><p>\u540C encoder\u3002</p><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary" aria-hidden="true">#</a> Summary</h2><p>\u4F18\u70B9\uFF1A</p><ul><li><p>\u76F8\u6BD4\u5176\u4ED6\u65B9\u6CD5\uFF0C\u5F53\u5E8F\u5217\u957F\u5EA6 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> \u5C0F\u4E8E\u8BCD\u5411\u91CF\u7EF4\u5EA6 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> \u65F6\uFF0C\u6BCF\u5C42\u7684\u8BA1\u7B97\u590D\u6742\u5EA6\uFF08complexity per layer\uFF09\u66F4\u4F4E\uFF1A</p><p><img src="'+h+'" alt="complexity"></p></li><li><p>\u66F4\u597D\u7684\u5E76\u884C\u6027\uFF0C\u7B26\u5408\u76EE\u524D\u7684\u786C\u4EF6\uFF08GPU\uFF09\u73AF\u5883</p></li><li><p>\u66F4\u597D\u5730\u5904\u7406\u957F\u65F6\u4F9D\u8D56\u95EE\u9898\uFF1A\u5982\u679C\u8981\u5904\u7406\u4E00\u4E2A\u957F\u5EA6\u4E3A n \u7684\u5E8F\u5217\uFF0CCNN \u9700\u8981\u589E\u52A0\u5377\u79EF\u5C42\u6570\u6765\u6269\u5927\u89C6\u91CE\uFF0CRNN \u9700\u8981\u4ECE 1 \u5230 n \u9010\u4E2A\u8FDB\u884C\u8BA1\u7B97\uFF0C\u800C self-attention \u53EA\u9700\u8981\u4E00\u6B65\u77E9\u9635\u8FD0\u7B97\u5C31\u53EF\u4EE5</p></li></ul><p>\u7F3A\u70B9\uFF1A</p><ul><li><p>\u4F46\u540C\u65F6\u4ECE\u4E0A\u9762\u90A3\u5F20\u590D\u6742\u5EA6\u8868\u91CC\u4E5F\u80FD\u770B\u51FA\u6765\uFF0C\u5F53\u53E5\u5B50\u592A\u957F\u65F6\uFF0CTransformer <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> \u7684\u65F6\u95F4\u590D\u6742\u5EA6\u662F\u975E\u5E38\u7206\u70B8\u7684\u3002Transformer \u80FD\u66F4\u597D\u5730\u5904\u7406\u957F\u65F6\u4F9D\u8D56\u95EE\u9898\uFF0C\u4F46\u8FD9\u79CD\u590D\u6742\u5EA6\u53C8\u8BA9\u5B83\u6CA1\u6CD5\u5904\u7406\u592A\u957F\u7684\u6587\u672C\uFF0C\u5373\u4F7F\u662F Bert \u7684\u6700\u5927\u957F\u5EA6\u4E5F\u53EA\u6709 512\u3002</p><p>\u4E8E\u662F\u51FA\u73B0\u4E86\u4E00\u5806\u81F4\u529B\u4E8E\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u7684\u540E\u7EED\u5DE5\u4F5C\uFF0C\u7B49\u6211\u6478\u4E24\u5929\u9C7C\u518D\u770B\u770B\u6709\u6CA1\u6709\u7A7A\u5199\u8FD9\u4E2A...</p></li><li><p>\u6254\u6389\u4E86 RNN \u548C CNN\uFF0C\u5BFC\u81F4\u5931\u53BB\u4E86\u6355\u6349\u5C40\u90E8\u7279\u5F81\u7684\u80FD\u529B</p><p>\u4E0D\u8FC7\u8BBA\u6587\u4E5F\u63D0\u5230\u4E86\u4E00\u4E2A restricted self-attention\uFF08\u4E0A\u9762\u90A3\u5F20\u590D\u6742\u5EA6\u8868\u91CC\u6709\uFF09\uFF0C\u5B83\u5047\u8BBE\u5F53\u524D\u8BCD\u53EA\u4E0E\u524D\u540E <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> \u4E2A\u8BCD\u6709\u5173\uFF0C\u56E0\u6B64\u53EA\u5728\u8FD9 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> \u4E2A\u8BCD\u4E0A\u505A attention\uFF0C\u590D\u6742\u5EA6\u662F <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>\uFF0C\u76F8\u5F53\u4E8E\u662F\u5728\u6355\u6349\u5C40\u90E8\u7279\u5F81\u3002\u542C\u4E0A\u53BB\u5F88\u50CF\u5377\u79EF\u7A97\u53E3\uFF1F</p></li><li><p>\u5931\u53BB\u7684\u4F4D\u7F6E\u4FE1\u606F\u975E\u5E38\u91CD\u8981\uFF0C\u5728\u8BCD\u5411\u91CF\u4E2D\u52A0\u5165 position embedding \u8FD9\u4E2A\u89E3\u51B3\u65B9\u6848\u4F9D\u7136\u4E0D\u591F\u597D</p></li><li><p>\u975E\u56FE\u7075\u5B8C\u5907\uFF08computationally universal\uFF09</p><p><a href="https://openreview.net/pdf?id=HyzdRiR9Y7" target="_blank" rel="noopener noreferrer"><strong>Universal Transformer</strong></a>. <em>Mostafa Dehghani, et al.</em> ICLR 2019.</p></li></ul><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference" aria-hidden="true">#</a> Reference</h2><ul><li><p>\u56FE\u89E3 Transformer\uFF1A<a href="http://jalammar.github.io/illustrated-transformer/" target="_blank" rel="noopener noreferrer">The Illustrated Transformer</a></p></li><li><p>\u8FDE\u7740\u4EE3\u7801\u4E00\u8D77\u8BB2\uFF1A<a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener noreferrer">The Annotated Transformer</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/44121378" target="_blank" rel="noopener noreferrer">\u3010NLP\u3011Transformer \u8BE6\u89E3</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/48508221" target="_blank" rel="noopener noreferrer">\u8BE6\u89E3 Transformer\uFF08Attention Is All You Need\uFF09</a></p></li></ul>',75);function d(y,u){return g}var x=a(o,[["render",d]]);export{x as default};
